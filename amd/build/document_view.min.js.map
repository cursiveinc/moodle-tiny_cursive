{"version":3,"file":"document_view.min.js","sources":["../src/document_view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module provides functionality for document view management in the Tiny editor,\n * including full page mode display and sidebar information\n * @module     tiny_cursive/document_view\n * @copyright  2025 Cursive Technology, Inc. <info@cursivetechnology.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Icons from 'tiny_cursive/svg_repo';\nexport default class DocumentView {\n\n    constructor(User, Rubrics, submission, modulename, editor) {\n        this.User = User;\n        this.Rubrics = Rubrics;\n        this.submission = submission;\n        this.module = modulename;\n        this.editor = editor;\n        this.moduleIcon = Icons.assignment;\n    }\n\n    normalMode() {\n        if (this.module === 'assign') {\n            document.getElementById('tiny_cursive-fullpage-custom-header')?.remove();\n            document.getElementById('cursive-fullpagemode-sidebar')?.remove();\n\n            let current = document.querySelector('#id_onlinetext_editor_ifr');\n            let p1 = current.parentElement;\n            let p2 = p1.parentElement;\n\n            p2.style.backgroundColor = '';\n            current.style.width = '';\n            current.style.minWidth = '';\n            current.style.boxShadow = '';\n            Object.assign(p1.style, {\n                display: '',\n                justifyContent: '',\n                outline: '',\n                margin: ''\n            });\n            p1.classList.remove('tiny-cursive-editor-container');\n            p2.style.position = '';\n            let iframeBody = current.contentDocument?.body || current.contentWindow?.document?.body;\n            if (iframeBody) {\n                iframeBody.style.padding = '0';\n            }\n            document.head.querySelector('#tiny_cursive-fullpage-mode-style')?.remove();\n        } else if (this.module === 'forum') {\n            document.getElementById('tiny_cursive-fullpage-custom-header')?.remove();\n            document.getElementById('cursive-fullpagemode-sidebar')?.remove();\n\n            let current = document.querySelector('#id_message_ifr');\n            let p1 = current.parentElement;\n            let p2 = p1.parentElement;\n\n            p2.style.backgroundColor = '';\n            current.style.width = '';\n            current.style.minWidth = '';\n            current.style.boxShadow = '';\n            Object.assign(p1.style, {\n                display: '',\n                justifyContent: '',\n                outline: '',\n                margin: ''\n            });\n            p1.classList.remove('tiny-cursive-editor-container');\n            p2.style.position = '';\n            let iframeBody = current.contentDocument?.body || current.contentWindow?.document?.body;\n            if (iframeBody) {\n                iframeBody.style.padding = '0';\n            }\n            document.head.querySelector('#tiny_cursive-fullpage-mode-style')?.remove();\n        }\n\n    }\n\n    fullPageMode() {\n\n        if (this.module === 'assign') {\n            this.moduleIcon = Icons.assignment;\n            this.fullPageModule('onlinetext_editor');\n        } else if (this.module === 'forum') {\n            this.moduleIcon = Icons.forum;\n            this.fullPageModule('message');\n        }\n    }\n\n    docSideBar(status) {\n\n        let url = new URL(window.location.href);\n        let replyId = url.searchParams.get(\"reply\");\n        let toggle = document.querySelector('#cursive-fullpagemode-sidebar-toggle');\n        let timelimitBlock = document.querySelector('#mod_assign_timelimit_block > div > div');\n\n        const container = this.create('div');\n        container.id = 'cursive-fullpagemode-sidebar';\n        container.className = 'bg-white h-100 shadow';\n        container.style.width = '300px';\n        container.style.overflow = 'auto';\n\n        let crossBtn = this.create('span');\n        crossBtn.className = 'btn p-2';\n        crossBtn.innerHTML = Icons.close;\n        crossBtn.id = 'cursive-collapse-sidebar';\n\n        crossBtn.addEventListener('click', () => {\n            container.style.transition = 'width 0.3s ease';\n            container.style.width = '0';\n            toggle.style.display = 'flex';\n        });\n        toggle?.addEventListener('click', function () {\n            toggle.style.display = 'none';\n            container.style.width = '300px';\n        });\n\n        let btnWrapper = this.create('div');\n        btnWrapper.style.padding = '0 1rem';\n        btnWrapper.style.position = 'sticky';\n        btnWrapper.style.top = '0';\n        btnWrapper.style.backgroundColor = 'white';\n        btnWrapper.append(crossBtn);\n\n\n        const header = this.create('div');\n        header.className = 'border-bottom p-3 bg-light';\n        header.style.position = 'sticky';\n        header.style.top = '0';\n\n        const headerTitle = this.create('h3');\n        const headerIcon = this.create('span');\n        headerIcon.className = 'bg-primary p-2 text-white me-2 rounded';\n        headerTitle.className = 'mb-3';\n        headerTitle.textContent = 'Assignment Details';\n        headerTitle.style.fontWeight = '600';\n        let AssignIcon = Icons.assignment;\n\n        headerIcon.insertAdjacentHTML('afterbegin', AssignIcon.replace('me-2', ''));\n        headerTitle.prepend(headerIcon);\n\n        let wordCount = this.wordCounter(status);\n\n        if (timelimitBlock) {\n            let timer = this.timerCountDown(timelimitBlock);\n            header.append(headerTitle, wordCount, timer);\n        } else {\n            header.append(headerTitle, wordCount);\n        }\n\n\n        const content = this.create('div');\n        content.className = 'p-3';\n\n        let courseName = document.querySelector('#page-navbar > nav > ol > li:nth-child(1) > a');\n        let courseDes = document.querySelector('#intro');\n        let Dates = document.querySelector('.activity-dates');\n        let openDate, dueDate = null;\n\n        if (Dates) {\n            openDate = Dates.querySelector('div:nth-child(1)');\n            dueDate = Dates.querySelector('div:nth-child(2)');\n        }\n        if (this.module === 'forum') {\n            this.checkForumSubject();\n        }\n        content.append(\n            this.createBox({\n                bg: 'bg-info',\n                titleColor: 'text-info',\n                icon: Icons.people,\n                title: 'Student Information',\n                bodyHTML: this.generateStudentInfo(this.User, courseName)\n            })\n        );\n\n\n        if (courseDes && courseDes?.textContent.trim() !== '') {\n            content.append(\n                this.createBox({\n                    bg: 'bg-gray',\n                    titleColor: 'text-dark',\n                    icon: this.moduleIcon,\n                    title: 'Assignment Description',\n                    bodyHTML: courseDes.innerHTML\n                })\n            );\n        }\n\n        if (this.module === 'forum' && replyId) {\n            let replyPost = document.querySelector(`#post-content-${replyId}`);\n            if (replyPost?.textContent.trim()) {\n                content.append(\n                    this.createBox({\n                        bg: 'bg-gray',\n                        titleColor: 'text-dark',\n                        icon: this.moduleIcon,\n                        title: 'Replying to Post',\n                        bodyHTML: replyPost.textContent.trim()\n                    })\n                );\n            }\n        }\n\n        if (Object.keys(this.Rubrics).length) {\n            content.append(\n                this.createBox({\n                    bg: 'bg-gray',\n                    titleColor: 'text-dark',\n                    icon: this.moduleIcon,\n                    title: 'Assessment Rubrics',\n                    bodyHTML: this.generateRubrics(this.Rubrics)\n                })\n            );\n        }\n\n        if (Dates) {\n            content.append(\n                this.createBox({\n                    bg: 'bg-amber',\n                    titleColor: 'text-dark',\n                    icon: Icons.time,\n                    title: 'Important Dates',\n                    bodyHTML: this.generateImportantDates(openDate, dueDate)\n                })\n            );\n        }\n\n        content.append(\n            this.createBox({\n                bg: 'bg-green',\n                titleColor: 'text-success',\n                icon: this.moduleIcon,\n                title: 'Submission Status',\n                bodyHTML: this.submissionStatus(this.submission)\n            })\n        );\n\n        container.append(btnWrapper, header, content);\n        return container;\n\n    }\n    // Helper to create info boxes\n    createBox({ bg, titleColor, icon, title, bodyHTML }) {\n        const box = this.create('div');\n        box.className = `tiny_cursive-fullpage-card ${bg}`;\n\n        const heading = this.create('h4');\n        heading.className = `tiny_cursive-fullpage-card-header ${titleColor}  mb-2 d-flex align-items-center`;\n        heading.innerHTML = `${icon} ${title}`;\n\n        const body = this.create('div');\n        body.className = `tiny_cursive-fullpage-card-body`;\n        body.innerHTML = bodyHTML;\n\n        box.append(heading, body);\n        return box;\n    }\n\n    generateRubrics(Rubrics) {\n        const wrapper = this.create('div');\n\n        Rubrics.forEach(rubric => {\n            const rubricDiv = this.create('div');\n            rubricDiv.className = 'tiny_cursive-rubric-card';\n\n            const title = this.create('h3');\n            title.className = 'tiny_cursive-rubric-title';\n            title.textContent = rubric.description;\n            rubricDiv.appendChild(title);\n\n            Object.values(rubric.levels).forEach(level => {\n                const levelDiv = this.create('div');\n                const score = Number(level.score);\n\n                // Assign background color class based on score\n                if (score === 0) {\n                    levelDiv.className = 'tiny_cursive-rubric-level tiny_cursive-rubric-low';\n                } else if (score <= 2) {\n                    levelDiv.className = 'tiny_cursive-rubric-level tiny_cursive-rubric-mid';\n                } else {\n                    levelDiv.className = 'tiny_cursive-rubric-level tiny_cursive-rubric-high';\n                }\n\n                levelDiv.textContent = `${level.definition} / ${level.score}`;\n                rubricDiv.appendChild(levelDiv);\n            });\n\n            wrapper.appendChild(rubricDiv);\n        });\n\n        return wrapper.innerHTML;\n    }\n\n    submissionStatus(submission) {\n        const wrapper = this.create('div');\n\n        const statusWrapper = this.create('div');\n        statusWrapper.className = 'tiny_cursive-status-row';\n\n        const statusName = this.create('span');\n        statusName.textContent = 'Status: ';\n\n        const statusValue = this.create('span');\n        const isNew = submission?.current?.status === 'new';\n        statusValue.textContent = isNew ? 'Draft (Not submitted)' : 'Draft (Submitted)';\n        statusValue.className = `tiny_cursive-status-value ${isNew ? 'tiny_cursive-status-red' : 'tiny_cursive-status-green'}`;\n\n        statusWrapper.append(statusName, statusValue);\n\n        const modifiedWrapper = this.create('div');\n        modifiedWrapper.className = 'tiny_cursive-status-row';\n\n        const modifiedName = this.create('span');\n        modifiedName.textContent = 'Last Modified: ';\n        const modifiedValue = this.create('span');\n        if (submission?.current?.timemodified) {\n            const date = new Date(submission.current.timemodified * 1000);\n            modifiedValue.textContent = this.formatDate(date);\n        } else {\n            modifiedValue.textContent = 'N/A';\n        }\n        modifiedWrapper.append(modifiedName, modifiedValue);\n\n        const gradeWrapper = this.create('div');\n        gradeWrapper.className = 'tiny_cursive-status-row';\n\n        const gradeName = this.create('span');\n        gradeName.textContent = 'Grading Status: ';\n\n        const gradeValue = this.create('span');\n\n        if (submission?.grade) {\n            gradeValue.textContent = Number(submission.grade.grade) > 0\n                ? submission.grade.grade\n                : 'Not graded';\n        } else {\n            gradeValue.textContent = 'Not graded';\n        }\n\n        gradeWrapper.append(gradeName, gradeValue);\n\n        wrapper.append(statusWrapper, gradeWrapper, modifiedWrapper);\n        return wrapper.innerHTML;\n    }\n\n    wordCounter(status) {\n        const wordCount = this.create('div');\n        wordCount.className = 'bg-white rounded shadow-sm p-2 d-flex justify-content-between my-2';\n\n        const labelDiv = this.create('div');\n        const label = this.create('span');\n        const value = this.create('span');\n        const icon = this.create('span');\n        icon.className = 'me-2';\n        icon.innerHTML = Icons.assignment;\n\n        labelDiv.appendChild(icon);\n        labelDiv.append(label);\n\n        label.textContent = 'Word Count: ';\n        value.textContent = '0';\n        value.className = 'text-primary';\n        value.style.fontWeight = '600';\n        value.style.fontSize = '14px';\n\n        wordCount.append(labelDiv, value);\n        wordCount.style.fontSize = '12px';\n\n        const observer = new MutationObserver(() => {\n            const newText = status.textContent.trim();\n            value.textContent = `${newText.replace('words', '')}`;\n        });\n\n        observer.observe(status, {\n            characterData: true,\n            subtree: true,\n            childList: true\n        });\n\n        return wordCount;\n    }\n\n\n    timerCountDown(timer) {\n\n        let warningDiv = document.querySelector('#user-notifications > div');\n        if (warningDiv) {\n            let clone = warningDiv.cloneNode(true);\n            clone.querySelector('button')?.remove();\n            this.editor.notificationManager.open({\n                text: clone.textContent,\n                type: 'error'\n            });\n        }\n\n\n        const timerCount = this.create('div');\n        timerCount.className = 'bg-white rounded shadow-sm p-2 d-flex justify-content-between my-2';\n\n        const labelDiv = this.create('div');\n        const label = this.create('span');\n        const value = this.create('span');\n        const icon = this.create('span');\n        icon.innerHTML = Icons.time;\n\n        labelDiv.appendChild(icon);\n        labelDiv.append(label);\n\n        label.textContent = 'Time Left: ';\n        value.textContent = '00:00:00';\n        value.className = warningDiv ? 'text-danger': 'text-primary';\n        value.style.fontWeight = '600';\n        value.style.fontSize = '14px';\n\n        timerCount.append(labelDiv, value);\n        timerCount.style.fontSize = '12px';\n        if (timer) {\n            const observer = new MutationObserver(() => {\n                const newText = timer.textContent.trim();\n                value.textContent = `${newText}`;\n            });\n            observer.observe(timer, {\n                characterData: true,\n                subtree: true,\n                childList: true\n            });\n        } else {\n            value.textContent = `No limit`;\n        }\n\n\n        return timerCount;\n    }\n\n\n    generateStudentInfo(user, course) {\n\n        const wrapper = this.create('div');\n\n        const nameWrapper = this.create('div');\n        const usernameWrapper = this.create('div');\n        const courseWrapper = this.create('div');\n\n        const nameLabel = this.create('span');\n        const nameValue = this.create('span');\n        const usernameLabel = this.create('span');\n        const usernameValue = this.create('span');\n        const courseLabel = this.create('span');\n        const courseValue = this.create('span');\n\n        nameLabel.textContent = 'Name: ';\n        nameValue.textContent = user.fullname;\n\n        usernameLabel.textContent = 'Username: ';\n        usernameValue.textContent = user.username;\n\n        courseLabel.textContent = 'Course: ';\n        courseValue.textContent = course.title;\n\n        nameWrapper.className = 'd-flex justify-content-between';\n        usernameWrapper.className = 'd-flex justify-content-between';\n        courseWrapper.className = 'd-flex justify-content-between';\n\n        nameWrapper.append(nameLabel, nameValue);\n        usernameWrapper.append(usernameLabel, usernameValue);\n        courseWrapper.append(courseLabel, courseValue);\n\n        wrapper.append(nameWrapper, usernameWrapper, courseWrapper);\n\n        return wrapper.innerHTML;\n\n    }\n\n    generateImportantDates(open, due) {\n\n        const wrapper = this.create('div');\n\n        const openedWrapper = this.create('div');\n        const dueWrapper = this.create('div');\n        const remainingWrapper = this.create('div');\n\n        const openedLabel = this.create('span');\n        const openedValue = this.create('span');\n        const dueLabel = this.create('span');\n        const dueValue = this.create('span');\n        const remainingLabel = this.create('span');\n        const remainingValue = this.create('span');\n\n        let openDate = open?.textContent.replace(\"Opened:\", \"\")?.trim();\n        let dueDate = due?.textContent.replace(\"Due:\", \"\")?.trim();\n\n        openedLabel.textContent = 'Opened: ';\n        openedValue.textContent = this.formatDate(openDate ? new Date(openDate) : null);\n        openedValue.className = 'text-dark';\n\n        dueLabel.textContent = 'Due: ';\n        dueValue.textContent = this.formatDate(dueDate ? new Date(dueDate) : null);\n        dueValue.className = 'text-danger';\n\n        remainingLabel.textContent = 'Remaining: ';\n        remainingValue.textContent = this.calculateDate(dueDate);\n        remainingValue.className = 'text-danger';\n\n        openedWrapper.className = 'd-flex justify-content-between';\n        dueWrapper.className = 'd-flex justify-content-between';\n        remainingWrapper.className = 'd-flex align-items-center justify-content-between mt-2 pt-2 border-top';\n\n        openedWrapper.append(openedLabel, openedValue);\n        dueWrapper.append(dueLabel, dueValue);\n        remainingWrapper.append(remainingLabel, remainingValue);\n\n        wrapper.append(openedWrapper, dueWrapper, remainingWrapper);\n\n        return wrapper.innerHTML;\n    }\n\n    formatDate(date) {\n        if (!date) {\n            return '-';\n        }\n        let options = { year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true };\n        return date.toLocaleString('en-US', options);\n    }\n\n    calculateDate(date) {\n        if (!date) {\n            return '-';\n        }\n        const date1 = new Date(date); // Due date (local time)\n        const now = new Date(); // Current date/time\n\n        // Calculate the difference in milliseconds\n        const diffMs = date1 - now;\n\n        // Convert to days, hours, minutes\n        if (diffMs <= 0) {\n            return \"Overdue\";\n        } else {\n            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n            const diffHours = Math.floor((diffMs / (1000 * 60 * 60)) % 24);\n\n            return `${diffDays} days, ${diffHours} hours`;\n        }\n\n    }\n\n    fullPageModule(module) {\n        let current = document.querySelector(`#id_${module}_ifr`);\n        let p1 = current.parentElement;\n        let p2 = p1.parentElement;\n        let p3 = p2.parentElement;\n        let p4 = p3.parentElement;\n\n        let statusBar = document.querySelector('.tox-statusbar__right-container > button');\n        let assignName = document.querySelector('.page-context-header');\n        assignName.classList.remove('mb-2');\n\n        let header = this.create('div');\n        header.id = 'tiny_cursive-fullpage-custom-header';\n        header.style.backgroundColor = 'white';\n        header.style.display = 'flex';\n        header.style.justifyContent = 'space-between';\n\n        let btn = this.create('input');\n        btn.className = 'tiny_cursive-fullpage-submit-btn';\n        btn.value = 'Save changes';\n        btn.type = 'submit';\n        btn.style.margin = '.5rem';\n\n        const leftSide = this.create('div');\n        leftSide.style.display = 'flex';\n        leftSide.style.alignItems = 'center';\n        leftSide.style.margin = '0 1rem';\n\n        const rightSide = this.create('div');\n        rightSide.style.display = 'flex';\n        rightSide.style.alignItems = 'center';\n        rightSide.style.margin = '0 1rem';\n        rightSide.id = 'tiny_cursive-fullpage-right-wrapper';\n\n        rightSide.appendChild(btn);\n        leftSide.appendChild(assignName.cloneNode(true));\n\n\n        header.appendChild(leftSide);\n        header.appendChild(rightSide);\n\n        p4.insertBefore(header, p4.firstChild);\n        p2.style.backgroundColor = '#efefef';\n        current.style.width = '750px';\n        current.style.minWidth = '750px';\n        current.style.boxShadow = '0 10px 15px -3px rgb(0 0 0/0.1),0 4px 6px -4px rgb(0 0 0/0.1)';\n        Object.assign(p1.style, {\n            display: 'flex',\n            justifyContent: 'center',\n            outline: 'none',\n            margin: '2rem 0 0'\n        });\n        const style = this.create('style');\n        style.id = 'tiny_cursive-fullpage-mode-style';\n        style.textContent = `\n            .tox.tox-edit-focus .tox-edit-area::before {\n                opacity: 0;\n            }\n            `;\n        document.head.appendChild(style);\n\n        let iframeBody = current.contentDocument?.body || current.contentWindow?.document?.body;\n\n        if (iframeBody) {\n            iframeBody.style.padding = '0.5in';\n        }\n        p2.style.position = 'relative';\n        document.getElementById('cursive-fullpagemode-sidebar')?.remove();\n\n        let toggle = this.create('div');\n        toggle.id = 'cursive-fullpagemode-sidebar-toggle';\n        toggle.innerHTML = Icons.hamburger;\n        p2.appendChild(toggle);\n        p2.appendChild(this.docSideBar(statusBar));\n    }\n\n    checkForumSubject() {\n        const form = document.querySelector('#tiny_cursive-fullpage-right-wrapper > input');\n        const msg = 'Subject or message cannot be empty.';\n\n        if (form) {\n            form.addEventListener('click', (e) => {\n                const subjectInput = document.getElementById('id_subject');\n                let content = this.editor.getContent().trim();\n                if (!subjectInput || subjectInput.value.trim() === '' || content === '') {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.editor.windowManager.alert(msg);\n                }\n            });\n        }\n    }\n\n\n    create(tag) {\n        return document.createElement(tag);\n    }\n\n}"],"names":["constructor","User","Rubrics","submission","modulename","editor","module","moduleIcon","Icons","assignment","normalMode","this","document","getElementById","remove","current","querySelector","p1","parentElement","p2","style","backgroundColor","width","minWidth","boxShadow","Object","assign","display","justifyContent","outline","margin","classList","position","iframeBody","contentDocument","body","contentWindow","_current$contentWindo","_current$contentWindo2","padding","head","_current$contentWindo3","_current$contentWindo4","fullPageMode","fullPageModule","forum","docSideBar","status","replyId","URL","window","location","href","searchParams","get","toggle","timelimitBlock","container","create","id","className","overflow","crossBtn","innerHTML","close","addEventListener","transition","btnWrapper","top","append","header","headerTitle","headerIcon","textContent","fontWeight","AssignIcon","insertAdjacentHTML","replace","prepend","wordCount","wordCounter","timer","timerCountDown","content","openDate","courseName","courseDes","Dates","dueDate","checkForumSubject","createBox","bg","titleColor","icon","people","title","bodyHTML","generateStudentInfo","trim","replyPost","keys","length","generateRubrics","time","generateImportantDates","submissionStatus","box","heading","wrapper","forEach","rubric","rubricDiv","description","appendChild","values","levels","level","levelDiv","score","Number","definition","statusWrapper","statusName","statusValue","isNew","modifiedWrapper","modifiedName","modifiedValue","_submission$current2","timemodified","date","Date","formatDate","gradeWrapper","gradeName","gradeValue","grade","labelDiv","label","value","fontSize","MutationObserver","newText","observe","characterData","subtree","childList","warningDiv","clone","cloneNode","notificationManager","open","text","type","timerCount","user","course","nameWrapper","usernameWrapper","courseWrapper","nameLabel","nameValue","usernameLabel","usernameValue","courseLabel","courseValue","fullname","username","due","openedWrapper","dueWrapper","remainingWrapper","openedLabel","openedValue","dueLabel","dueValue","remainingLabel","remainingValue","_open$textContent$rep","_due$textContent$repl","calculateDate","toLocaleString","year","month","day","hour","minute","hour12","diffMs","diffDays","Math","floor","diffHours","p4","statusBar","assignName","btn","leftSide","alignItems","rightSide","insertBefore","firstChild","_current$contentWindo5","_current$contentWindo6","hamburger","form","e","subjectInput","getContent","preventDefault","stopPropagation","windowManager","alert","tag","createElement"],"mappings":"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"}