{"version":3,"file":"document_view.min.js","sources":["../src/document_view.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * This module provides functionality for document view management in the Tiny editor,\r\n * including full page mode display and sidebar information\r\n * @module     tiny_cursive/document_view\r\n * @copyright  2025 Cursive Technology, Inc. <info@cursivetechnology.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport Icons from 'tiny_cursive/svg_repo';\r\nexport default class DocumentView {\r\n\r\n    constructor(User, Rubrics, submission, modulename, editor, quizInfo) {\r\n        this.User = User;\r\n        this.Rubrics = Rubrics;\r\n        this.submission = submission;\r\n        this.module = modulename;\r\n        this.editor = editor;\r\n        this.moduleIcon = Icons.assignment;\r\n        this.quizInfo = quizInfo;\r\n        this.initStrings();\r\n    }\r\n\r\n    normalMode() {\r\n        let id = this.editor?.id + \"_ifr\";\r\n        if (this.module === 'assign') {\r\n            this.normalizePage(id);\r\n        } else if (this.module === 'quiz') {\r\n            this.normalizePage(id);\r\n        } else if (this.module === 'forum') {\r\n            this.normalizePage(id);\r\n        } else if (this.module === 'lesson') {\r\n            this.normalizePage(id);\r\n        } else if(this.module === 'pdfannotator') {\r\n            this.normalizePage(id);\r\n        }\r\n    }\r\n\r\n    fullPageMode() {\r\n\r\n        if (this.module === 'assign') {\r\n            this.moduleIcon = Icons.assignment;\r\n            this.fullPageModule(this.editor?.id);\r\n        } else if (this.module === 'forum') {\r\n            this.moduleIcon = Icons.forum;\r\n            this.fullPageModule(this.editor?.id);\r\n        } else if (this.module === 'quiz' && this.editor?.id) {\r\n            this.moduleIcon = Icons.quiz;\r\n            this.fullPageModule(this.editor?.id);\r\n        } else if (this.module === 'lesson') {\r\n            this.moduleIcon = Icons.lesson;\r\n            this.fullPageModule(this.editor?.id);\r\n        } else if (this.module === 'pdfannotator') {\r\n            this.moduleIcon = Icons.pdfannotator;\r\n            this.fullPageModule(this.editor?.id);\r\n        }\r\n    }\r\n\r\n    docSideBar(status) {\r\n\r\n        const url = new URL(window.location.href);\r\n        const replyId = url.searchParams.get(\"reply\");\r\n        const toggle = document.querySelector('#cursive-fullpagemode-sidebar-toggle');\r\n        const timelimitBlock = this.getTimerBlock(this.module);\r\n        const headerInfo = this.getSidebarTitle();\r\n        const progressBar = document.querySelector('.box.progress_bar');\r\n\r\n        const courseName = document.querySelector('#page-navbar > nav > ol > li:nth-child(1) > a');\r\n        const courseDes = document.querySelector('#intro');\r\n        const Dates = document.querySelector('.activity-dates');\r\n\r\n        let openDate = Dates?.querySelector('div:nth-child(1)');\r\n        let dueDate = Dates?.querySelector('div:nth-child(2)');\r\n\r\n        const container = this.create('div');\r\n        Object.assign(container, {\r\n            id: 'cursive-fullpagemode-sidebar',\r\n            className: 'bg-white h-100 shadow'\r\n        });\r\n        Object.assign(container.style, {\r\n            width: '300px',\r\n            overflow: 'auto'\r\n        });\r\n\r\n        const crossBtn = this.create('span');\r\n        Object.assign(crossBtn, {\r\n            id: 'cursive-collapse-sidebar',\r\n            className: 'btn p-2',\r\n            innerHTML: Icons.close\r\n        });\r\n\r\n        crossBtn.addEventListener('click', () => {\r\n            container.style.transition = 'width 0.3s ease';\r\n            container.style.width = '0';\r\n            toggle.style.display = 'flex';\r\n        });\r\n        toggle?.addEventListener('click', function() {\r\n            toggle.style.display = 'none';\r\n            container.style.width = '300px';\r\n        });\r\n\r\n        const btnWrapper = this.create('div');\r\n        Object.assign(btnWrapper, {\r\n            padding: '0 1rem',\r\n            position: 'sticky',\r\n            top: '0',\r\n            backgroundColor: 'white'\r\n        });\r\n        btnWrapper.append(crossBtn);\r\n\r\n\r\n        const header = this.create('div');\r\n        header.className = 'border-bottom p-3 bg-light';\r\n        Object.assign(header.style, {\r\n            position: 'sticky',\r\n            top: '0'\r\n        });\r\n\r\n        const headerTitle = this.create('h3');\r\n        headerTitle.className = 'mb-3 d-flex align-items-center';\r\n        headerTitle.textContent = `${headerInfo.title} ${this.details}`;\r\n        headerTitle.style.fontWeight = '600';\r\n\r\n        const headerIcon = document.querySelector('.page-header-image > div');\r\n        if (headerIcon) {\r\n            headerTitle.prepend(headerIcon.cloneNode(true));\r\n        }\r\n\r\n        let wordCount = this.wordCounter(status);\r\n        if (timelimitBlock?.textContent) {\r\n            header.append(headerTitle, wordCount, this.timerCountDown(timelimitBlock));\r\n        } else {\r\n            header.append(headerTitle, wordCount);\r\n        }\r\n\r\n        const content = this.create('div');\r\n        content.className = 'p-3';\r\n\r\n        content.append(\r\n            this.createBox({\r\n                bg: 'bg-info',\r\n                titleColor: 'text-info',\r\n                icon: Icons.people,\r\n                title: this.studentInfo,\r\n                bodyHTML: this.generateStudentInfo(this.User, courseName)\r\n            })\r\n        );\r\n\r\n        if (this.module === 'lesson' && progressBar) {\r\n            content.append(\r\n                this.createBox({\r\n                    bg: 'bg-gray',\r\n                    titleColor: 'text-dark',\r\n                    icon: this.moduleIcon,\r\n                    title: this.progress,\r\n                    bodyHTML: progressBar.innerHTML\r\n                })\r\n            );\r\n        }\r\n\r\n        if (courseDes && courseDes?.textContent.trim() !== '') {\r\n            let fileSubDiv = document.querySelectorAll('.fileuploadsubmission');\r\n            if (fileSubDiv) {\r\n                fileSubDiv.forEach(Element => {\r\n                    Element.style.verticalAlign = 'middle';\r\n                });\r\n            }\r\n            content.append(\r\n                this.createBox({\r\n                    bg: 'bg-gray',\r\n                    titleColor: 'text-dark',\r\n                    icon: this.moduleIcon,\r\n                    title: `${this.getSidebarTitle().title} ${this.description}`,\r\n                    bodyHTML: courseDes.innerHTML\r\n                })\r\n            );\r\n        }\r\n\r\n        if (this.module === 'forum' && replyId) {\r\n            this.checkForumSubject();\r\n            let replyPost = document.querySelector(`#post-content-${replyId}`);\r\n            if (replyPost?.textContent.trim()) {\r\n                content.append(\r\n                    this.createBox({\r\n                        bg: 'bg-gray',\r\n                        titleColor: 'text-dark',\r\n                        icon: this.moduleIcon,\r\n                        title: this.replyingto,\r\n                        bodyHTML: replyPost.textContent.trim()\r\n                    })\r\n                );\r\n            }\r\n        }\r\n\r\n        if (this.module === 'quiz' && this.editor?.id) {\r\n\r\n            let questionId = this.getQuestionId(this.editor?.id);\r\n            let question = document.querySelector(`#question-${questionId} .qtext`);\r\n            let intro = atob(this.quizInfo.intro);\r\n\r\n            if (question?.textContent.trim()) {\r\n                content.append(\r\n                    this.createBox({\r\n                        bg: 'bg-amber',\r\n                        titleColor: 'text-dark',\r\n                        icon: this.moduleIcon,\r\n                        title: this.answeringto,\r\n                        bodyHTML: question.textContent\r\n                    })\r\n                );\r\n            }\r\n\r\n            if (intro && intro.trim() !== '') {\r\n                content.append(\r\n                    this.createBox({\r\n                        bg: 'bg-gray',\r\n                        titleColor: 'text-dark',\r\n                        icon: this.moduleIcon,\r\n                        title: `${this.quiz} ${this.description}`,\r\n                        bodyHTML: intro\r\n                    })\r\n                );\r\n            }\r\n\r\n            if (Number(this.quizInfo.open)) {\r\n                content.append(\r\n                    this.createBox({\r\n                        bg: 'bg-amber',\r\n                        titleColor: 'text-dark',\r\n                        icon: Icons.time,\r\n                        title: this.importantdates,\r\n                        bodyHTML: this.generateImportantDates(Number(this.quizInfo.open), Number(this.quizInfo.close))\r\n                    })\r\n                );\r\n            }\r\n        }\r\n\r\n        if (Object.keys(this.Rubrics).length) {\r\n            content.append(\r\n                this.createBox({\r\n                    bg: 'bg-gray',\r\n                    titleColor: 'text-dark',\r\n                    icon: this.moduleIcon,\r\n                    title: this.rubrics,\r\n                    bodyHTML: this.generateRubrics(this.Rubrics)\r\n                })\r\n            );\r\n        }\r\n\r\n        if (Dates && openDate) {\r\n            content.append(\r\n                this.createBox({\r\n                    bg: 'bg-amber',\r\n                    titleColor: 'text-dark',\r\n                    icon: Icons.time,\r\n                    title: this.importantdates,\r\n                    bodyHTML: this.generateImportantDates(openDate, dueDate)\r\n                })\r\n            );\r\n        }\r\n        if (this.module === 'assign') {\r\n            content.append(\r\n                this.createBox({\r\n                    bg: 'bg-green',\r\n                    titleColor: 'text-success',\r\n                    icon: this.moduleIcon,\r\n                    title: this.subStatus,\r\n                    bodyHTML: this.submissionStatus(this.submission)\r\n                })\r\n            );\r\n        }\r\n\r\n        container.append(btnWrapper, header, content);\r\n        return container;\r\n\r\n    }\r\n    // Helper to create info boxes\r\n    createBox({bg, titleColor, icon, title, bodyHTML}) {\r\n        const box = this.create('div');\r\n        box.className = `tiny_cursive-fullpage-card ${bg}`;\r\n\r\n        const heading = this.create('h4');\r\n        heading.className = `tiny_cursive-fullpage-card-header ${titleColor} d-flex align-items-center`;\r\n        heading.innerHTML = `${icon} ${title}`;\r\n\r\n        const body = this.create('div');\r\n        body.className = `tiny_cursive-fullpage-card-body`;\r\n        body.innerHTML = bodyHTML;\r\n\r\n        box.append(heading, body);\r\n        return box;\r\n    }\r\n\r\n    generateRubrics(Rubrics) {\r\n        const wrapper = this.create('div');\r\n\r\n        Rubrics.forEach(rubric => {\r\n            const rubricDiv = this.create('div');\r\n            rubricDiv.className = 'tiny_cursive-rubric-card';\r\n\r\n            const title = this.create('h3');\r\n            title.className = 'tiny_cursive-rubric-title';\r\n            title.textContent = rubric.description;\r\n            rubricDiv.appendChild(title);\r\n\r\n            Object.values(rubric.levels).forEach(level => {\r\n                const levelDiv = this.create('div');\r\n                const score = Number(level.score);\r\n\r\n                // Assign background color class based on score\r\n                if (score === 0) {\r\n                    levelDiv.className = 'tiny_cursive-rubric-level tiny_cursive-rubric-low';\r\n                } else if (score <= 2) {\r\n                    levelDiv.className = 'tiny_cursive-rubric-level tiny_cursive-rubric-mid';\r\n                } else {\r\n                    levelDiv.className = 'tiny_cursive-rubric-level tiny_cursive-rubric-high';\r\n                }\r\n\r\n                levelDiv.textContent = `${level.definition} / ${level.score}`;\r\n                rubricDiv.appendChild(levelDiv);\r\n            });\r\n\r\n            wrapper.appendChild(rubricDiv);\r\n        });\r\n\r\n        return wrapper.innerHTML;\r\n    }\r\n\r\n    submissionStatus(submission) {\r\n        const wrapper = this.create('div');\r\n\r\n        const statusWrapper = this.create('div');\r\n        statusWrapper.className = 'tiny_cursive-status-row';\r\n\r\n        const statusName = this.create('span');\r\n        statusName.textContent = `${this.status}:`;\r\n\r\n        const statusValue = this.create('span');\r\n        const isNew = submission?.current?.status === 'new';\r\n        statusValue.textContent = isNew ? this.draftnot : this.draft;\r\n        statusValue.className = `tiny_cursive-status-value ${isNew ? 'tiny_cursive-status-red' : 'tiny_cursive-status-green'}`;\r\n\r\n        statusWrapper.append(statusName, statusValue);\r\n\r\n        const modifiedWrapper = this.create('div');\r\n        modifiedWrapper.className = 'tiny_cursive-status-row';\r\n\r\n        const modifiedName = this.create('span');\r\n        modifiedName.textContent = `${this.lastModified}: `;\r\n\r\n        const modifiedValue = this.create('span');\r\n        if (submission?.current?.timemodified) {\r\n            const date = new Date(submission.current.timemodified * 1000);\r\n            modifiedValue.textContent = this.formatDate(date);\r\n        } else {\r\n            modifiedValue.textContent = 'N/A';\r\n        }\r\n        modifiedWrapper.append(modifiedName, modifiedValue);\r\n\r\n        const gradeWrapper = this.create('div');\r\n        gradeWrapper.className = 'tiny_cursive-status-row';\r\n\r\n        const gradeName = this.create('span');\r\n        gradeName.textContent = `${this.gradings}: `;\r\n\r\n        const gradeValue = this.create('span');\r\n\r\n        if (submission?.grade) {\r\n            gradeValue.textContent = Number(submission.grade.grade) > 0\r\n                ? submission.grade.grade\r\n                : this.gradenot;\r\n        } else {\r\n            gradeValue.textContent = this.gradenot;\r\n        }\r\n\r\n        gradeWrapper.append(gradeName, gradeValue);\r\n        wrapper.append(statusWrapper, gradeWrapper, modifiedWrapper);\r\n        return wrapper.innerHTML;\r\n    }\r\n\r\n    wordCounter(status) {\r\n        const wordCount = this.create('div');\r\n        const labelDiv = this.create('div');\r\n        const label = this.create('span');\r\n        const value = this.create('span');\r\n        const icon = this.create('span');\r\n\r\n        icon.className = 'me-2';\r\n        icon.innerHTML = Icons.assignment;\r\n\r\n        labelDiv.appendChild(icon);\r\n        labelDiv.append(label);\r\n\r\n        label.textContent = `${this.wordCount}:`;\r\n        value.textContent = '0';\r\n        value.className = 'text-primary';\r\n        value.style.fontWeight = '600';\r\n        value.style.fontSize = '14px';\r\n\r\n        wordCount.className = 'bg-white rounded shadow-sm p-2 d-flex justify-content-between my-2';\r\n        wordCount.append(labelDiv, value);\r\n        wordCount.style.fontSize = '12px';\r\n\r\n        const observer = new MutationObserver(() => {\r\n            const newText = status.textContent.trim();\r\n            value.textContent = `${newText.replace('words', '')}`;\r\n        });\r\n\r\n        observer.observe(status, {\r\n            characterData: true,\r\n            subtree: true,\r\n            childList: true\r\n        });\r\n\r\n        return wordCount;\r\n    }\r\n\r\n\r\n    timerCountDown(timer) {\r\n\r\n        let warningDiv = document.querySelector('#user-notifications > div');\r\n        if (warningDiv) {\r\n            let clone = warningDiv.cloneNode(true);\r\n            clone.querySelector('button')?.remove();\r\n            this.editor.notificationManager.open({\r\n                text: clone.textContent,\r\n                type: 'error'\r\n            });\r\n        }\r\n\r\n\r\n        const timerCount = this.create('div');\r\n        timerCount.className = 'bg-white rounded shadow-sm p-2 d-flex justify-content-between my-2';\r\n\r\n        const labelDiv = this.create('div');\r\n        const label = this.create('span');\r\n        const value = this.create('span');\r\n        const icon = this.create('span');\r\n        icon.innerHTML = Icons.time;\r\n\r\n        labelDiv.appendChild(icon);\r\n        labelDiv.append(label);\r\n\r\n        label.textContent = `${this.timeleft}:`;\r\n        value.textContent = '00:00:00';\r\n        value.className = warningDiv ? 'text-danger' : 'text-primary';\r\n        Object.assign(value.style, {\r\n            fontWeight: '600',\r\n            fontSize: '14px'\r\n        });\r\n\r\n\r\n        timerCount.append(labelDiv, value);\r\n        timerCount.style.fontSize = '12px';\r\n        if (timer) {\r\n            const observer = new MutationObserver(() => {\r\n                const newText = timer.textContent.trim();\r\n                value.textContent = `${newText}`;\r\n            });\r\n            observer.observe(timer, {\r\n                characterData: true,\r\n                subtree: true,\r\n                childList: true\r\n            });\r\n        } else {\r\n            value.textContent = this.nolimit;\r\n        }\r\n\r\n\r\n        return timerCount;\r\n    }\r\n\r\n\r\n    generateStudentInfo(user, course) {\r\n\r\n        const wrapper = this.create('div');\r\n\r\n        const nameWrapper = this.create('div');\r\n        const usernameWrapper = this.create('div');\r\n        const courseWrapper = this.create('div');\r\n\r\n        const nameLabel = this.create('strong');\r\n        const nameValue = this.create('span');\r\n        const usernameLabel = this.create('strong');\r\n        const usernameValue = this.create('span');\r\n        const courseLabel = this.create('strong');\r\n        const courseValue = this.create('span');\r\n\r\n        nameLabel.textContent = `${this.name}`;\r\n        nameValue.textContent = user.fullname;\r\n\r\n        usernameLabel.textContent = `${this.userename}: `;\r\n        usernameValue.textContent = user.username;\r\n\r\n        courseLabel.textContent = `${this.course}: `;\r\n        courseValue.textContent = course.title;\r\n\r\n        usernameLabel.className = 'cfw-bold me-2';\r\n        usernameValue.className = 'cursiveFw-wrap';\r\n        courseLabel.className = 'cfw-bold me-2';\r\n        courseValue.className = 'cursiveFw-wrap';\r\n        nameLabel.className = 'cfw-bold me-2';\r\n        nameValue.className = 'cursiveFw-wrap';\r\n\r\n        nameWrapper.append(nameLabel, nameValue);\r\n        usernameWrapper.append(usernameLabel, usernameValue);\r\n        courseWrapper.append(courseLabel, courseValue);\r\n\r\n        wrapper.append(nameWrapper, usernameWrapper, courseWrapper);\r\n\r\n        return wrapper.innerHTML;\r\n\r\n    }\r\n\r\n    generateImportantDates(open, due) {\r\n\r\n        const wrapper = this.create('div');\r\n        let openDate = null;\r\n        let dueDate = null;\r\n\r\n        if (this.module === 'quiz') {\r\n            // For quiz, open/due are timestamps - only set if non-zero\r\n            openDate = open ? open * 1000 : null;\r\n            dueDate = due ? due * 1000 : null;\r\n        } else {\r\n            // For other modules, check the text content to determine which is which\r\n            // Moodle only renders divs for dates that are set, so we need to check labels\r\n            const openText = open?.textContent?.toLowerCase() || '';\r\n            const dueText = due?.textContent?.toLowerCase() || '';\r\n\r\n            // Check if 'open' div actually contains an open date or a due date\r\n            if (openText.includes('opened') || openText.includes('open')) {\r\n                openDate = this.extractDate(open?.textContent);\r\n            } else if (openText.includes('due') || openText.includes('close')) {\r\n                // First div is actually the due date (no open date was set)\r\n                dueDate = this.extractDate(open?.textContent);\r\n            }\r\n\r\n            // Check 'due' div if it exists\r\n            if (due && (dueText.includes('due') || dueText.includes('close'))) {\r\n                dueDate = this.extractDate(due?.textContent);\r\n            }\r\n        }\r\n\r\n        // Only show open date if it exists\r\n        if (openDate) {\r\n            const openedWrapper = this.create('div');\r\n            const openedLabel = this.create('span');\r\n            const openedValue = this.create('span');\r\n\r\n            openedLabel.textContent = `${this.opened}: `;\r\n            openedValue.textContent = this.formatDate(new Date(openDate));\r\n            openedValue.className = 'text-dark';\r\n\r\n            openedWrapper.className = 'd-flex justify-content-between';\r\n            openedWrapper.append(openedLabel, openedValue);\r\n            wrapper.append(openedWrapper);\r\n        }\r\n\r\n        // Only show due date and remaining time if due date exists\r\n        if (dueDate) {\r\n            const dueWrapper = this.create('div');\r\n            const dueLabel = this.create('span');\r\n            const dueValue = this.create('span');\r\n\r\n            dueLabel.textContent = `${this.due}: `;\r\n            dueValue.textContent = this.formatDate(new Date(dueDate));\r\n            dueValue.className = 'text-danger';\r\n\r\n            dueWrapper.className = 'd-flex justify-content-between';\r\n            dueWrapper.append(dueLabel, dueValue);\r\n            wrapper.append(dueWrapper);\r\n\r\n            // Remaining time - only show if due date exists\r\n            const remainingWrapper = this.create('div');\r\n            const remainingLabel = this.create('span');\r\n            const remainingValue = this.create('span');\r\n\r\n            remainingLabel.textContent = `${this.remaining}: `;\r\n            remainingValue.textContent = this.calculateDate(dueDate);\r\n            remainingValue.className = 'text-danger';\r\n\r\n            remainingWrapper.className = 'd-flex align-items-center justify-content-between mt-2 pt-2 border-top';\r\n            remainingWrapper.append(remainingLabel, remainingValue);\r\n            wrapper.append(remainingWrapper);\r\n        }\r\n\r\n        return wrapper.innerHTML;\r\n    }\r\n\r\n    formatDate(date) {\r\n        if (!date) {\r\n            return '-';\r\n        }\r\n\r\n        let options = {year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true};\r\n        return date.toLocaleString('en-US', options);\r\n    }\r\n\r\n    extractDate(text) {\r\n        if (!text) {\r\n            return null;\r\n        }\r\n        // Split on first colon and return the right part\r\n        const parts = text?.split(':');\r\n        if (parts.length > 1) {\r\n            const dateStr = parts.slice(1).join(':').trim();\r\n            // Return null if empty or invalid\r\n            return dateStr || null;\r\n        }\r\n\r\n        return text.trim() || null;\r\n    }\r\n\r\n\r\n    calculateDate(date) {\r\n        if (!date) {\r\n            return '-';\r\n        }\r\n        const date1 = new Date(date); // Due date (local time)\r\n        const now = new Date(); // Current date/time\r\n\r\n        // Calculate the difference in milliseconds\r\n        const diffMs = date1 - now;\r\n\r\n        // Convert to days, hours, minutes\r\n        if (diffMs <= 0) {\r\n            return \"Overdue\";\r\n        } else {\r\n            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\r\n            const diffHours = Math.floor((diffMs / (1000 * 60 * 60)) % 24);\r\n\r\n            return `${diffDays} days, ${diffHours} hours`;\r\n        }\r\n\r\n    }\r\n\r\n    fullPageModule(module) {\r\n        let current = this.module === 'quiz' ?\r\n            document.getElementById(`${module}_ifr`) : document.querySelector(`#${module}_ifr`);\r\n\r\n        let p1 = current.parentElement;\r\n        let p2 = p1.parentElement;\r\n        let p3 = p2.parentElement;\r\n        let p4 = p3.parentElement;\r\n\r\n        let statusBar = document.querySelector('.tox-statusbar__right-container > button');\r\n        let assignName = document.querySelector('.page-context-header');\r\n        let header = this.create('div');\r\n        let btn = null;\r\n\r\n        assignName.classList.remove('mb-2');\r\n        header.id = 'tiny_cursive-fullpage-custom-header';\r\n        Object.assign(header.style, {\r\n            backgroundColor: 'white',\r\n            display: 'flex',\r\n            justifyContent: 'space-between'\r\n        });\r\n\r\n        if (this.module === 'quiz') {\r\n            btn = document.querySelector('#mod_quiz-next-nav').cloneNode(true);\r\n            btn.className = 'tiny_cursive-fullpage-submit-btn';\r\n            btn.style.margin = '.5rem';\r\n        } else {\r\n            btn = this.create('input');\r\n            btn.className = 'tiny_cursive-fullpage-submit-btn';\r\n            btn.value = this.savechanges;\r\n            btn.type = 'submit';\r\n            btn.style.margin = '.5rem';\r\n        }\r\n\r\n        if (this.module === 'pdfannotator') {\r\n            const style = document.createElement('style');\r\n            style.id = 'cursiveForceStyle';\r\n            style.textContent = `\r\n                .path-mod-pdfannotator #comment-wrapper h4,\r\n                .path-mod-pdfannotator #comment-nav {\r\n                    margin: 0 !important;\r\n                }\r\n            `;\r\n            document.head.appendChild(style);\r\n        }\r\n\r\n        const leftSide = this.create('div');\r\n        const rightSide = this.create('div');\r\n        let commonStyle = {\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            margin: '0 1rem'\r\n        };\r\n\r\n        Object.assign(leftSide.style, commonStyle);\r\n        rightSide.id = 'tiny_cursive-fullpage-right-wrapper';\r\n        Object.assign(rightSide.style, commonStyle);\r\n\r\n        rightSide.appendChild(btn);\r\n        leftSide.appendChild(assignName.cloneNode(true));\r\n\r\n        header.appendChild(leftSide);\r\n        header.appendChild(rightSide);\r\n\r\n        p4.insertBefore(header, p4.firstChild);\r\n        p2.style.backgroundColor = '#efefef';\r\n        Object.assign(current.style, {\r\n            width: '750px',\r\n            minWidth: '750px',\r\n            boxShadow: '0 10px 15px -3px rgb(0 0 0/0.1),0 4px 6px -4px rgb(0 0 0/0.1)'\r\n        });\r\n\r\n        Object.assign(p1.style, {\r\n            display: 'flex',\r\n            justifyContent: 'center',\r\n            outline: 'none',\r\n            margin: '2rem 0 0'\r\n        });\r\n        const style = this.create('style');\r\n        style.id = 'tiny_cursive-fullpage-mode-style';\r\n        style.textContent = `\r\n            .tox.tox-edit-focus .tox-edit-area::before {\r\n                opacity: 0;\r\n            }`;\r\n        document.head.appendChild(style);\r\n\r\n        let iframeBody = current.contentDocument?.body || current.contentWindow?.document?.body;\r\n\r\n        if (iframeBody) {\r\n            iframeBody.style.padding = '0.5in';\r\n        }\r\n        p2.style.position = 'relative';\r\n        document.getElementById('cursive-fullpagemode-sidebar')?.remove();\r\n\r\n        let toggle = this.create('div');\r\n        toggle.id = 'cursive-fullpagemode-sidebar-toggle';\r\n        toggle.innerHTML = Icons.hamburger;\r\n        p2.appendChild(toggle);\r\n        p2.appendChild(this.docSideBar(statusBar));\r\n    }\r\n\r\n    normalizePage(editorId) {\r\n        document.getElementById('tiny_cursive-fullpage-custom-header')?.remove();\r\n        document.getElementById('cursive-fullpagemode-sidebar')?.remove();\r\n\r\n        let current = document.getElementById(editorId);\r\n        let p1 = current.parentElement;\r\n        let p2 = p1.parentElement;\r\n\r\n        Object.assign(p2.style, {\r\n            backgroundColor: \"\",\r\n            position: \"\"\r\n        });\r\n\r\n        Object.assign(current.style, {\r\n            width: '',\r\n            minWidth: '',\r\n            boxShadow: '',\r\n        });\r\n\r\n        Object.assign(p1.style, {\r\n            display: '',\r\n            justifyContent: '',\r\n            outline: '',\r\n            margin: ''\r\n        });\r\n\r\n        p1.classList.remove('tiny-cursive-editor-container');\r\n\r\n        let iframeBody = current.contentDocument?.body || current.contentWindow?.document?.body;\r\n        if (iframeBody) {\r\n            iframeBody.style.padding = '0';\r\n        }\r\n        document.head.querySelector('#tiny_cursive-fullpage-mode-style')?.remove();\r\n        document.head.querySelector('#cursiveForceStyle')?.remove();\r\n    }\r\n\r\n    checkForumSubject() {\r\n        const form = document.querySelector('#tiny_cursive-fullpage-right-wrapper > input');\r\n        const msg = this.subjectnot;\r\n\r\n        if (form) {\r\n            form.addEventListener('click', (e) => {\r\n                const subjectInput = document.getElementById('id_subject');\r\n                let content = this.editor.getContent().trim();\r\n                if (!subjectInput || subjectInput.value.trim() === '' || content === '') {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    this.editor.windowManager.alert(msg);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    getSidebarTitle() {\r\n        const [assign, discus, quiz, lesson] = this.getText('sbTitle');\r\n        switch (this.module) {\r\n            case 'assign':\r\n                return {title: assign, icon: Icons.assignment};\r\n            case 'forum':\r\n                return {title: discus, icon: Icons.forum};\r\n            case 'lesson':\r\n                return {title: lesson, icon: Icons.forum};\r\n            case 'quiz':\r\n                return {title: quiz, icon: Icons.quiz};\r\n            case 'pdfannotator':\r\n                return {title: 'PDF Annotation', icon: Icons.pdfannotator};\r\n            default:\r\n                return {title: 'Page', icon: Icons.quiz};\r\n        }\r\n    }\r\n\r\n    getTimerBlock(module) {\r\n        switch (module) {\r\n            case 'assign':\r\n                return document.querySelector('#mod_assign_timelimit_block > div > div');\r\n            case 'forum':\r\n                return document.querySelector('#mod_forum_timelimit_block');\r\n            case 'lesson':\r\n                return document.querySelector('#lesson-timer');\r\n            case 'quiz':\r\n                return document.querySelector('#quiz-time-left');\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    getQuestionId(editoId) {\r\n        try {\r\n            if (!editoId || typeof editoId !== 'string') {\r\n                return '';\r\n            }\r\n            return editoId.replace(/^q(\\d+):(\\d+)_.*$/, \"$1-$2\");\r\n        } catch (error) {\r\n            window.console.error('Error getting question ID:', error);\r\n            return '';\r\n        }\r\n    }\r\n\r\n    initStrings() {\r\n        [\r\n            this.details,\r\n            this.studentInfo,\r\n            this.progress,\r\n            this.description,\r\n            this.replyingto,\r\n            this.answeringto,\r\n            this.importantdates,\r\n            this.rubrics,\r\n            this.subStatus,\r\n            this.status,\r\n            this.draft,\r\n            this.draftnot,\r\n            this.lastModified,\r\n            this.gradings,\r\n            this.gradenot,\r\n            this.wordCount,\r\n            this.timeleft,\r\n            this.nolimit,\r\n            this.name,\r\n            this.userename,\r\n            this.course,\r\n            this.opened,\r\n            this.due,\r\n            this.overdue,\r\n            this.remaining,\r\n            this.savechanges,\r\n            this.subjectnot\r\n        ] = this.getText('docSideBar');\r\n    }\r\n\r\n    getText(key) {\r\n        return JSON.parse(localStorage.getItem(key)) || [];\r\n    }\r\n\r\n    create(tag) {\r\n        return document.createElement(tag);\r\n    }\r\n\r\n}"],"names":["constructor","User","Rubrics","submission","modulename","editor","quizInfo","module","moduleIcon","Icons","assignment","initStrings","normalMode","id","this","normalizePage","fullPageMode","fullPageModule","_this$editor2","forum","_this$editor3","_this$editor4","quiz","_this$editor5","lesson","_this$editor6","pdfannotator","_this$editor7","docSideBar","status","replyId","URL","window","location","href","searchParams","get","toggle","document","querySelector","timelimitBlock","getTimerBlock","headerInfo","getSidebarTitle","progressBar","courseName","courseDes","Dates","openDate","dueDate","container","create","Object","assign","className","style","width","overflow","crossBtn","innerHTML","close","addEventListener","transition","display","btnWrapper","padding","position","top","backgroundColor","append","header","headerTitle","textContent","title","details","fontWeight","headerIcon","prepend","cloneNode","wordCount","wordCounter","timerCountDown","content","createBox","bg","titleColor","icon","people","studentInfo","bodyHTML","generateStudentInfo","progress","trim","fileSubDiv","querySelectorAll","forEach","Element","verticalAlign","description","checkForumSubject","replyPost","replyingto","_this$editor8","questionId","getQuestionId","_this$editor9","question","intro","atob","answeringto","Number","open","time","importantdates","generateImportantDates","keys","length","rubrics","generateRubrics","subStatus","submissionStatus","box","heading","body","wrapper","rubric","rubricDiv","appendChild","values","levels","level","levelDiv","score","definition","statusWrapper","statusName","statusValue","isNew","current","draftnot","draft","modifiedWrapper","modifiedName","lastModified","modifiedValue","_submission$current2","timemodified","date","Date","formatDate","gradeWrapper","gradeName","gradings","gradeValue","grade","gradenot","labelDiv","label","value","fontSize","MutationObserver","newText","replace","observe","characterData","subtree","childList","timer","warningDiv","clone","remove","notificationManager","text","type","timerCount","timeleft","nolimit","user","course","nameWrapper","usernameWrapper","courseWrapper","nameLabel","nameValue","usernameLabel","usernameValue","courseLabel","courseValue","name","fullname","userename","username","due","openText","toLowerCase","dueText","includes","extractDate","openedWrapper","openedLabel","openedValue","opened","dueWrapper","dueLabel","dueValue","remainingWrapper","remainingLabel","remainingValue","remaining","calculateDate","toLocaleString","year","month","day","hour","minute","hour12","parts","split","slice","join","diffMs","Math","floor","getElementById","p1","parentElement","p2","p4","statusBar","assignName","btn","classList","justifyContent","margin","savechanges","createElement","head","leftSide","rightSide","commonStyle","alignItems","insertBefore","firstChild","minWidth","boxShadow","outline","iframeBody","contentDocument","contentWindow","_current$contentWindo","_current$contentWindo2","hamburger","editorId","_current$contentWindo3","_current$contentWindo4","form","msg","subjectnot","e","subjectInput","getContent","preventDefault","stopPropagation","windowManager","alert","discus","getText","editoId","error","console","overdue","key","JSON","parse","localStorage","getItem","tag"],"mappings":"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"}