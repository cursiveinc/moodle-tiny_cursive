define("tiny_cursive/document_view",["exports","tiny_cursive/svg_repo"],(function(_exports,_svg_repo){var obj;
/**
   * This module provides functionality for document view management in the Tiny editor,
   * including full page mode display and sidebar information
   * @module     tiny_cursive/document_view
   * @copyright  2025 Cursive Technology, Inc. <info@cursivetechnology.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_svg_repo=(obj=_svg_repo)&&obj.__esModule?obj:{default:obj};return _exports.default=class{constructor(User,Rubrics,submission,modulename){this.User=User,this.Rubrics=Rubrics,this.submission=submission,this.module=modulename}normalMode(){if("assign"===this.module){var _document$getElementB,_document$getElementB2,_current$contentDocum,_current$contentWindo,_current$contentWindo2,_document$head$queryS;null===(_document$getElementB=document.getElementById("tiny_cursive-fullpage-custom-header"))||void 0===_document$getElementB||_document$getElementB.remove(),null===(_document$getElementB2=document.getElementById("cursive-fullpagemode-sidebar"))||void 0===_document$getElementB2||_document$getElementB2.remove();let current=document.querySelector("#id_onlinetext_editor_ifr"),p1=current.parentElement,p2=p1.parentElement;p2.style.backgroundColor="",current.style.width="",current.style.minWidth="",current.style.boxShadow="",Object.assign(p1.style,{display:"",justifyContent:"",outline:"",margin:""}),p1.classList.remove("tiny-cursive-editor-container"),p2.style.position="";let iframeBody=(null===(_current$contentDocum=current.contentDocument)||void 0===_current$contentDocum?void 0:_current$contentDocum.body)||(null===(_current$contentWindo=current.contentWindow)||void 0===_current$contentWindo||null===(_current$contentWindo2=_current$contentWindo.document)||void 0===_current$contentWindo2?void 0:_current$contentWindo2.body);iframeBody&&(iframeBody.style.padding="0"),null===(_document$head$queryS=document.head.querySelector("#tiny_cursive-fullpage-mode-style"))||void 0===_document$head$queryS||_document$head$queryS.remove()}}fullPageMode(){if("assign"===this.module){var _current$contentDocum2,_current$contentWindo3,_current$contentWindo4,_document$getElementB3;let current=document.querySelector("#id_onlinetext_editor_ifr"),p1=current.parentElement,p2=p1.parentElement,p4=p2.parentElement.parentElement,statusBar=document.querySelector(".tox-statusbar__right-container > button"),assignName=document.querySelector(".page-context-header");assignName.classList.remove("mb-2");let header=this.create("div");header.id="tiny_cursive-fullpage-custom-header",header.style.backgroundColor="white",header.style.display="flex",header.style.justifyContent="space-between";let btn=this.create("input");btn.className="tiny_cursive-fullpage-submit-btn",btn.value="Save changes",btn.type="submit",btn.style.margin=".5rem";const leftSide=this.create("div");leftSide.style.display="flex",leftSide.style.alignItems="center",leftSide.style.margin="0 1rem";const rightSide=this.create("div");rightSide.style.display="flex",rightSide.style.alignItems="center",rightSide.style.margin="0 1rem",rightSide.id="tiny_cursive-fullpage-right-wrapper",rightSide.appendChild(btn),leftSide.appendChild(assignName.cloneNode(!0)),header.appendChild(leftSide),header.appendChild(rightSide),p4.insertBefore(header,p4.firstChild),p2.style.backgroundColor="#efefef",current.style.width="750px",current.style.minWidth="750px",current.style.boxShadow="0 10px 15px -3px rgb(0 0 0/0.1),0 4px 6px -4px rgb(0 0 0/0.1)",Object.assign(p1.style,{display:"flex",justifyContent:"center",outline:"none",margin:"2rem 0 0"});const style=this.create("style");style.id="tiny_cursive-fullpage-mode-style",style.textContent="\n        .tox.tox-edit-focus .tox-edit-area::before {\n            opacity: 0;\n        }\n        ",document.head.appendChild(style);let iframeBody=(null===(_current$contentDocum2=current.contentDocument)||void 0===_current$contentDocum2?void 0:_current$contentDocum2.body)||(null===(_current$contentWindo3=current.contentWindow)||void 0===_current$contentWindo3||null===(_current$contentWindo4=_current$contentWindo3.document)||void 0===_current$contentWindo4?void 0:_current$contentWindo4.body);iframeBody&&(iframeBody.style.padding="0.5in"),p2.style.position="relative",null===(_document$getElementB3=document.getElementById("cursive-fullpagemode-sidebar"))||void 0===_document$getElementB3||_document$getElementB3.remove(),p2.appendChild(this.docSideBar(statusBar))}}docSideBar(status){const container=this.create("div");container.id="cursive-fullpagemode-sidebar",container.className="bg-white h-100 shadow",container.style.width="300px",container.style.overflow="auto";const header=this.create("div");header.className="border-bottom p-4",header.style.position="sticky",header.style.top="0",header.style.backgroundColor="white";const headerTitle=this.create("h3");headerTitle.className="mb-1",headerTitle.textContent="Assignment Details",headerTitle.style.fontWeight="600";let wordCount=this.wordCounter(status);header.append(headerTitle,wordCount);const content=this.create("div");content.className="p-3";let courseName=document.querySelector("#page-navbar > nav > ol > li:nth-child(1) > a"),courseDes=document.querySelector("#intro"),Dates=document.querySelector(".activity-dates"),openDate=Dates.querySelector("div:nth-child(1)"),dueDate=Dates.querySelector("div:nth-child(2)");return content.append(this.createBox({bg:"bg-info",titleColor:"text-info",icon:_svg_repo.default.people,title:"Student Information",bodyHTML:this.generateStudentInfo(this.User,courseName)})),""!==courseDes.textContent.trim()&&content.append(this.createBox({bg:"bg-gray",titleColor:"text-dark",icon:_svg_repo.default.assignment,title:"Assignment Description",bodyHTML:courseDes.innerHTML})),Object.keys(this.Rubrics).length&&content.append(this.createBox({bg:"bg-gray",titleColor:"text-dark",icon:_svg_repo.default.assignment,title:"Assessment Rubrics",bodyHTML:this.generateRubrics(this.Rubrics)})),content.append(this.createBox({bg:"bg-amber",titleColor:"text-dark",icon:_svg_repo.default.time,title:"Important Dates",bodyHTML:this.generateImportantDates(openDate,dueDate)})),content.append(this.createBox({bg:"bg-green",titleColor:"text-success",icon:_svg_repo.default.assignment,title:"Submission Status",bodyHTML:this.submissionStatus(this.submission)})),container.append(header,content),container}createBox(_ref){let{bg:bg,titleColor:titleColor,icon:icon,title:title,bodyHTML:bodyHTML}=_ref;const box=this.create("div");box.className=`tiny_cursive-fullpage-card ${bg}`;const heading=this.create("h4");heading.className=`tiny_cursive-fullpage-card-header ${titleColor}  mb-2 d-flex align-items-center`,heading.innerHTML=`${icon} ${title}`;const body=this.create("div");return body.className="tiny_cursive-fullpage-card-body",body.innerHTML=bodyHTML,box.append(heading,body),box}generateRubrics(Rubrics){const wrapper=this.create("div");return Rubrics.forEach((rubric=>{const rubricDiv=this.create("div");rubricDiv.className="tiny_cursive-rubric-card";const title=this.create("h3");title.className="tiny_cursive-rubric-title",title.textContent=rubric.description,rubricDiv.appendChild(title),Object.values(rubric.levels).forEach((level=>{const levelDiv=this.create("div"),score=Number(level.score);levelDiv.className=0===score?"tiny_cursive-rubric-level tiny_cursive-rubric-low":score<=2?"tiny_cursive-rubric-level tiny_cursive-rubric-mid":"tiny_cursive-rubric-level tiny_cursive-rubric-high",levelDiv.textContent=`${level.definition} / ${level.score}`,rubricDiv.appendChild(levelDiv)})),wrapper.appendChild(rubricDiv)})),wrapper.innerHTML}submissionStatus(submission){var _submission$current;const wrapper=this.create("div"),statusWrapper=this.create("div");statusWrapper.className="tiny_cursive-status-row";const statusName=this.create("span");statusName.textContent="Status: ";const statusValue=this.create("span"),isNew="new"===submission.current.status;statusValue.textContent=isNew?"Draft (Not submitted)":"Draft (Submitted)",statusValue.className="tiny_cursive-status-value "+(isNew?"tiny_cursive-status-red":"tiny_cursive-status-green"),statusWrapper.append(statusName,statusValue);const modifiedWrapper=this.create("div");modifiedWrapper.className="tiny_cursive-status-row";const modifiedName=this.create("span");modifiedName.textContent="Last Modified: ";const modifiedValue=this.create("span");if(null!==(_submission$current=submission.current)&&void 0!==_submission$current&&_submission$current.timemodified){const date=new Date(1e3*submission.current.timemodified);modifiedValue.textContent=this.formatDate(date)}else modifiedValue.textContent="N/A";modifiedWrapper.append(modifiedName,modifiedValue);const gradeWrapper=this.create("div");gradeWrapper.className="tiny_cursive-status-row";const gradeName=this.create("span");gradeName.textContent="Grading Status: ";const gradeValue=this.create("span");return submission.grade?gradeValue.textContent=Number(submission.grade.grade)>0?submission.grade.grade:"Not graded":gradeValue.textContent="Not graded",gradeWrapper.append(gradeName,gradeValue),wrapper.append(statusWrapper,gradeWrapper,modifiedWrapper),wrapper.innerHTML}wordCounter(status){const wordCount=this.create("div");wordCount.className="tiny_cursive-word-counter",wordCount.textContent="0 words";return new MutationObserver((()=>{const newText=status.textContent.trim();wordCount.textContent=`${newText}`})).observe(status,{characterData:!0,subtree:!0,childList:!0}),wordCount}generateStudentInfo(user,course){const wrapper=this.create("div"),nameWrapper=this.create("div"),usernameWrapper=this.create("div"),courseWrapper=this.create("div"),nameLabel=this.create("span"),nameValue=this.create("span"),usernameLabel=this.create("span"),usernameValue=this.create("span"),courseLabel=this.create("span"),courseValue=this.create("span");return nameLabel.textContent="Name: ",nameValue.textContent=user.fullname,usernameLabel.textContent="Username: ",usernameValue.textContent=user.username,courseLabel.textContent="Course: ",courseValue.textContent=course.title,nameWrapper.className="d-flex justify-content-between",usernameWrapper.className="d-flex justify-content-between",courseWrapper.className="d-flex justify-content-between",nameWrapper.append(nameLabel,nameValue),usernameWrapper.append(usernameLabel,usernameValue),courseWrapper.append(courseLabel,courseValue),wrapper.append(nameWrapper,usernameWrapper,courseWrapper),wrapper.innerHTML}generateImportantDates(open,due){const wrapper=this.create("div"),openedWrapper=this.create("div"),dueWrapper=this.create("div"),remainingWrapper=this.create("div"),openedLabel=this.create("span"),openedValue=this.create("span"),dueLabel=this.create("span"),dueValue=this.create("span"),remainingLabel=this.create("span"),remainingValue=this.create("span");return openedLabel.textContent="Opened: ",openedValue.textContent=this.formatDate(new Date(open.textContent.replace("Opened:","").trim())),openedValue.className="text-dark",dueLabel.textContent="Due: ",dueValue.textContent=this.formatDate(new Date(due.textContent.replace("Due:","").trim())),dueValue.className="text-danger",remainingLabel.textContent="Remaining: ",remainingValue.textContent=this.calculateDate(due.textContent.replace("Due:","").trim()),remainingValue.className="text-danger",openedWrapper.className="d-flex justify-content-between",dueWrapper.className="d-flex justify-content-between",remainingWrapper.className="d-flex align-items-center justify-content-between mt-2 pt-2 border-top",openedWrapper.append(openedLabel,openedValue),dueWrapper.append(dueLabel,dueValue),remainingWrapper.append(remainingLabel,remainingValue),wrapper.append(openedWrapper,dueWrapper,remainingWrapper),wrapper.innerHTML}formatDate(date){return date.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0})}calculateDate(date){const diffMs=new Date(date)-new Date;if(diffMs<=0)return"Overdue";return`${Math.floor(diffMs/864e5)} days, ${Math.floor(diffMs/36e5%24)} hours`}create(tag){return document.createElement(tag)}},_exports.default}));

//# sourceMappingURL=document_view.min.js.map