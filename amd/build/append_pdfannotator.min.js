define("tiny_cursive/append_pdfannotator",["exports","core/ajax","tiny_cursive/analytic_button","tiny_cursive/replay_button","tiny_cursive/analytic_events","core/templates","tiny_cursive/replay"],(function(_exports,_ajax,_analytic_button,_replay_button,_analytic_events,_templates,_replay){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Module for handling PDF annotator functionality,
   *
   * @module     tiny_cursive/append_pdfannotator
   * @copyright  2025 Cursive Technology, Inc. <info@cursivetechnology.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_analytic_button=_interopRequireDefault(_analytic_button),_replay_button=_interopRequireDefault(_replay_button),_analytic_events=_interopRequireDefault(_analytic_events),_templates=_interopRequireDefault(_templates),_replay=_interopRequireDefault(_replay);_exports.init=(scoreSetting,comments,hasApiKey,userid)=>{const replayInstances={};window.video_playback=function(mid,filepath){if(""!==filepath){const replay=new _replay.default("content"+mid,filepath,10,!1,"player_"+mid);replayInstances[mid]=replay}else _templates.default.render("tiny_cursive/no_submission").then((html=>(document.getElementById("content"+mid).innerHTML=html,!0))).catch((e=>window.console.error(e)));return!1};let container=document.querySelector(".comment-list-container");const overviewTable=document.querySelector('table[id^="mod-pdfannotator-"]');document.addEventListener("click",(function(e){"commentSubmit"===e.target.id&&(localStorage.removeItem("isEditing"),buttonElement=e.target.value,pendingSubmit=!0);"commentCancel"===e.target.id&&(localStorage.removeItem("isEditing"),pendingSubmit=!1)}));const moduleName=document.body.id.split("-")[2];var pendingSubmit=!1,buttonElement="";if(container){new MutationObserver((()=>{var _container$lastChild;null!=container&&null!==(_container$lastChild=container.lastChild)&&void 0!==_container$lastChild&&_container$lastChild.id&&function(id){if("Save"===buttonElement)return void(pendingSubmit=!1);let resourceId=parseInt(null==id?void 0:id.split("_")[1]);if(resourceId&&pendingSubmit){pendingSubmit=!1,(async(methodname,args)=>{try{await(0,_ajax.call)([{methodname:methodname,args:args}])[0]}catch(error){throw window.console.error("updating Entries:",error),error}})("cursive_update_pdf_annote_id",{cmid:M.cfg.contextInstanceId,userid:M.cfg.userId??0,courseid:M.cfg.courseId,modulename:moduleName,resourceid:resourceId})}}(container.lastChild.id)})).observe(container,{subtree:!0,childList:!0})}if(overviewTable){let newChild=document.createElement("th");newChild.textContent="Analytics",overviewTable.querySelector("thead>tr>th:first-child").insertAdjacentElement("afterend",newChild),function(overviewTable){const rows=overviewTable.querySelectorAll("tbody > tr"),action=new URL(window.location.href).searchParams.get("action");rows.forEach((row=>{var _cols$col,_cols$col2,_cols$col3,_links$link,_userLink;const cols={col1:row.querySelector("td:nth-child(1)"),col2:row.querySelector("td:nth-child(2)"),col3:row.querySelector("td:nth-child(3)")},links={link1:null===(_cols$col=cols.col1)||void 0===_cols$col?void 0:_cols$col.querySelector("a"),link2:null===(_cols$col2=cols.col2)||void 0===_cols$col2?void 0:_cols$col2.querySelector("a"),link3:null===(_cols$col3=cols.col3)||void 0===_cols$col3?void 0:_cols$col3.querySelector("a")},commentId=null!==(_links$link=links.link1)&&void 0!==_links$link&&_links$link.href?new URL(links.link1.href).searchParams.get("commid"):null;let userId=null,userLink=null;switch(action){case"overviewquestions":userLink=links.link2;break;case"overviewanswers":userLink=links.link3;break;default:userId=userid}if(null!==(_userLink=userLink)&&void 0!==_userLink&&_userLink.href)try{userId=new URL(userLink.href).searchParams.get("id")}catch(e){window.console.warn("Error parsing user URL:",e)}!function(userid,resourceid,cmid,place){let args={id:resourceid,modulename:"pdfannotator",cmid:cmid},methodname="cursive_get_forum_comment_link",com=(0,_ajax.call)([{methodname:methodname,args:args}]);com[0].done((function(json){var data=JSON.parse(json),filepath="";data.data.filename&&(filepath=data.data.filename);let analyticButtonDiv=document.createElement("div"),analyticsColumn=document.createElement("td");hasApiKey?analyticButtonDiv.append((0,_analytic_button.default)(data.data.effort_ratio,resourceid)):analyticButtonDiv.append((0,_replay_button.default)(resourceid)),analyticButtonDiv.dataset.region="analytic-div"+userid,analyticsColumn.append(analyticButtonDiv),place.insertAdjacentElement("afterend",analyticsColumn);let myEvents=new _analytic_events.default;var context={tabledata:data.data,formattime:myEvents.formatedTime(data.data),page:scoreSetting,userid:resourceid,apikey:hasApiKey};let authIcon=myEvents.authorshipStatus(data.data.first_file,data.data.score,scoreSetting);myEvents.createModal(resourceid,context,"",replayInstances,authIcon),myEvents.analytics(resourceid,_templates.default,context,"",replayInstances,authIcon),myEvents.checkDiff(resourceid,data.data.file_id,"",replayInstances),myEvents.replyWriting(resourceid,filepath,"",replayInstances)})),com[0].fail((error=>{window.console.error("Error getting cursive config:",error)}))}(userId,commentId,M.cfg.contextInstanceId,cols.col1)}))}(overviewTable)}}}));

//# sourceMappingURL=append_pdfannotator.min.js.map