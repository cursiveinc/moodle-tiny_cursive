{"version":3,"file":"replay.min.js","sources":["../src/replay.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     tiny_cursive/replay\n * @category TinyMCE Editor\n * @copyright  CTI <info@cursivetechnology.com>\n * @author Brain Station 23 <elearning@brainstation-23.com>\n */\n\nimport {call as fetchJson} from 'core/ajax';\nimport templates from 'core/templates';\nimport * as Str from 'core/str';\n\nexport default class Replay {\n    constructor(elementId, filePath, speed = 1, loop = false, controllerId) {\n        // Initialize core properties\n        this.controllerId = controllerId || '';\n        this.replayInProgress = false;\n        this.speed = parseFloat(speed);\n        this.loop = loop;\n        this.highlightedChars = [];\n        this.deletedChars = [];\n        this.cursorPosition = 0;\n        this.currentEventIndex = 0;\n        this.totalEvents = 0;\n        this.currentTime = 0;\n        this.totalDuration = 0;\n        this.usercomments = [];\n        this.pasteTimestamps = [];\n        this.isPasteEvent = false;\n        this.isControlKeyPressed = false;\n        this.isShiftKeyPressed = false;\n        this.text = '';\n        this.pastedEvents = [];\n        this.currentPasteIndex = 0;\n        this.pastedChars = [];\n\n        const element = document.getElementById(elementId);\n        if (!element) {\n            throw new Error(`Element with id '${elementId}' not found`);\n        }\n        this.outputElement = element;\n\n        // Load JSON data and initialize replay\n        this.loadJSON(filePath).then(data => {\n            if (data.status) {\n                this.processData(data);\n                this.totalEvents = this.logData.length;\n                this.identifyPasteEvents();\n                if (this.controllerId && this.logData) {\n                    this.constructController(this.controllerId);\n                }\n                this.startReplay();\n            } else {\n                this.handleNoSubmission();\n            }\n            return data;\n        }).catch(error => {\n            this.handleNoSubmission();\n            window.console.error('Error loading JSON file:', error.message);\n        });\n        if (!localStorage.getItem('nopasteevent') || !localStorage.getItem('pasteEvent')) {\n            Str.get_string('nopasteevent', 'tiny_cursive').then(str => {\n                localStorage.setItem('nopasteevent', str);\n                return str;\n            });\n            Str.get_string('pasteEvent', 'tiny_cursive').then(str => {\n                localStorage.setItem('pasteEvent', str);\n                return str;\n            });\n        }\n    }\n\n    // Process JSON data and normalize timestamps\n    processData(data) {\n        this.logData = JSON.parse(data.data);\n        if (data.comments) {\n            this.usercomments = Array.isArray(JSON.parse(data.comments)) ? JSON.parse(data.comments) : [];\n        }\n        if ('data' in this.logData) {\n            this.logData = this.logData.data;\n        }\n        if ('payload' in this.logData) {\n            this.logData = this.logData.payload;\n        }\n        for (let i = 0; i < this.logData.length; i++) {\n            const event = this.logData[i];\n            if (event.event === 'Paste' && Array.isArray(event.pastedContent)) {\n                for (let j = 0; j < event.pastedContent.length; j++) {\n                    this.pastedEvents.push(event.pastedContent[j]);\n                }\n            }\n        }\n        if (this.logData.length > 0 && this.logData[0].unixTimestamp) {\n            const startTime = this.logData[0].unixTimestamp;\n            this.logData = this.logData.map(event => ({\n                ...event,\n                normalizedTime: event.unixTimestamp - startTime\n            }));\n            this.totalDuration = this.logData[this.logData.length - 1].normalizedTime;\n        }\n    }\n\n    async handleNoSubmission() {\n        try {\n            const [html, str] = await Promise.all([\n                templates.render('tiny_cursive/no_submission'),\n                Str.get_string('warningpayload', 'tiny_cursive')\n            ]);\n            const tempDiv = document.createElement('div');\n            tempDiv.innerHTML = html;\n            const newElement = tempDiv.firstChild;\n            newElement.textContent = str;\n\n            const tinyCursiveElements = document.querySelectorAll('.tiny_cursive');\n            tinyCursiveElements.forEach(element => {\n                element.innerHTML = '';\n                element.appendChild(newElement.cloneNode(true));\n            });\n\n            return true;\n        } catch (error) {\n            window.console.error(error);\n            return false;\n        }\n    }\n\n    // Stop the replay and update play button icon\n    stopReplay() {\n        if (this.replayInProgress) {\n            clearTimeout(this.replayTimeout);\n            this.replayInProgress = false;\n            if (this.playButton) {\n                const playSvg = document.createElement('img');\n                playSvg.src = M.util.image_url('playicon', 'tiny_cursive');\n                this.playButton.querySelector('.play-icon').innerHTML = playSvg.outerHTML;\n            }\n        }\n    }\n\n    // Build the replay control UI (play button, scrubber, speed controls)\n    constructController(controllerId) {\n        this.replayInProgress = false;\n        this.currentPosition = 0;\n        this.speed = 1;\n        if (this.replayIntervalId) {\n            clearInterval(this.replayIntervalId);\n            this.replayIntervalId = null;\n        }\n\n        const container = document.getElementById(controllerId);\n        if (!container) {\n            window.console.error('Container not found with ID:', controllerId);\n            return;\n        }\n\n        const controlContainer = container.querySelector('.tiny_cursive_replay_control');\n        if (!controlContainer) {\n            window.console.error('Replay control container not found in:', controllerId);\n            return;\n        }\n        controlContainer.innerHTML = '<span class=\"tiny_cursive_loading_spinner\"></span>';\n\n        this.buildControllerUI(controlContainer, container);\n        controlContainer.querySelector('.tiny_cursive_loading_spinner')?.remove();\n\n        controlContainer.classList.remove('d-none');\n    }\n\n    buildControllerUI(controlContainer, container) {\n        const topRow = document.createElement('div');\n        topRow.classList.add('tiny_cursive_top_row');\n\n        this.playButton = this.createPlayButton();\n        topRow.appendChild(this.playButton);\n\n        const scrubberContainer = this.createScrubberContainer();\n        topRow.appendChild(scrubberContainer);\n\n        this.timeDisplay = this.createTimeDisplay();\n        topRow.appendChild(this.timeDisplay);\n\n        const bottomRow = document.createElement('div');\n        bottomRow.classList.add('tiny_cursive_bottom_row');\n\n        const speedContainer = this.createSpeedControls();\n        bottomRow.appendChild(speedContainer);\n\n        const pasteEventsToggle = this.createPasteEventsToggle(container);\n        bottomRow.appendChild(pasteEventsToggle);\n\n        controlContainer.appendChild(topRow);\n        controlContainer.appendChild(bottomRow);\n        container.appendChild(this.pasteEventsPanel);\n    }\n\n    createPlayButton() {\n        const playButton = document.createElement('button');\n        playButton.classList.add('tiny_cursive_play_button');\n        const playSvg = document.createElement('i');\n        playButton.innerHTML = `<span class=\"play-icon\">${playSvg.outerHTML}</span>`;\n        playButton.addEventListener('click', () => {\n            if (this.replayInProgress) {\n                this.stopReplay();\n            } else {\n                this.startReplay(false);\n            }\n            document.querySelectorAll('.tiny_cursive-nav-tab .active').forEach(btn => btn.classList.remove('active'));\n            document.querySelectorAll('a[id^=\"rep\"]').forEach(btn => btn.classList.add('active'));\n        });\n        return playButton;\n    }\n\n    createScrubberContainer() {\n        const scrubberContainer = document.createElement('div');\n        scrubberContainer.classList.add('tiny_cursive_scrubber_container');\n        this.scrubberElement = document.createElement('input');\n        this.scrubberElement.classList.add('tiny_cursive_timeline_scrubber', 'timeline-scrubber');\n        this.scrubberElement.type = 'range';\n        this.scrubberElement.max = '100';\n        this.scrubberElement.min = '0';\n        this.scrubberElement.value = '0';\n        this.scrubberElement.addEventListener('input', () => {\n            this.skipToTime(parseInt(this.scrubberElement.value, 10));\n        });\n        scrubberContainer.appendChild(this.scrubberElement);\n        return scrubberContainer;\n    }\n\n    createTimeDisplay() {\n        const timeDisplay = document.createElement('div');\n        timeDisplay.classList.add('tiny_cursive_time_display');\n        timeDisplay.textContent = '00:00 / 00:00';\n        return timeDisplay;\n    }\n\n    createSpeedControls() {\n        const speedContainer = document.createElement('div');\n        speedContainer.classList.add('tiny_cursive_speed_controls', 'speed-controls');\n        const speedLabel = document.createElement('span');\n        speedLabel.classList.add('tiny_cursive_speed_label');\n        speedLabel.textContent = 'Speed: ';\n        speedContainer.appendChild(speedLabel);\n\n        const speedGroup = document.createElement('div');\n        speedGroup.classList.add('tiny_cursive_speed_group');\n        [1, 1.5, 2, 5, 10].forEach(speed => {\n            const speedBtn = document.createElement('button');\n            speedBtn.textContent = `${speed}x`;\n            speedBtn.classList.add('tiny_cursive_speed_btn', 'speed-btn');\n            if (parseFloat(speed) === this.speed) {\n                speedBtn.classList.add('active');\n            }\n            speedBtn.dataset.speed = speed;\n            speedBtn.addEventListener('click', () => {\n                document.querySelectorAll('.tiny_cursive_speed_btn').forEach(btn => btn.classList.remove('active'));\n                speedBtn.classList.add('active');\n                this.speed = parseFloat(speedBtn.dataset.speed);\n                if (this.replayInProgress) {\n                    this.stopReplay();\n                    this.startReplay(false);\n                }\n            });\n            speedGroup.appendChild(speedBtn);\n        });\n        speedContainer.appendChild(speedGroup);\n        return speedContainer;\n    }\n\n    createPasteEventsToggle(container) {\n        const pasteEventsToggle = document.createElement('div');\n        pasteEventsToggle.classList.add('tiny_cursive_paste_events_toggle', 'paste-events-toggle');\n\n        const pasteEventsIcon = document.createElement('span');\n        const pasteIcon = document.createElement('img');\n        pasteIcon.src = M.util.image_url('pasteicon', 'tiny_cursive');\n        pasteEventsIcon.innerHTML = pasteIcon.outerHTML;\n        pasteEventsIcon.classList.add('tiny_cursive_paste_events_icon');\n\n        const pasteEventsText = document.createElement('span');\n        pasteEventsText.textContent = localStorage.getItem('pasteEvent');\n\n        this.pasteEventCount = document.createElement('span');\n        this.pasteEventCount.textContent = `(${this.pasteTimestamps.length})`;\n        this.pasteEventCount.className = 'paste-event-count';\n        this.pasteEventCount.style.marginLeft = '2px';\n\n        const chevronIcon = document.createElement('span');\n        const chevron = document.createElement('i');\n        chevron.className = 'fa fa-chevron-down';\n        chevronIcon.innerHTML = chevron.outerHTML;\n        chevronIcon.style.marginLeft = '5px';\n        chevronIcon.style.transition = 'transform 0.3s ease';\n\n        pasteEventsToggle.appendChild(pasteEventsIcon);\n        pasteEventsToggle.appendChild(pasteEventsText);\n        pasteEventsToggle.appendChild(this.pasteEventCount);\n        pasteEventsToggle.appendChild(chevronIcon);\n\n        this.pasteEventsPanel = this.createPasteEventsPanel(container);\n        pasteEventsToggle.addEventListener('click', () => {\n            const isHidden = this.pasteEventsPanel.style.display === 'none';\n            this.pasteEventsPanel.style.display = isHidden ? 'block' : 'none';\n            chevronIcon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';\n        });\n\n        return pasteEventsToggle;\n    }\n\n    createPasteEventsPanel(container) {\n        const existingPanel = container.querySelector('.paste-events-panel');\n        if (existingPanel) {\n            existingPanel.remove();\n        }\n        const pasteEventsPanel = document.createElement('div');\n        pasteEventsPanel.classList.add('tiny_cursive_paste_events_panel', 'paste-events-panel');\n        pasteEventsPanel.style.display = 'none';\n        this.populatePasteEventsPanel(pasteEventsPanel);\n        return pasteEventsPanel;\n    }\n\n    // Detect Ctrl+V paste events and sync with user comments\n    identifyPasteEvents() {\n        this.pasteTimestamps = [];\n        let controlPressed = false;\n        /* eslint-disable no-unused-vars */\n        let shiftPressed = false;\n        let pasteCount = 0;\n\n        for (let i = 0; i < this.logData.length; i++) {\n            const event = this.logData[i];\n            if (event.event?.toLowerCase() === 'keydown') {\n                if (event.key === 'Control') {\n                    controlPressed = true;\n                } else if (event.key === 'Shift') {\n                    shiftPressed = true;\n                } else if ((event.key === 'v' || event.key === 'V') && controlPressed) {\n                    if (this.pastedEvents[pasteCount]) {\n                        const timestamp = event.normalizedTime || 0;\n                        this.pasteTimestamps.push({\n                            index: pasteCount,\n                            time: timestamp,\n                            formattedTime: this.formatTime(timestamp),\n                            pastedText: this.pastedEvents[pasteCount],\n                            timestamp\n                        });\n                    }\n                    pasteCount++;\n                    controlPressed = false;\n                    shiftPressed = false;\n                } else {\n                    controlPressed = false;\n                    shiftPressed = false;\n                }\n            }\n        }\n\n        if (this.usercomments.length > 0 && this.pasteTimestamps.length === 0) {\n            this.usercomments.forEach((comment, i) => {\n                this.pasteTimestamps.push({\n                    index: i,\n                    time: 0,\n                    formattedTime: this.formatTime(0),\n                    pastedText: comment,\n                    timestamp: 0\n                });\n            });\n        }\n\n        while (this.pasteTimestamps.length < this.usercomments.length) {\n            const lastIndex = this.pasteTimestamps.length;\n            this.pasteTimestamps.push({\n                index: lastIndex,\n                time: 0,\n                formattedTime: this.formatTime(0),\n                pastedText: this.usercomments[lastIndex],\n                timestamp: 0\n            });\n        }\n\n        if (this.pasteEventsPanel) {\n            this.populatePasteEventsPanel(this.pasteEventsPanel);\n        }\n    }\n\n    // Populate the paste events panel with navigation\n    populatePasteEventsPanel(panel) {\n        panel.innerHTML = '';\n        panel.classList.add('tiny_cursive_event_panel');\n\n        if (!this.pasteTimestamps.length) {\n            const noEventsMessage = document.createElement('div');\n            noEventsMessage.className = 'no-paste-events-message p-3';\n            noEventsMessage.textContent = localStorage.getItem('nopasteevent');\n            panel.appendChild(noEventsMessage);\n            return;\n        }\n\n        const carouselContainer = document.createElement('div');\n        carouselContainer.classList.add('tiny_cursive_paste_events_carousel', 'paste-events-carousel');\n\n        const navigationRow = document.createElement('div');\n        navigationRow.classList.add('paste-events-navigation', 'tiny_cursive_navigation_row');\n\n        const counterDisplay = document.createElement('div');\n        counterDisplay.classList.add('paste-events-counter', 'tiny_cursive_counter_display');\n        counterDisplay.textContent = 'Paste Events';\n\n        const navButtons = document.createElement('div');\n        navButtons.classList.add('tiny_cursive_nav_buttons');\n        const prevButton = document.createElement('button');\n        prevButton.classList.add('paste-event-prev-btn', 'tiny_cursive_nav_button');\n        prevButton.innerHTML = '<i class=\"fa fa-chevron-left\"></i>';\n\n        const nextButton = document.createElement('button');\n        nextButton.classList.add('paste-event-next-btn', 'tiny_cursive_nav_button');\n        nextButton.innerHTML = '<i class=\"fa fa-chevron-right\"></i>';\n        nextButton.disabled = this.pasteTimestamps.length <= 1;\n\n        navButtons.appendChild(prevButton);\n        navButtons.appendChild(nextButton);\n        navigationRow.appendChild(counterDisplay);\n        navigationRow.appendChild(navButtons);\n\n        const contentContainer = document.createElement('div');\n        contentContainer.className = 'paste-events-content tiny_cursive_content_container';\n        contentContainer.appendChild(this.createPasteEventDisplay(this.pasteTimestamps[0]));\n\n        carouselContainer.appendChild(navigationRow);\n        carouselContainer.appendChild(contentContainer);\n        panel.appendChild(carouselContainer);\n\n        let currentIndex = 0;\n        const updateDisplay = () => {\n            contentContainer.innerHTML = '';\n            contentContainer.appendChild(this.createPasteEventDisplay(this.pasteTimestamps[currentIndex]));\n            counterDisplay.textContent = 'Paste Events';\n            prevButton.disabled = currentIndex === 0;\n            prevButton.style.opacity = currentIndex === 0 ? '0.5' : '1';\n            nextButton.disabled = currentIndex === this.pasteTimestamps.length - 1;\n            nextButton.style.opacity = currentIndex === this.pasteTimestamps.length - 1 ? '0.5' : '1';\n        };\n\n        prevButton.addEventListener('click', () => {\n            if (currentIndex > 0) {\n                currentIndex--;\n                updateDisplay();\n            }\n        });\n\n        nextButton.addEventListener('click', () => {\n            if (currentIndex < this.pasteTimestamps.length - 1) {\n                currentIndex++;\n                updateDisplay();\n            }\n        });\n    }\n\n    createPasteEventDisplay(pasteEvent) {\n        const eventRow = document.createElement('div');\n        eventRow.className = 'tiny_cursive_event_row';\n\n        const headerRow = document.createElement('div');\n        headerRow.className = 'tiny_cursive_header_row';\n\n        const textContainer = document.createElement('div');\n        textContainer.className = 'tiny_cursive_text_container';\n\n        const timestampContainer = document.createElement('div');\n        timestampContainer.className = 'paste-event-timestamp tiny_cursive_paste_event_timestamp';\n        timestampContainer.textContent = pasteEvent.formattedTime;\n\n        const pastedTextContainer = document.createElement('div');\n        pastedTextContainer.className = 'paste-event-text tiny_cursive_pasted_text_container';\n        pastedTextContainer.textContent = pasteEvent.pastedText;\n\n        textContainer.appendChild(timestampContainer);\n        textContainer.appendChild(pastedTextContainer);\n\n        const playButton = document.createElement('button');\n        playButton.className = 'paste-event-play-btn tiny_cursive_seekplay_button';\n        const playIcon = document.createElement('img');\n        playIcon.src = M.util.image_url('seekplayicon', 'tiny_cursive');\n        playButton.innerHTML = playIcon.outerHTML;\n        playButton.addEventListener('click', () => this.jumpToTimestamp(pasteEvent.timestamp));\n\n        headerRow.appendChild(textContainer);\n        headerRow.appendChild(playButton);\n        eventRow.appendChild(headerRow);\n\n        return eventRow;\n    }\n\n    // Jump to a specific timestamp in the replay\n    jumpToTimestamp(timestamp) {\n        const percentage = this.totalDuration > 0 ? (timestamp / this.totalDuration) * 100 : 0;\n        this.skipToTime(percentage);\n        if (!this.replayInProgress) {\n            this.startReplay(false);\n        }\n    }\n\n    setScrubberVal(value) {\n        if (this.scrubberElement) {\n            this.scrubberElement.value = String(value);\n            if (this.timeDisplay) {\n                const displayTime = Math.min(this.currentTime, this.totalDuration);\n                this.timeDisplay.textContent = `${this.formatTime(displayTime)} / ${this.formatTime(this.totalDuration)}`;\n            }\n        }\n    }\n\n    loadJSON(filePath) {\n        return fetchJson([{\n            methodname: 'cursive_get_reply_json',\n            args: {filepath: filePath}\n        }])[0].done(response => response).fail(error => {\n            throw new Error(`Error loading JSON file: ${error.message}`);\n        });\n    }\n\n    formatTime(ms) {\n        const seconds = Math.floor(ms / 1000);\n        const minutes = Math.floor(seconds / 60);\n        const remainingSeconds = seconds % 60;\n        return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;\n    }\n\n    // Start or restart the replay\n    startReplay(reset = true) {\n        if (this.replayInProgress) {\n            clearTimeout(this.replayTimeout);\n        }\n        const atEnd = (this.totalDuration > 0 && this.currentTime >= this.totalDuration) ||\n            (this.currentEventIndex >= this.totalEvents);\n        if (atEnd && !reset) {\n            reset = true;\n        }\n        this.replayInProgress = true;\n        if (reset) {\n            this.outputElement.innerHTML = '';\n            this.text = '';\n            this.cursorPosition = 0;\n            this.currentEventIndex = 0;\n            this.currentTime = 0;\n            this.highlightedChars = [];\n            this.deletedChars = [];\n            this.isControlKeyPressed = false;\n            this.currentPasteIndex = 0;\n            this.pastedChars = [];\n        }\n        if (this.playButton) {\n            const pauseSvg = document.createElement('i');\n            pauseSvg.className = 'fa fa-pause';\n            this.playButton.querySelector('.play-icon').innerHTML = pauseSvg.outerHTML;\n        }\n        this.replayLog();\n    }\n\n    // Process events in sequence to simulate typing\n    replayLog() {\n        if (!this.replayInProgress) {\n            this.updateDisplayText(this.text, this.cursorPosition, [], []);\n            return;\n        }\n\n        while (this.currentEventIndex < this.logData.length) {\n            const event = this.logData[this.currentEventIndex];\n            if (event.normalizedTime && event.normalizedTime > this.currentTime) {\n                break;\n            }\n\n            let text = this.text || '';\n            let cursor = this.cursorPosition;\n            let updatedHighlights = [...this.highlightedChars];\n            let updatedDeleted = [...this.deletedChars];\n\n            if (event.rePosition !== undefined && (this.currentEventIndex === 0 ||\n                event.event === 'mouseDown' || event.event === 'mouseUp')) {\n                cursor = Math.max(0, Math.min(event.rePosition, text.length));\n            }\n\n            if (event.event?.toLowerCase() === 'keydown') {\n                ({text, cursor, updatedHighlights, updatedDeleted} =\n                    this.processKeydownEvent(event, text, cursor, updatedHighlights, updatedDeleted));\n            }\n\n            this.text = text;\n            this.cursorPosition = cursor;\n            this.highlightedChars = updatedHighlights.filter(h => !h.expiresAt || h.expiresAt > this.currentTime);\n            this.deletedChars = updatedDeleted.filter(d => !d.expiresAt || d.expiresAt > this.currentTime);\n\n            this.currentEventIndex++;\n        }\n\n        this.updateDisplayText(this.text, this.cursorPosition, this.highlightedChars, this.deletedChars);\n        if (this.totalDuration > 0) {\n            const percentComplete = Math.min((this.currentTime / this.totalDuration) * 100, 100);\n            this.setScrubberVal(percentComplete);\n        }\n\n        if (this.replayInProgress) {\n            const baseIncrement = 100;\n            const incrementTime = baseIncrement / this.speed;\n            this.currentTime += baseIncrement;\n            if (this.currentEventIndex >= this.totalEvents) {\n                if (this.loop) {\n                    this.startReplay(true);\n                } else {\n                    this.stopReplay();\n                    this.updateDisplayText(this.text, this.cursorPosition, [], []);\n                }\n            } else {\n                this.replayTimeout = setTimeout(() => this.replayLog(), incrementTime);\n            }\n        }\n    }\n\n    getLineAndColumn(text, pos) {\n        const before = text.substring(0, pos);\n        const lineIndex = before.split('\\n').length - 1;\n        const col = before.length - before.lastIndexOf('\\n') - 1;\n        return {lineIndex, col};\n    }\n\n    // Handle keydown events (e.g., typing, backspace, Ctrl+V)\n    processKeydownEvent(event, text, cursor, highlights, deletions) {\n        const key = event.key;\n        const charToInsert = this.applyKey(key);\n        this.updateModifierStates(key);\n        if ((key === 'v'|| key === 'V') && this.isControlKeyPressed) {\n            if (this.pastedEvents && this.currentPasteIndex < this.pastedEvents.length) {\n                const pastedContent = this.pastedEvents[this.currentPasteIndex];\n                ({text, cursor} = this.handlePasteInsert(pastedContent, text, cursor));\n                this.currentPasteIndex++;\n                this.isControlKeyPressed = false;\n                this.isShiftKeyPressed = false;\n                this.isPasteEvent = false;\n                return {\n                    text,\n                    cursor,\n                    updatedHighlights: highlights,\n                    updatedDeleted: deletions\n                };\n            }\n        }\n        if (this.isCtrlBackspace(key, cursor)) {\n            ({text, cursor} = this.handleCtrlBackspace(text, cursor, deletions));\n        } else if (this.isCtrlDelete(key, cursor, text)) {\n            ({text} = this.handleCtrlDelete(text, cursor, deletions));\n        } else if (this.isCtrlArrowMove(key)) {\n            cursor = this.handleCtrlArrowMove(key, text, cursor);\n        } else if (this.isRegularBackspace(key, cursor)) {\n            ({text, cursor} = this.handleBackspace(text, cursor, deletions));\n        } else if (this.isRegularDelete(key, cursor, text)) {\n            ({text} = this.handleDelete(text, cursor, deletions));\n        } else if (this.isArrowUp(key)) {\n            cursor = this.handleArrowUp(text, cursor);\n        } else if (this.isArrowDown(key)) {\n            cursor = this.handleArrowDown(text, cursor);\n        } else if (this.isRegularArrowMove(key)) {\n            cursor = this.handleArrowMove(key, text, cursor);\n        } else if (charToInsert && charToInsert.length > 0) {\n            ({text, cursor} = this.handleCharacterInsert(charToInsert, text, cursor, highlights));\n        }\n        return {\n            text,\n            cursor,\n            updatedHighlights: highlights,\n            updatedDeleted: deletions\n        };\n    }\n\n    // Handle Paste events to highlight pasted text\n    handlePasteInsert(pastedContent, text, cursor) {\n        const insertText = pastedContent || '';\n        text = text.substring(0, cursor) + insertText + text.substring(cursor);\n\n        // Mark characters as pasted for bold styling\n        if (insertText.trim() !== '') {\n            for (let i = 0; i < insertText.length; i++) {\n                if (!this.pastedChars) {\n                    this.pastedChars = [];\n                }\n                this.pastedChars.push({\n                    index: cursor + i,\n                    chars: insertText[i]\n                });\n            }\n        }\n\n        return {text, cursor: cursor + insertText.length};\n    }\n\n    // Adjusts pasted chars indices after deletion to maintain styling for pasted text\n    shiftPastedCharsIndices(startIndex, numDeleted) {\n        this.pastedChars = this.pastedChars.map(p => {\n            if (p.index >= startIndex + numDeleted) {\n                return {...p, index: p.index - numDeleted};\n            } else if (p.index >= startIndex && p.index < startIndex + numDeleted) {\n                // Remove pasted characters that were deleted\n                return null;\n            }\n            return p;\n        }).filter(p => p !== null);\n    }\n\n    // Update state for modifier keys (Control, paste events)\n    updateModifierStates(key) {\n        if (key === 'Control') {\n            this.isControlKeyPressed = true;\n        } else if (key === 'Shift') {\n            this.isShiftKeyPressed = true;\n        } else if ((key === 'v' || key === 'V') && this.isControlKeyPressed) {\n            this.isPasteEvent = true;\n        } else if (!['Control', 'Backspace', 'Delete', 'ArrowLeft', 'ArrowRight'].includes(key)) {\n            this.isControlKeyPressed = false;\n            this.isShiftKeyPressed = false;\n            this.isPasteEvent = false;\n        }\n    }\n\n    isCtrlBackspace(key, cursor) {\n        return key === 'Backspace' && this.isControlKeyPressed && cursor > 0;\n    }\n\n    isCtrlDelete(key, cursor, text) {\n        return key === 'Delete' && this.isControlKeyPressed && cursor < text.length;\n    }\n\n    isCtrlArrowMove(key) {\n        return this.isControlKeyPressed && (key === 'ArrowLeft' || key === 'ArrowRight');\n    }\n\n    isRegularBackspace(key, cursor) {\n        return key === 'Backspace' && !this.isPasteEvent && cursor > 0;\n    }\n\n    isRegularDelete(key, cursor, text) {\n        return key === 'Delete' && !this.isControlKeyPressed && cursor < text.length;\n    }\n\n    isRegularArrowMove(key) {\n        return !this.isControlKeyPressed && (key === 'ArrowLeft' || key === 'ArrowRight');\n    }\n\n    isArrowUp(key) {\n        return key === 'ArrowUp';\n    }\n\n    isArrowDown(key) {\n        return key === 'ArrowDown';\n    }\n\n    handleCtrlArrowMove(key, text, cursor) {\n        return key === 'ArrowLeft'\n            ? this.findPreviousWordBoundary(text, cursor)\n            : this.findNextWordBoundary(text, cursor);\n    }\n\n    handleBackspace(text, cursor, deletions) {\n        deletions.push({\n            index: cursor - 1,\n            chars: text[cursor - 1],\n            time: this.currentTime,\n            expiresAt: this.currentTime + 2000\n        });\n        this.shiftPastedCharsIndices(cursor - 1, 1);\n        return {\n            text: text.substring(0, cursor - 1) + text.substring(cursor),\n            cursor: cursor - 1\n        };\n    }\n\n    handleDelete(text, cursor, deletions) {\n        deletions.push({\n            index: cursor,\n            chars: text[cursor],\n            time: this.currentTime,\n            expiresAt: this.currentTime + 2000\n        });\n        this.shiftPastedCharsIndices(cursor, 1);\n        return {\n            text: text.substring(0, cursor) + text.substring(cursor + 1),\n            cursor\n        };\n    }\n\n    handleArrowMove(key, text, cursor) {\n        return key === 'ArrowLeft'\n            ? Math.max(0, cursor - 1)\n            : Math.min(text.length, cursor + 1);\n    }\n\n    handleCharacterInsert(charToInsert, text, cursor, highlights) {\n        text = text.substring(0, cursor) + charToInsert + text.substring(cursor);\n        // Shift pasted chars indices after the insertion point\n        if (this.pastedChars) {\n            this.pastedChars = this.pastedChars.map(p => {\n                return p.index >= cursor ? {...p, index: p.index + 1} : p;\n            });\n        }\n        if (charToInsert.trim() !== '') {\n            highlights.push({\n                index: cursor,\n                chars: charToInsert,\n                time: this.currentTime,\n                expiresAt: this.currentTime + 1500\n            });\n        }\n        return {text, cursor: cursor + 1};\n    }\n\n    handleCtrlDelete(text, cursor, deletions) {\n        const wordEnd = this.findNextWordBoundary(text, cursor);\n        const wordToDelete = text.substring(cursor, wordEnd);\n        for (let i = 0; i < wordToDelete.length; i++) {\n            deletions.push({\n                index: cursor + i,\n                chars: wordToDelete[i],\n                time: this.currentTime,\n                expiresAt: this.currentTime + 2000\n            });\n        }\n        this.shiftPastedCharsIndices(cursor, wordToDelete.length);\n        return {\n            text: text.substring(0, cursor) + text.substring(wordEnd),\n            cursor\n        };\n    }\n\n    handleArrowUp(text, cursor) {\n        const lines = text.split('\\n');\n        const {lineIndex, col} = this.getLineAndColumn(text, cursor);\n        if (lineIndex > 0) {\n            const prevLine = lines[lineIndex - 1];\n            cursor = lines.slice(0, lineIndex - 1).join('\\n').length + 1 + Math.min(col, prevLine.length);\n        } else {\n            cursor = 0;\n        }\n        return cursor;\n    }\n\n    handleArrowDown(text, cursor) {\n        const lines = text.split('\\n');\n        const {lineIndex, col} = this.getLineAndColumn(text, cursor);\n        if (lineIndex < lines.length - 1) {\n            const nextLine = lines[lineIndex + 1];\n            cursor = lines.slice(0, lineIndex + 1).join('\\n').length + 1 + Math.min(col, nextLine.length);\n        } else {\n            cursor = text.length;\n        }\n        return cursor;\n    }\n\n    handleCtrlBackspace(text, cursor, deletions) {\n        let wordStart = cursor;\n        while (wordStart > 0 && text[wordStart - 1] === ' ') {\n            wordStart--;\n        }\n        while (wordStart > 0 && text[wordStart - 1] !== ' ') {\n            wordStart--;\n        }\n        const wordToDelete = text.substring(wordStart, cursor);\n        for (let i = 0; i < wordToDelete.length; i++) {\n            deletions.push({\n                index: wordStart + i,\n                chars: wordToDelete[i],\n                time: this.currentTime,\n                expiresAt: this.currentTime + 2000\n            });\n        }\n        this.shiftPastedCharsIndices(wordStart, wordToDelete.length);\n        return {text: text.substring(0, wordStart) + text.substring(cursor), cursor: wordStart};\n    }\n\n    // Finds the index of the next word boundary after the cursor position\n    findNextWordBoundary(text, cursor) {\n        if (!text || cursor >= text.length) {\n            return cursor;\n        }\n        if (text[cursor] === ' ') {\n            while (cursor < text.length && text[cursor] === ' ') {\n                 cursor++;\n            }\n        }\n        if (cursor >= text.length) {\n            let lastNonSpace = text.length - 1;\n            while (lastNonSpace >= 0 && text[lastNonSpace] === ' ') {\n                 lastNonSpace--;\n            }\n            return lastNonSpace + 1;\n        }\n        let wordEnd = cursor;\n        while (wordEnd < text.length && text[wordEnd] !== ' ') {\n             wordEnd++;\n         }\n        return wordEnd;\n    }\n\n    // Finds the index of the previous word boundary before the cursor position\n    findPreviousWordBoundary(text, cursor) {\n        if (cursor <= 0) {\n            return 0;\n        }\n        let pos = cursor - 1;\n        while (pos > 0 && (text[pos] === ' ' || text[pos] === '\\n')) {\n             pos--;\n        }\n        while (pos > 0 && text[pos - 1] !== ' ' && text[pos - 1] !== '\\n') {\n             pos--;\n        }\n\n        return pos;\n    }\n\n    skipToEnd() {\n        if (this.replayInProgress) {\n            this.replayInProgress = false;\n        }\n        let textOutput = \"\";\n        this.logData.forEach(event => {\n            if (event.event.toLowerCase() === 'keydown') {\n                textOutput = this.applyKey(event.key, textOutput);\n            }\n        });\n        this.outputElement.innerHTML = textOutput.slice(0, -1);\n        this.setScrubberVal(100);\n    }\n\n    // Used by the scrubber to skip to a certain percentage of data\n    skipToTime(percentage) {\n        const wasPlaying = this.replayInProgress;\n        this.stopReplay();\n\n        const targetTime = (this.totalDuration * percentage) / 100;\n        this.currentTime = targetTime;\n        this.currentEventIndex = 0;\n        this.text = '';\n        this.cursorPosition = 0;\n        this.highlightedChars = [];\n        this.deletedChars = [];\n        this.isControlKeyPressed = false;\n        this.isPasteEvent = false;\n        this.pastedChars = []; // Reset pasted characters tracking\n        this.currentPasteIndex = 0;\n        let text = '';\n        let cursor = 0;\n        let highlights = [];\n        let deletions = [];\n        let pasteIndex = 0;\n\n        for (let i = 0; i < this.logData.length; i++) {\n            const event = this.logData[i];\n            if (event.normalizedTime && event.normalizedTime > targetTime) {\n                this.currentEventIndex = i;\n                break;\n            }\n            if (event.rePosition !== undefined && (i === 0 || event.event === 'mouseDown' || event.event === 'mouseUp')) {\n                cursor = Math.max(0, Math.min(event.rePosition, text.length));\n            }\n            if (event.event?.toLowerCase() === 'keydown') {\n                this.currentPasteIndex = pasteIndex;\n                if ((event.key === 'v' || event.key === 'V') && this.isControlKeyPressed) {\n                    pasteIndex++;\n                }\n                ({text, cursor, updatedHighlights: highlights, updatedDeleted: deletions} =\n                    this.processKeydownEvent(event, text, cursor, highlights, deletions));\n            }\n            this.currentEventIndex = i + 1;\n        }\n\n        this.currentPasteIndex = pasteIndex;\n        this.text = text;\n        this.cursorPosition = cursor;\n        this.highlightedChars = highlights.filter(h => !h.expiresAt || h.expiresAt > targetTime);\n        this.deletedChars = deletions.filter(d => !d.expiresAt || d.expiresAt > targetTime);\n        this.updateDisplayText(this.text, this.cursorPosition, this.highlightedChars, this.deletedChars);\n        this.setScrubberVal(percentage);\n\n        if (wasPlaying) {\n            this.replayInProgress = true;\n            this.replayLog();\n        }\n    }\n\n    // Update display with text, cursor, highlights and deletions\n    updateDisplayText(text, cursorPosition, highlights, deletions) {\n        let html = '';\n        const highlightMap = {};\n        const deletionMap = {};\n        const pastedMap = {};\n        const currentTime = this.currentTime;\n\n        highlights.forEach(h => {\n            let opacity = 1;\n            if (h.expiresAt && h.expiresAt - currentTime < 500) {\n                opacity = Math.max(0, (h.expiresAt - currentTime) / 500);\n            }\n            highlightMap[h.index] = {chars: h.chars, opacity};\n        });\n\n        deletions.forEach(d => {\n            let opacity = 0.5;\n            if (d.expiresAt && d.expiresAt - currentTime < 500) {\n                opacity = Math.max(0, ((d.expiresAt - currentTime) / 500) * 0.5);\n            }\n            deletionMap[d.index] = {chars: d.chars, opacity};\n        });\n\n        // Process pasted characters for bold styling\n        if (this.pastedChars) {\n            this.pastedChars.forEach(p => {\n                if (p.index < text.length) {\n                    pastedMap[p.index] = true;\n                }\n            });\n        }\n\n        // Find if we have out-of-bounds deletions (from Control+Backspace)\n        const outOfRangeDeletions = deletions.filter(d => d.index >= text.length);\n        const textLines = text.split('\\n');\n        let currentPosition = 0;\n\n        for (let lineIndex = 0; lineIndex < textLines.length; lineIndex++) {\n            const line = textLines[lineIndex];\n            for (let i = 0; i < line.length; i++) {\n                if (currentPosition === cursorPosition) {\n                    html += '<span class=\"tiny_cursive-cursor\"></span>';\n                }\n                const char = line[i];\n                if (deletionMap[currentPosition]) {\n                    html += `<span class=\"tiny_cursive-deleted-char\" style=\"opacity:\n                        ${deletionMap[currentPosition].opacity};\">${deletionMap[currentPosition].chars}</span>`;\n                }\n                const isPasted = pastedMap[currentPosition];\n                const isHighlighted = highlightMap[currentPosition] && char !== ' ';\n\n                if (isPasted && isHighlighted) {\n                    // Character is both pasted and recently typed (highlighted) - show bold with highlight\n                    html += `<span class=\"tiny_cursive-pasted-char tiny_cursive-highlighted-char\" style=\"opacity:\n                        ${highlightMap[currentPosition].opacity};\">${char}</span>`;\n                } else if (isPasted) {\n                    // Character is pasted - show in bold\n                    html += `<span class=\"tiny_cursive-pasted-char\">${char === ' ' ? ' ' : this.escapeHtml(char)}</span>`;\n                } else if (isHighlighted) {\n                    // Character is recently typed - show with green highlight\n                    html += `<span class=\"tiny_cursive-highlighted-char\" style=\"opacity:\n                        ${highlightMap[currentPosition].opacity};\">${char}</span>`;\n                } else {\n                    // Regular character\n                    html += char === ' ' ? ' ' : this.escapeHtml(char);\n                }\n                currentPosition++;\n            }\n            if (currentPosition === cursorPosition) {\n                html += '<span class=\"tiny_cursive-cursor\"></span>';\n            }\n            if (lineIndex < textLines.length - 1) {\n                html += '<br>';\n                currentPosition++;\n            }\n        }\n\n        if (cursorPosition === text.length && !html.endsWith('<span class=\"tiny_cursive-cursor\"></span>')) {\n            html += '<span class=\"tiny_cursive-cursor\"></span>';\n        }\n\n        if (outOfRangeDeletions.length > 0) {\n            outOfRangeDeletions.sort((a, b) => a.index - b.index);\n            const cursorHTML = '<span class=\"tiny_cursive-cursor\"></span>';\n            const cursorPos = html.lastIndexOf(cursorHTML);\n            if (cursorPos !== -1) {\n                let deletedWordHTML = '<span class=\"tiny_cursive-deleted-char\" style=\"opacity: 0.5;\">';\n                outOfRangeDeletions.forEach(d => {\n                    deletedWordHTML += d.chars;\n                });\n                deletedWordHTML += '</span>';\n                html = html.substring(0, cursorPos) + deletedWordHTML + html.substring(cursorPos);\n            }\n        }\n\n        const wasScrolledToBottom = this.outputElement.scrollHeight -\n            this.outputElement.clientHeight <= this.outputElement.scrollTop + 1;\n        this.outputElement.innerHTML = html;\n\n        if (wasScrolledToBottom || this.isCursorBelowViewport()) {\n            this.outputElement.scrollTop = this.outputElement.scrollHeight;\n        }\n    }\n\n    // Check if cursor is below visible viewport\n    isCursorBelowViewport() {\n        const cursorElement = this.outputElement.querySelector('.tiny_cursive-cursor:last-of-type');\n        if (!cursorElement) {\n            return false;\n        }\n\n        const cursorRect = cursorElement.getBoundingClientRect();\n        const outputRect = this.outputElement.getBoundingClientRect();\n\n        return cursorRect.bottom > outputRect.bottom;\n    }\n\n    escapeHtml(unsafe) {\n        return unsafe\n            .replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/\"/g, '&quot;')\n            .replace(/'/g, '&#039;');\n    }\n\n    // Used in various places to add a keydown, backspace, etc. to the output\n    applyKey(key) {\n        switch (key) {\n            case 'Enter':\n                return '\\n';\n            case 'Backspace':\n            case 'Delete':\n            case 'ControlBackspace':\n                return '';\n            case ' ':\n                 return ' ';\n            default:\n                return !['Shift', 'Ctrl', 'Alt', 'ArrowDown', 'ArrowUp', 'Control', 'ArrowRight',\n                    'ArrowLeft', 'Meta', 'CapsLock', 'Tab', 'Escape', 'Delete', 'PageUp', 'PageDown',\n                    'Insert', 'Home', 'End', 'NumLock', 'AudioVolumeUp', 'AudioVolumeDown',\n                    'MediaPlayPause', 'F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10',\n                    'F11', 'F12', 'PrintScreen', 'UnIdentified'].includes(key) ? key : '';\n        }\n    }\n}\n"],"names":["constructor","elementId","filePath","speed","loop","controllerId","replayInProgress","parseFloat","highlightedChars","deletedChars","cursorPosition","currentEventIndex","totalEvents","currentTime","totalDuration","usercomments","pasteTimestamps","isPasteEvent","isControlKeyPressed","isShiftKeyPressed","text","pastedEvents","currentPasteIndex","pastedChars","element","document","getElementById","Error","outputElement","loadJSON","then","data","status","processData","this","logData","length","identifyPasteEvents","constructController","startReplay","handleNoSubmission","catch","error","window","console","message","localStorage","getItem","Str","get_string","str","setItem","JSON","parse","comments","Array","isArray","payload","i","event","pastedContent","j","push","unixTimestamp","startTime","map","normalizedTime","html","Promise","all","templates","render","tempDiv","createElement","innerHTML","newElement","firstChild","textContent","querySelectorAll","forEach","appendChild","cloneNode","stopReplay","clearTimeout","replayTimeout","playButton","playSvg","src","M","util","image_url","querySelector","outerHTML","currentPosition","replayIntervalId","clearInterval","container","controlContainer","buildControllerUI","remove","classList","topRow","add","createPlayButton","scrubberContainer","createScrubberContainer","timeDisplay","createTimeDisplay","bottomRow","speedContainer","createSpeedControls","pasteEventsToggle","createPasteEventsToggle","pasteEventsPanel","addEventListener","btn","scrubberElement","type","max","min","value","skipToTime","parseInt","speedLabel","speedGroup","speedBtn","dataset","pasteEventsIcon","pasteIcon","pasteEventsText","pasteEventCount","className","style","marginLeft","chevronIcon","chevron","transition","createPasteEventsPanel","isHidden","display","transform","existingPanel","populatePasteEventsPanel","controlPressed","shiftPressed","pasteCount","toLowerCase","key","timestamp","index","time","formattedTime","formatTime","pastedText","comment","lastIndex","panel","noEventsMessage","carouselContainer","navigationRow","counterDisplay","navButtons","prevButton","nextButton","disabled","contentContainer","createPasteEventDisplay","currentIndex","updateDisplay","opacity","pasteEvent","eventRow","headerRow","textContainer","timestampContainer","pastedTextContainer","playIcon","jumpToTimestamp","percentage","setScrubberVal","String","displayTime","Math","methodname","args","filepath","done","response","fail","ms","seconds","floor","remainingSeconds","toString","padStart","reset","pauseSvg","replayLog","cursor","updatedHighlights","updatedDeleted","undefined","rePosition","processKeydownEvent","filter","h","expiresAt","d","updateDisplayText","percentComplete","baseIncrement","incrementTime","setTimeout","getLineAndColumn","pos","before","substring","lineIndex","split","col","lastIndexOf","highlights","deletions","charToInsert","applyKey","updateModifierStates","handlePasteInsert","isCtrlBackspace","handleCtrlBackspace","isCtrlDelete","handleCtrlDelete","isCtrlArrowMove","handleCtrlArrowMove","isRegularBackspace","handleBackspace","isRegularDelete","handleDelete","isArrowUp","handleArrowUp","isArrowDown","handleArrowDown","isRegularArrowMove","handleArrowMove","handleCharacterInsert","insertText","trim","chars","shiftPastedCharsIndices","startIndex","numDeleted","p","includes","findPreviousWordBoundary","findNextWordBoundary","wordEnd","wordToDelete","lines","prevLine","slice","join","nextLine","wordStart","lastNonSpace","skipToEnd","textOutput","wasPlaying","targetTime","pasteIndex","highlightMap","deletionMap","pastedMap","outOfRangeDeletions","textLines","line","char","isPasted","isHighlighted","escapeHtml","endsWith","sort","a","b","cursorHTML","cursorPos","deletedWordHTML","wasScrolledToBottom","scrollHeight","clientHeight","scrollTop","isCursorBelowViewport","cursorElement","cursorRect","getBoundingClientRect","outputRect","bottom","unsafe","replace"],"mappings":"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"}