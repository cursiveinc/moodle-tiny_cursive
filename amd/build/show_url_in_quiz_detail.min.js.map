{"version":3,"file":"show_url_in_quiz_detail.min.js","sources":["../src/show_url_in_quiz_detail.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @module     tiny_cursive/show_url_in_quiz_detail\r\n * @category TinyMCE Editor\r\n * @copyright  CTI <info@cursivetechnology.com>\r\n * @author kuldeep singh <mca.kuldeep.sekhon@gmail.com>\r\n */\r\n\r\ndefine([\"jquery\", \"core/ajax\", \"core/str\", \"core/templates\", \"./replay\", \"./analytic_button\", \"./analytic_events\",\r\n    \"./replay_button\"], function(\r\n    $,\r\n    AJAX,\r\n    str,\r\n    templates,\r\n    Replay,\r\n    analyticButton,\r\n    AnalyticEvents,\r\n    replayButton\r\n) {\r\n    const replayInstances = {};\r\n    // eslint-disable-next-line\r\n    window.video_playback = function (mid, filepath, questionid) {\r\n        if (filepath !== '') {\r\n            const replay = new Replay(\r\n                'content' + mid,\r\n                filepath,\r\n                10,\r\n                false,\r\n                'player_' + mid + questionid\r\n            );\r\n            replayInstances[mid] = replay;\r\n        } else {\r\n            // eslint-disable-next-line\r\n            templates.render('tiny_cursive/no_submission').then(html => {\r\n                $('#content' + mid).html(html);\r\n            }).catch(e => window.console.error(e));\r\n        }\r\n        return false;\r\n    };\r\n\r\n    var usersTable = {\r\n\r\n        init: function(scoreSetting, showcomment, hasApiKey) {\r\n            str\r\n                .get_strings([\r\n                    {key: \"field_require\", component: \"tiny_cursive\"},\r\n                ])\r\n                .done(function() {\r\n                    usersTable.appendSubmissionDetail(scoreSetting, hasApiKey);\r\n                });\r\n        },\r\n        appendSubmissionDetail: function(scoreSetting, hasApiKey) {\r\n            let subUrl = window.location.href;\r\n            let parm = new URL(subUrl);\r\n            let attemptId = parm.searchParams.get('attempt');\r\n            let cmid = M.cfg.contextInstanceId;\r\n            var userid = '';\r\n            var tableRow = $('table.generaltable.generalbox.quizreviewsummary tbody tr');\r\n            tableRow.each(function() {\r\n                var href = $(this).find('a[href*=\"/user/view.php\"]').attr('href');\r\n                if (href) {\r\n                    var id = href.match(/id=(\\d+)/);\r\n                    if (id) {\r\n                        userid = id[1];\r\n                    }\r\n                }\r\n            });\r\n\r\n            $('#page-mod-quiz-review .info').each(function() {\r\n\r\n                var editQuestionLink = $(this).find('.editquestion a[href*=\"question/bank/editquestion/question.php\"]');\r\n                var questionid = 0;\r\n                if (editQuestionLink.length > 0) {\r\n                    editQuestionLink = editQuestionLink.attr('href');\r\n                    questionid = editQuestionLink.match(/&id=(\\d+)/)[1];\r\n                }\r\n\r\n                let args = {id: attemptId, modulename: \"quiz\", \"cmid\": cmid, \"questionid\": questionid, \"userid\": userid};\r\n                let methodname = 'cursive_get_comment_link';\r\n                let com = AJAX.call([{methodname, args}]);\r\n                com[0].done(function(json) {\r\n                    var data = JSON.parse(json);\r\n\r\n                    if (data.data.filename) {\r\n\r\n                        var content = $('.que.essay .editquestion a[href*=\"question/bank/editquestion/question.php\"][href*=\"&id='\r\n                            + data.data.questionid + '\"]');\r\n                        if (content.length == 0) {\r\n                            content = $('.que.aitext .editquestion a[href*=\"question/bank/editquestion/question.php\"][href*=\"&id='\r\n                            + data.data.questionid + '\"]');\r\n                        }\r\n                        var filepath = '';\r\n                        if (data.data.filename) {\r\n                            filepath = data.data.filename;\r\n                        }\r\n                        let analyticButtonDiv = document.createElement('div');\r\n                        analyticButtonDiv.classList.add('text-center', 'mt-2');\r\n\r\n                        if (!hasApiKey) {\r\n                            $(analyticButtonDiv).html(replayButton(userid + questionid));\r\n                        } else {\r\n                            analyticButtonDiv.append(analyticButton(data.data.effort_ratio, userid, questionid));\r\n                        }\r\n\r\n                        content.parent().parent().parent().find('.qtext').append(analyticButtonDiv);\r\n\r\n                        let myEvents = new AnalyticEvents();\r\n                        var context = {\r\n                            tabledata: data.data,\r\n                            formattime: myEvents.formatedTime(data.data),\r\n                            page: scoreSetting,\r\n                            userid: userid,\r\n                            quizid: questionid,\r\n                            apikey: hasApiKey\r\n                        };\r\n\r\n                        let authIcon = myEvents.authorshipStatus(data.data.first_file, data.data.score, scoreSetting);\r\n                        myEvents.createModal(userid, context, questionid, replayInstances, authIcon);\r\n                        myEvents.analytics(userid, templates, context, questionid, replayInstances, authIcon);\r\n                        myEvents.checkDiff(userid, data.data.file_id, questionid, replayInstances);\r\n                        myEvents.replyWriting(userid, filepath, questionid, replayInstances);\r\n\r\n                    }\r\n                });\r\n                return com.usercomment;\r\n            });\r\n        },\r\n    };\r\n    return usersTable;\r\n});\r\n"],"names":["define","$","AJAX","str","templates","Replay","analyticButton","AnalyticEvents","replayButton","replayInstances","window","video_playback","mid","filepath","questionid","replay","render","then","html","catch","e","console","error","usersTable","init","scoreSetting","showcomment","hasApiKey","get_strings","key","component","done","appendSubmissionDetail","subUrl","location","href","attemptId","URL","searchParams","get","cmid","M","cfg","contextInstanceId","userid","each","this","find","attr","id","match","editQuestionLink","length","args","modulename","com","call","methodname","json","data","JSON","parse","filename","content","analyticButtonDiv","document","createElement","classList","add","append","effort_ratio","parent","myEvents","context","tabledata","formattime","formatedTime","page","quizid","apikey","authIcon","authorshipStatus","first_file","score","createModal","analytics","checkDiff","file_id","replyWriting","usercomment"],"mappings":"AAsBAA,8CAAO,CAAC,SAAU,YAAa,WAAY,iBAAkB,WAAY,oBAAqB,oBAC1F,oBAAoB,SACpBC,EACAC,KACAC,IACAC,UACAC,OACAC,eACAC,eACAC,oBAEMC,gBAAkB,GAExBC,OAAOC,eAAiB,SAAUC,IAAKC,SAAUC,eAC5B,KAAbD,SAAiB,OACXE,OAAS,IAAIV,OACf,UAAYO,IACZC,SACA,IACA,EACA,UAAYD,IAAME,YAEtBL,gBAAgBG,KAAOG,YAGvBX,UAAUY,OAAO,8BAA8BC,MAAKC,OAChDjB,EAAE,WAAaW,KAAKM,KAAKA,SAC1BC,OAAMC,GAAKV,OAAOW,QAAQC,MAAMF,YAEhC,OAGPG,WAAa,CAEbC,KAAM,SAASC,aAAcC,YAAaC,WACtCxB,IACKyB,YAAY,CACT,CAACC,IAAK,gBAAiBC,UAAW,kBAErCC,MAAK,WACFR,WAAWS,uBAAuBP,aAAcE,eAG5DK,uBAAwB,SAASP,aAAcE,eACvCM,OAASvB,OAAOwB,SAASC,KAEzBC,UADO,IAAIC,IAAIJ,QACEK,aAAaC,IAAI,WAClCC,KAAOC,EAAEC,IAAIC,sBACbC,OAAS,GACE3C,EAAE,4DACR4C,MAAK,eACNV,KAAOlC,EAAE6C,MAAMC,KAAK,6BAA6BC,KAAK,WACtDb,KAAM,KACFc,GAAKd,KAAKe,MAAM,YAChBD,KACAL,OAASK,GAAG,QAKxBhD,EAAE,+BAA+B4C,MAAK,eAE9BM,iBAAmBlD,EAAE6C,MAAMC,KAAK,oEAChCjC,WAAa,EACbqC,iBAAiBC,OAAS,IAC1BD,iBAAmBA,iBAAiBH,KAAK,QACzClC,WAAaqC,iBAAiBD,MAAM,aAAa,QAGjDG,KAAO,CAACJ,GAAIb,UAAWkB,WAAY,YAAgBd,gBAAoB1B,kBAAsB8B,QAE7FW,IAAMrD,KAAKsD,KAAK,CAAC,CAACC,WADL,2BACiBJ,KAAAA,eAClCE,IAAI,GAAGxB,MAAK,SAAS2B,UACbC,KAAOC,KAAKC,MAAMH,SAElBC,KAAKA,KAAKG,SAAU,KAEhBC,QAAU9D,EAAE,0FACV0D,KAAKA,KAAK7C,WAAa,MACP,GAAlBiD,QAAQX,SACRW,QAAU9D,EAAE,2FACV0D,KAAKA,KAAK7C,WAAa,WAEzBD,SAAW,GACX8C,KAAKA,KAAKG,WACVjD,SAAW8C,KAAKA,KAAKG,cAErBE,kBAAoBC,SAASC,cAAc,OAC/CF,kBAAkBG,UAAUC,IAAI,cAAe,QAE1CzC,UAGDqC,kBAAkBK,OAAO/D,eAAeqD,KAAKA,KAAKW,aAAc1B,OAAQ9B,aAFxEb,EAAE+D,mBAAmB9C,KAAKV,aAAaoC,OAAS9B,aAKpDiD,QAAQQ,SAASA,SAASA,SAASxB,KAAK,UAAUsB,OAAOL,uBAErDQ,SAAW,IAAIjE,mBACfkE,QAAU,CACVC,UAAWf,KAAKA,KAChBgB,WAAYH,SAASI,aAAajB,KAAKA,MACvCkB,KAAMpD,aACNmB,OAAQA,OACRkC,OAAQhE,WACRiE,OAAQpD,eAGRqD,SAAWR,SAASS,iBAAiBtB,KAAKA,KAAKuB,WAAYvB,KAAKA,KAAKwB,MAAO1D,cAChF+C,SAASY,YAAYxC,OAAQ6B,QAAS3D,WAAYL,gBAAiBuE,UACnER,SAASa,UAAUzC,OAAQxC,UAAWqE,QAAS3D,WAAYL,gBAAiBuE,UAC5ER,SAASc,UAAU1C,OAAQe,KAAKA,KAAK4B,QAASzE,WAAYL,iBAC1D+D,SAASgB,aAAa5C,OAAQ/B,SAAUC,WAAYL,qBAIrD8C,IAAIkC,wBAIhBlE"}