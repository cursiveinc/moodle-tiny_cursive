{"version":3,"file":"show_url_in_quiz_detail.min.js","sources":["../src/show_url_in_quiz_detail.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     tiny_cursive/show_url_in_quiz_detail\n * @category TinyMCE Editor\n * @copyright  CTI <info@cursivetechnology.com>\n * @author Brain Station 23 <elearning@brainstation-23.com>\n */\n\ndefine([\n    \"core/ajax\",\n    \"core/str\",\n    \"core/templates\",\n    \"./replay\",\n    \"./analytic_button\",\n    \"./analytic_events\"\n], function(\n    AJAX,\n    str,\n    templates,\n    Replay,\n    analyticButton,\n    AnalyticEvents\n) {\n    const replayInstances = {};\n    // eslint-disable-next-line\n    window.video_playback = function(mid, filepath, questionid) {\n        if (filepath !== '') {\n            const replay = new Replay(\n                'content' + mid,\n                filepath,\n                10,\n                false,\n                'player_' + mid + questionid\n            );\n            replayInstances[mid] = replay;\n        } else {\n            templates.render('tiny_cursive/no_submission').then(function(html) {\n                const contentElement = document.getElementById('content' + mid);\n                if (contentElement) {\n                    contentElement.innerHTML = html;\n                }\n            }).catch(function(e) {\n                window.console.error(e);\n            });\n        }\n        return false;\n    };\n\n    var usersTable = {\n        init: function(score_setting, showcomment, hasApiKey) {\n            str.get_strings([{key: \"field_require\", component: \"tiny_cursive\"}])\n                .done(function() {\n                    usersTable.appendSubmissionDetail(score_setting, hasApiKey);\n                });\n        },\n\n        appendSubmissionDetail: function(score_setting, hasApiKey) {\n            let sub_url = window.location.href;\n            let parm = new URL(sub_url);\n            let attempt_id = parm.searchParams.get('attempt');\n            let cmid = M.cfg.contextInstanceId;\n\n            let userid = '';\n            let tableRow = document.querySelectorAll('table.generaltable.generalbox.quizreviewsummary tbody tr');\n            tableRow.forEach(function(row) {\n                let hrefElement = row.querySelector('a[href*=\"/user/view.php\"]');\n                if (hrefElement) {\n                    let href = hrefElement.getAttribute('href');\n                    let id = href.match(/id=(\\d+)/);\n                    if (id) {\n                        userid = id[1];\n                    }\n                }\n            });\n\n            document.querySelectorAll('#page-mod-quiz-review .info').forEach(function(element) {\n                let editQuestionLink = element.querySelector('.editquestion a[href*=\"question/bank/editquestion/question.php\"]');\n                let questionid = 0;\n                if (editQuestionLink) {\n                    let editQuestionHref = editQuestionLink.getAttribute('href');\n                    questionid = editQuestionHref.match(/&id=(\\d+)/)[1];\n                }\n\n                let args = {id: attempt_id, modulename: \"quiz\", cmid: cmid, questionid: questionid, userid: userid};\n                let methodname = 'cursive_get_comment_link';\n                let com = AJAX.call([{methodname, args}]);\n\n                com[0].done(function(json) {\n                    let data = JSON.parse(json);\n\n                    if (data.data.filename) {\n                        // eslint-disable-next-line\n                        let content = document.querySelector('.que.essay .editquestion a[href*=\"question/bank/editquestion/question.php\"][href*=\"&id='\n                            + data.data.questionid + '\"]');\n                        if (content) {\n                            let qtextElement = content.parentNode.parentElement.nextSibling.querySelector('.qtext');\n                            let filepath = data.data.filename || '';\n                            let analyticButtonDiv = document.createElement('div');\n                            analyticButtonDiv.classList.add('text-center', 'mt-2');\n                            const button = analyticButton(\n                                hasApiKey ? data.data.effort_ratio : \"\",\n                                userid,\n                                questionid\n                            );\n\n                            analyticButtonDiv.appendChild(button);\n\n                            if (qtextElement) {\n                                qtextElement.appendChild(analyticButtonDiv);\n                            }\n\n                            let myEvents = new AnalyticEvents();\n                            let context = {\n                                tabledata: data.data,\n                                formattime: myEvents.formatedTime(data.data),\n                                page: score_setting,\n                                userid: userid,\n                                quizid: questionid,\n                            };\n                            let authIcon = myEvents.authorshipStatus(data.data.first_file, data.data.score, score_setting);\n\n                            myEvents.createModal(userid, context, questionid, replayInstances, authIcon);\n                            myEvents.analytics(userid, templates, context, questionid, replayInstances, authIcon);\n                            myEvents.checkDiff(userid, data.data.file_id, questionid, replayInstances);\n                            myEvents.replyWriting(userid, filepath, questionid, replayInstances);\n                        }\n                    }\n                });\n                return com.usercomment;\n            });\n        },\n    };\n\n    return usersTable;\n});\n"],"names":["define","AJAX","str","templates","Replay","analyticButton","AnalyticEvents","replayInstances","window","video_playback","mid","filepath","questionid","replay","render","then","html","contentElement","document","getElementById","innerHTML","catch","e","console","error","usersTable","init","score_setting","showcomment","hasApiKey","get_strings","key","component","done","appendSubmissionDetail","sub_url","location","href","attempt_id","URL","searchParams","get","cmid","M","cfg","contextInstanceId","userid","querySelectorAll","forEach","row","hrefElement","querySelector","id","getAttribute","match","element","editQuestionLink","editQuestionHref","args","modulename","com","call","methodname","json","data","JSON","parse","filename","content","qtextElement","parentNode","parentElement","nextSibling","analyticButtonDiv","createElement","classList","add","button","effort_ratio","appendChild","myEvents","context","tabledata","formattime","formatedTime","page","quizid","authIcon","authorshipStatus","first_file","score","createModal","analytics","checkDiff","file_id","replyWriting","usercomment"],"mappings":"AAsBAA,8CAAO,CACH,YACA,WACA,iBACA,WACA,oBACA,sBACD,SACCC,KACAC,IACAC,UACAC,OACAC,eACAC,sBAEMC,gBAAkB,GAExBC,OAAOC,eAAiB,SAASC,IAAKC,SAAUC,eAC3B,KAAbD,SAAiB,OACXE,OAAS,IAAIT,OACf,UAAYM,IACZC,SACA,IACA,EACA,UAAYD,IAAME,YAEtBL,gBAAgBG,KAAOG,YAEvBV,UAAUW,OAAO,8BAA8BC,MAAK,SAASC,YACnDC,eAAiBC,SAASC,eAAe,UAAYT,KACvDO,iBACAA,eAAeG,UAAYJ,SAEhCK,OAAM,SAASC,GACdd,OAAOe,QAAQC,MAAMF,aAGtB,OAGPG,WAAa,CACbC,KAAM,SAASC,cAAeC,YAAaC,WACvC3B,IAAI4B,YAAY,CAAC,CAACC,IAAK,gBAAiBC,UAAW,kBAC9CC,MAAK,WACFR,WAAWS,uBAAuBP,cAAeE,eAI7DK,uBAAwB,SAASP,cAAeE,eACxCM,QAAU3B,OAAO4B,SAASC,KAE1BC,WADO,IAAIC,IAAIJ,SACGK,aAAaC,IAAI,WACnCC,KAAOC,EAAEC,IAAIC,kBAEbC,OAAS,GACE5B,SAAS6B,iBAAiB,4DAChCC,SAAQ,SAASC,SAClBC,YAAcD,IAAIE,cAAc,gCAChCD,YAAa,KAETE,GADOF,YAAYG,aAAa,QACtBC,MAAM,YAChBF,KACAN,OAASM,GAAG,QAKxBlC,SAAS6B,iBAAiB,+BAA+BC,SAAQ,SAASO,aAClEC,iBAAmBD,QAAQJ,cAAc,oEACzCvC,WAAa,KACb4C,iBAAkB,KACdC,iBAAmBD,iBAAiBH,aAAa,QACrDzC,WAAa6C,iBAAiBH,MAAM,aAAa,OAGjDI,KAAO,CAACN,GAAId,WAAYqB,WAAY,OAAQjB,KAAMA,KAAM9B,WAAYA,WAAYkC,OAAQA,QAExFc,IAAM3D,KAAK4D,KAAK,CAAC,CAACC,WADL,2BACiBJ,KAAAA,eAElCE,IAAI,GAAG3B,MAAK,SAAS8B,UACbC,KAAOC,KAAKC,MAAMH,SAElBC,KAAKA,KAAKG,SAAU,KAEhBC,QAAUlD,SAASiC,cAAc,0FAC/Ba,KAAKA,KAAKpD,WAAa,SACzBwD,QAAS,KACLC,aAAeD,QAAQE,WAAWC,cAAcC,YAAYrB,cAAc,UAC1ExC,SAAWqD,KAAKA,KAAKG,UAAY,GACjCM,kBAAoBvD,SAASwD,cAAc,OAC/CD,kBAAkBE,UAAUC,IAAI,cAAe,cACzCC,OAASxE,eACXwB,UAAYmC,KAAKA,KAAKc,aAAe,GACrChC,OACAlC,YAGJ6D,kBAAkBM,YAAYF,QAE1BR,cACAA,aAAaU,YAAYN,uBAGzBO,SAAW,IAAI1E,eACf2E,QAAU,CACVC,UAAWlB,KAAKA,KAChBmB,WAAYH,SAASI,aAAapB,KAAKA,MACvCqB,KAAM1D,cACNmB,OAAQA,OACRwC,OAAQ1E,YAER2E,SAAWP,SAASQ,iBAAiBxB,KAAKA,KAAKyB,WAAYzB,KAAKA,KAAK0B,MAAO/D,eAEhFqD,SAASW,YAAY7C,OAAQmC,QAASrE,WAAYL,gBAAiBgF,UACnEP,SAASY,UAAU9C,OAAQ3C,UAAW8E,QAASrE,WAAYL,gBAAiBgF,UAC5EP,SAASa,UAAU/C,OAAQkB,KAAKA,KAAK8B,QAASlF,WAAYL,iBAC1DyE,SAASe,aAAajD,OAAQnC,SAAUC,WAAYL,sBAIzDqD,IAAIoC,wBAKhBvE"}