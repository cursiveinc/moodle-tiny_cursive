{"version":3,"file":"show_url_in_submission_grade.min.js","sources":["../src/show_url_in_submission_grade.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     tiny_cursive/show_url_in_submission_grade\n * @category TinyMCE Editor\n * @copyright  CTI <info@cursivetechnology.com>\n * @author Brain Station 23 <elearning@brainstation-23.com>\n */\n\ndefine([\n    \"core/ajax\",\n    \"core/str\",\n    \"core/templates\",\n    \"./replay\",\n    \"./analytic_button\",\n    \"./analytic_events\"\n], function(\n    AJAX,\n    str,\n    templates,\n    Replay,\n    analyticButton,\n    AnalyticEvents\n) {\n    const replayInstances = {};\n    // eslint-disable-next-line\n    window.video_playback = function(mid, filepath) {\n        if (filepath !== '') {\n            const replay = new Replay(\n                'content' + mid,\n                filepath,\n                10,\n                false,\n                'player_' + mid\n            );\n            replayInstances[mid] = replay;\n        } else {\n            // eslint-disable-next-line\n            templates.render('tiny_cursive/no_submission').then(html => {\n                const contentElement = document.getElementById('content' + mid);\n                if (contentElement) {\n                    contentElement.innerHTML = html;\n                }\n            }).catch(e => window.console.error(e));\n        }\n        return false;\n    };\n\n    var usersTable = {\n        init: function(score_setting, showcomment) {\n\n            const graderElement = document.getElementById('page-mod-assign-grader');\n            if (graderElement) {\n                graderElement.classList.add('tiny_cursive_mod_assign_grader');\n            }\n\n            str.get_strings([{key: \"field_require\", component: \"tiny_cursive\"}])\n                .then(() => {\n                    usersTable.appendSubmissionDetail(score_setting, showcomment);\n                });\n        },\n        // eslint-disable-next-line\n        appendSubmissionDetail: function(score_setting, showcomment) {\n\n            const divElement = document.querySelector('.path-mod-assign [data-region=\"grade-panel\"]');\n            let previousContextId = window.location.href;\n\n            const observer = new MutationObserver(function(mutations) {\n                mutations.forEach(function() {\n                    let currentContextId = window.location.href;\n                    if (currentContextId !== previousContextId) {\n                        window.location.reload();\n                        previousContextId = currentContextId;\n                    }\n                });\n            });\n\n            const config = {childList: true, subtree: true};\n            observer.observe(divElement, config);\n\n            const subUrl = window.location.href;\n            const parm = new URL(subUrl);\n            const userid = parm.searchParams.get('userid');\n            var cmid = parm.searchParams.get('id');\n\n            const args = {id: userid, modulename: \"assign\", cmid: cmid};\n            const methodname = 'cursive_get_assign_grade_comment';\n            const com = AJAX.call([{methodname, args}]);\n\n            com[0].done(function(json) {\n                const data = JSON.parse(json);\n                let filepath = '';\n                if (data.data.filename) {\n                    filepath = data.data.filename;\n                }\n\n                const analytic_button_div = document.createElement('div');\n                analytic_button_div.classList.add('text-center', 'mt-2');\n                analytic_button_div.appendChild(analyticButton(userid));\n\n                const gradeActions = document.querySelector('div[data-region=\"grade-actions\"]');\n                gradeActions.parentNode.insertBefore(analytic_button_div, gradeActions);\n\n                const reviewPanel = document.querySelector('div[data-region=\"review-panel\"]');\n                if (reviewPanel) {\n                    reviewPanel.classList.add('cursive_review_panel_path_mod_assign');\n                }\n\n                const gradingNavigationPanel = document.querySelector('div[data-region=\"grading-navigation-panel\"]');\n                if (gradingNavigationPanel) {\n                    gradingNavigationPanel.classList.add('cursive_grading-navigation-panel_path_mod_assign');\n                }\n\n                const gradePanel = document.querySelector('div[data-region=\"grade-panel\"]');\n                if (gradePanel) {\n                    gradePanel.classList.add('cursive_grade-panel_path_mod_assign');\n                }\n\n                const gradeActionsPanel = document.querySelector('div[data-region=\"grade-actions-panel\"]');\n                if (gradeActionsPanel) {\n                    gradeActionsPanel.classList.add('cursive_grade-actions-panel_path_mod_assign');\n                }\n\n                const myEvents = new AnalyticEvents();\n                const context = {\n                    tabledata: data.data,\n                    formattime: myEvents.formatedTime(data.data),\n                    page: score_setting,\n                    userid: userid,\n                };\n\n                const authIcon = myEvents.authorshipStatus(data.data.first_file, data.data.score, score_setting);\n                myEvents.createModal(userid, context, '', authIcon);\n                myEvents.analytics(userid, templates, context, '', replayInstances, authIcon);\n                myEvents.checkDiff(userid, data.data.file_id, '', replayInstances);\n                myEvents.replyWriting(userid, filepath, '', replayInstances);\n            });\n            return com.usercomment;\n        },\n    };\n\n    return usersTable;\n});"],"names":["define","AJAX","str","templates","Replay","analyticButton","AnalyticEvents","replayInstances","window","video_playback","mid","filepath","replay","render","then","html","contentElement","document","getElementById","innerHTML","catch","e","console","error","usersTable","init","score_setting","showcomment","graderElement","classList","add","get_strings","key","component","appendSubmissionDetail","divElement","querySelector","previousContextId","location","href","MutationObserver","mutations","forEach","currentContextId","reload","observe","childList","subtree","subUrl","parm","URL","userid","searchParams","get","cmid","args","id","modulename","com","call","methodname","done","json","data","JSON","parse","filename","analytic_button_div","createElement","appendChild","gradeActions","parentNode","insertBefore","reviewPanel","gradingNavigationPanel","gradePanel","gradeActionsPanel","myEvents","context","tabledata","formattime","formatedTime","page","authIcon","authorshipStatus","first_file","score","createModal","analytics","checkDiff","file_id","replyWriting","usercomment"],"mappings":"AAsBAA,mDAAO,CACH,YACA,WACA,iBACA,WACA,oBACA,sBACD,SACCC,KACAC,IACAC,UACAC,OACAC,eACAC,sBAEMC,gBAAkB,GAExBC,OAAOC,eAAiB,SAASC,IAAKC,aACjB,KAAbA,SAAiB,OACXC,OAAS,IAAIR,OACf,UAAYM,IACZC,SACA,IACA,EACA,UAAYD,KAEhBH,gBAAgBG,KAAOE,YAGvBT,UAAUU,OAAO,8BAA8BC,MAAKC,aAC1CC,eAAiBC,SAASC,eAAe,UAAYR,KACvDM,iBACAA,eAAeG,UAAYJ,SAEhCK,OAAMC,GAAKb,OAAOc,QAAQC,MAAMF,YAEhC,OAGPG,WAAa,CACbC,KAAM,SAASC,cAAeC,mBAEpBC,cAAgBX,SAASC,eAAe,0BAC1CU,eACAA,cAAcC,UAAUC,IAAI,kCAGhC5B,IAAI6B,YAAY,CAAC,CAACC,IAAK,gBAAiBC,UAAW,kBAC9CnB,MAAK,KACFU,WAAWU,uBAAuBR,cAAeC,iBAI7DO,uBAAwB,SAASR,cAAeC,mBAEtCQ,WAAalB,SAASmB,cAAc,oDACtCC,kBAAoB7B,OAAO8B,SAASC,KAEvB,IAAIC,kBAAiB,SAASC,WAC3CA,UAAUC,SAAQ,eACVC,iBAAmBnC,OAAO8B,SAASC,KACnCI,mBAAqBN,oBACrB7B,OAAO8B,SAASM,SAChBP,kBAAoBM,wBAMvBE,QAAQV,WADF,CAACW,WAAW,EAAMC,SAAS,UAGpCC,OAASxC,OAAO8B,SAASC,KACzBU,KAAO,IAAIC,IAAIF,QACfG,OAASF,KAAKG,aAAaC,IAAI,cACjCC,KAAOL,KAAKG,aAAaC,IAAI,YAE3BE,KAAO,CAACC,GAAIL,OAAQM,WAAY,SAAUH,KAAMA,MAEhDI,IAAMzD,KAAK0D,KAAK,CAAC,CAACC,WADL,mCACiBL,KAAAA,eAEpCG,IAAI,GAAGG,MAAK,SAASC,YACXC,KAAOC,KAAKC,MAAMH,UACpBnD,SAAW,GACXoD,KAAKA,KAAKG,WACVvD,SAAWoD,KAAKA,KAAKG,gBAGnBC,oBAAsBlD,SAASmD,cAAc,OACnDD,oBAAoBtC,UAAUC,IAAI,cAAe,QACjDqC,oBAAoBE,YAAYhE,eAAe8C,eAEzCmB,aAAerD,SAASmB,cAAc,oCAC5CkC,aAAaC,WAAWC,aAAaL,oBAAqBG,oBAEpDG,YAAcxD,SAASmB,cAAc,mCACvCqC,aACAA,YAAY5C,UAAUC,IAAI,8CAGxB4C,uBAAyBzD,SAASmB,cAAc,+CAClDsC,wBACAA,uBAAuB7C,UAAUC,IAAI,0DAGnC6C,WAAa1D,SAASmB,cAAc,kCACtCuC,YACAA,WAAW9C,UAAUC,IAAI,6CAGvB8C,kBAAoB3D,SAASmB,cAAc,0CAC7CwC,mBACAA,kBAAkB/C,UAAUC,IAAI,qDAG9B+C,SAAW,IAAIvE,eACfwE,QAAU,CACZC,UAAWhB,KAAKA,KAChBiB,WAAYH,SAASI,aAAalB,KAAKA,MACvCmB,KAAMxD,cACNyB,OAAQA,QAGNgC,SAAWN,SAASO,iBAAiBrB,KAAKA,KAAKsB,WAAYtB,KAAKA,KAAKuB,MAAO5D,eAClFmD,SAASU,YAAYpC,OAAQ2B,QAAS,GAAIK,UAC1CN,SAASW,UAAUrC,OAAQhD,UAAW2E,QAAS,GAAIvE,gBAAiB4E,UACpEN,SAASY,UAAUtC,OAAQY,KAAKA,KAAK2B,QAAS,GAAInF,iBAClDsE,SAASc,aAAaxC,OAAQxC,SAAU,GAAIJ,oBAEzCmD,IAAIkC,qBAIZpE"}