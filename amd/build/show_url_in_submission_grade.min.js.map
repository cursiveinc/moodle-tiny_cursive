{"version":3,"file":"show_url_in_submission_grade.min.js","sources":["../src/show_url_in_submission_grade.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * @module     tiny_cursive/show_url_in_submission_grade\r\n * @category TinyMCE Editor\r\n * @copyright  CTI <info@cursivetechnology.com>\r\n * @author kuldeep singh <mca.kuldeep.sekhon@gmail.com>\r\n */\r\n\r\ndefine([\"jquery\", \"core/ajax\", \"core/str\", \"core/templates\", \"./replay\", \"./analytic_button\", \"./analytic_events\",\r\n    \"./replay_button\"], function(\r\n    $,\r\n    AJAX,\r\n    str,\r\n    templates,\r\n    Replay,\r\n    analyticButton,\r\n    AnalyticEvents,\r\n    replayButton,\r\n) {\r\n    const replayInstances = {};\r\n    // eslint-disable-next-line\r\n    window.video_playback = function (mid, filepath) {\r\n        if (filepath !== '') {\r\n            // $(\"#playback\" + mid).show();\r\n            const replay = new Replay(\r\n                'content' + mid,\r\n                filepath,\r\n                10,\r\n                false,\r\n                'player_' + mid\r\n            );\r\n            replayInstances[mid] = replay;\r\n        } else {\r\n            // eslint-disable-next-line\r\n            templates.render('tiny_cursive/no_submission').then(html => {\r\n                $('#content' + mid).html(html);\r\n            }).catch(e => window.console.error(e));\r\n        }\r\n        return false;\r\n\r\n    };\r\n\r\n    var usersTable = {\r\n        init: function(scoreSetting, showcomment, hasApiKey) {\r\n            $(document).ready(function() {\r\n                $('#page-mod-assign-grader').addClass('tiny_cursive_mod_assign_grader');\r\n            });\r\n            str\r\n                .get_strings([\r\n                    {key: \"field_require\", component: \"tiny_cursive\"},\r\n                ])\r\n                .done(function() {\r\n                    usersTable.appendSubmissionDetail(scoreSetting, showcomment, hasApiKey);\r\n                });\r\n        },\r\n\r\n        appendSubmissionDetail: function(scoreSetting, showcomment, hasApiKey) {\r\n            $(document).ready(function($) {\r\n\r\n                var divElement = $('.path-mod-assign [data-region=\"grade-panel\"]')[0];\r\n                var previousContextId = window.location.href;\r\n                var observer = new MutationObserver(function(mutations) {\r\n                    mutations.forEach(function() {\r\n\r\n                        var currentContextId = window.location.href;\r\n                        if (currentContextId !== previousContextId) {\r\n                            window.location.reload();\r\n                            previousContextId = currentContextId;\r\n                        }\r\n                    });\r\n                });\r\n                // Configuration of the observer:\r\n                var config = {childList: true, subtree: true};\r\n                // Start observing the target node for configured mutations\r\n                observer.observe(divElement, config);\r\n\r\n                let subUrl = window.location.href;\r\n                let parm = new URL(subUrl);\r\n                let userid = parm.searchParams.get('userid');\r\n                var cmid = parm.searchParams.get('id');\r\n\r\n                let args = {id: userid, modulename: \"assign\", 'cmid': cmid};\r\n                let methodname = 'cursive_get_assign_grade_comment';\r\n                let com = AJAX.call([{methodname, args}]);\r\n                com[0].done(function(json) {\r\n                    var data = JSON.parse(json);\r\n                    var filepath = '';\r\n                    if (data.data.filename) {\r\n                        filepath = data.data.filename;\r\n                    }\r\n\r\n                    let analyticButtonDiv = document.createElement('div');\r\n                    analyticButtonDiv.classList.add('text-center', 'mt-2');\r\n\r\n                    $('div[data-region=\"grade-actions\"]').before(analyticButtonDiv);\r\n\r\n                    $('div[data-region=\"review-panel\"]').addClass('cursive_review_panel_path_mod_assign');\r\n\r\n                    $('div[data-region=\"grading-navigation-panel\"]').addClass('cursive_grading-navigation-panel_path_mod_assign');\r\n\r\n                    $('div[data-region=\"grade-panel\"]').addClass('cursive_grade-panel_path_mod_assign');\r\n\r\n                    $('div[data-region=\"grade-actions-panel\"]').addClass('cursive_grade-actions-panel_path_mod_assign');\r\n\r\n                    if (!hasApiKey) {\r\n                        $(analyticButtonDiv).html(replayButton(userid));\r\n                    } else {\r\n                        analyticButtonDiv.append(analyticButton(data.data.effort_ratio, userid));\r\n                    }\r\n\r\n                    let myEvents = new AnalyticEvents();\r\n                    var context = {\r\n                        tabledata: data.data,\r\n                        formattime: myEvents.formatedTime(data.data),\r\n                        page: scoreSetting,\r\n                        userid: userid,\r\n                        apikey: hasApiKey\r\n                    };\r\n\r\n                    let authIcon = myEvents.authorshipStatus(data.data.first_file, data.data.score, scoreSetting);\r\n\r\n                    myEvents.createModal(userid, context, '', replayInstances, authIcon);\r\n                    myEvents.analytics(userid, templates, context, '', replayInstances, authIcon);\r\n                    myEvents.checkDiff(userid, data.data.file_id, '', replayInstances);\r\n                    myEvents.replyWriting(userid, filepath, '', replayInstances);\r\n\r\n\r\n                });\r\n                return com.usercomment;\r\n            });\r\n        },\r\n    };\r\n    return usersTable;\r\n});\r\n\r\n\r\n"],"names":["define","$","AJAX","str","templates","Replay","analyticButton","AnalyticEvents","replayButton","replayInstances","window","video_playback","mid","filepath","replay","render","then","html","catch","e","console","error","usersTable","init","scoreSetting","showcomment","hasApiKey","document","ready","addClass","get_strings","key","component","done","appendSubmissionDetail","divElement","previousContextId","location","href","MutationObserver","mutations","forEach","currentContextId","reload","observe","childList","subtree","subUrl","parm","URL","userid","searchParams","get","cmid","args","id","modulename","com","call","methodname","json","data","JSON","parse","filename","analyticButtonDiv","createElement","classList","add","before","append","effort_ratio","myEvents","context","tabledata","formattime","formatedTime","page","apikey","authIcon","authorshipStatus","first_file","score","createModal","analytics","checkDiff","file_id","replyWriting","usercomment"],"mappings":"AAsBAA,mDAAO,CAAC,SAAU,YAAa,WAAY,iBAAkB,WAAY,oBAAqB,oBAC1F,oBAAoB,SACpBC,EACAC,KACAC,IACAC,UACAC,OACAC,eACAC,eACAC,oBAEMC,gBAAkB,GAExBC,OAAOC,eAAiB,SAAUC,IAAKC,aAClB,KAAbA,SAAiB,OAEXC,OAAS,IAAIT,OACf,UAAYO,IACZC,SACA,IACA,EACA,UAAYD,KAEhBH,gBAAgBG,KAAOE,YAGvBV,UAAUW,OAAO,8BAA8BC,MAAKC,OAChDhB,EAAE,WAAaW,KAAKK,KAAKA,SAC1BC,OAAMC,GAAKT,OAAOU,QAAQC,MAAMF,YAEhC,OAIPG,WAAa,CACbC,KAAM,SAASC,aAAcC,YAAaC,WACtCzB,EAAE0B,UAAUC,OAAM,WACd3B,EAAE,2BAA2B4B,SAAS,qCAE1C1B,IACK2B,YAAY,CACT,CAACC,IAAK,gBAAiBC,UAAW,kBAErCC,MAAK,WACFX,WAAWY,uBAAuBV,aAAcC,YAAaC,eAIzEQ,uBAAwB,SAASV,aAAcC,YAAaC,WACxDzB,EAAE0B,UAAUC,OAAM,SAAS3B,OAEnBkC,WAAalC,EAAE,gDAAgD,GAC/DmC,kBAAoB1B,OAAO2B,SAASC,KACzB,IAAIC,kBAAiB,SAASC,WACzCA,UAAUC,SAAQ,eAEVC,iBAAmBhC,OAAO2B,SAASC,KACnCI,mBAAqBN,oBACrB1B,OAAO2B,SAASM,SAChBP,kBAAoBM,wBAOvBE,QAAQT,WAFJ,CAACU,WAAW,EAAMC,SAAS,QAIpCC,OAASrC,OAAO2B,SAASC,KACzBU,KAAO,IAAIC,IAAIF,QACfG,OAASF,KAAKG,aAAaC,IAAI,cAC/BC,KAAOL,KAAKG,aAAaC,IAAI,UAE7BE,KAAO,CAACC,GAAIL,OAAQM,WAAY,cAAkBH,MAElDI,IAAMvD,KAAKwD,KAAK,CAAC,CAACC,WADL,mCACiBL,KAAAA,eAClCG,IAAI,GAAGxB,MAAK,SAAS2B,UACbC,KAAOC,KAAKC,MAAMH,MAClB/C,SAAW,GACXgD,KAAKA,KAAKG,WACVnD,SAAWgD,KAAKA,KAAKG,cAGrBC,kBAAoBtC,SAASuC,cAAc,OAC/CD,kBAAkBE,UAAUC,IAAI,cAAe,QAE/CnE,EAAE,oCAAoCoE,OAAOJ,mBAE7ChE,EAAE,mCAAmC4B,SAAS,wCAE9C5B,EAAE,+CAA+C4B,SAAS,oDAE1D5B,EAAE,kCAAkC4B,SAAS,uCAE7C5B,EAAE,0CAA0C4B,SAAS,+CAEhDH,UAGDuC,kBAAkBK,OAAOhE,eAAeuD,KAAKA,KAAKU,aAAcrB,SAFhEjD,EAAEgE,mBAAmBhD,KAAKT,aAAa0C,aAKvCsB,SAAW,IAAIjE,mBACfkE,QAAU,CACVC,UAAWb,KAAKA,KAChBc,WAAYH,SAASI,aAAaf,KAAKA,MACvCgB,KAAMrD,aACN0B,OAAQA,OACR4B,OAAQpD,eAGRqD,SAAWP,SAASQ,iBAAiBnB,KAAKA,KAAKoB,WAAYpB,KAAKA,KAAKqB,MAAO1D,cAEhFgD,SAASW,YAAYjC,OAAQuB,QAAS,GAAIhE,gBAAiBsE,UAC3DP,SAASY,UAAUlC,OAAQ9C,UAAWqE,QAAS,GAAIhE,gBAAiBsE,UACpEP,SAASa,UAAUnC,OAAQW,KAAKA,KAAKyB,QAAS,GAAI7E,iBAClD+D,SAASe,aAAarC,OAAQrC,SAAU,GAAIJ,oBAIzCgD,IAAI+B,wBAIhBlE"}