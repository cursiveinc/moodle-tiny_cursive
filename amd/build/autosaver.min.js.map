{"version":3,"file":"autosaver.min.js","sources":["../src/autosaver.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     tiny_cursive/autosaver\n * @category   TinyMCE Editor\n * @copyright  CTI <info@cursivetechnology.com>\n * @author     Brain Station 23 <sales@brainstation-23.com>\n */\n\nimport {call} from 'core/ajax';\nimport {create} from 'core/modal_factory';\nimport {get_string as getString} from 'core/str';\nimport {save, cancel, hidden} from 'core/modal_events';\nimport jQuery from 'jquery';\nimport {iconUrl, iconGrayUrl} from 'tiny_cursive/common';\n\nexport const register = (editor, interval, userId, hasApiKey) => {\n\n    var isStudent = !(jQuery('#body').hasClass('teacher_admin'));\n    var intervention = jQuery('#body').hasClass('intervention');\n    var userid = userId;\n    var host = M.cfg.wwwroot;\n    var courseid = M.cfg.courseId;\n    var filename = \"\";\n    var quizSubmit = jQuery('#mod_quiz-next-nav');\n    var ed = \"\";\n    var event = \"\";\n    var resourceId = 0;\n    var modulename = \"\";\n    var editorid = editor?.id;\n    var cmid = M.cfg.contextInstanceId;\n    var questionid = 0;\n    let assignSubmit = jQuery('#id_submitbutton');\n    var syncInterval = interval ? interval * 1000 : 10000; // Default: Sync Every 10s.\n\n    const postOne = async(methodname, args) => {\n        try {\n            const response = await call([{\n                methodname,\n                args,\n            }])[0];\n            return response;\n        } catch (error) {\n            window.console.error('Error in postOne:', error);\n            throw error;\n        }\n    };\n\n    assignSubmit.on('click', async function(e) {\n        e.preventDefault();\n        if (filename) {\n            // eslint-disable-next-line\n            syncData().then(() => {\n                assignSubmit.off('click').click();\n            });\n        } else {\n            assignSubmit.off('click').click();\n        }\n    });\n\n    quizSubmit.on('click', async function(e) {\n        e.preventDefault();\n        if (filename) {\n            // eslint-disable-next-line\n            syncData().then(() => {\n                quizSubmit.off('click').click();\n            });\n        } else {\n            quizSubmit.off('click').click();\n        }\n    });\n\n    const getModal = (e) => {\n\n        Promise.all([\n            getString('tiny_cursive_srcurl', 'tiny_cursive'),\n            getString('tiny_cursive_srcurl_des', 'tiny_cursive'),\n            getString('tiny_cursive_placeholder', 'tiny_cursive')\n        ]).then(function([title, titledes, placeholder]) {\n\n            return create({\n                type: 'SAVE_CANCEL',\n                title: `<div><div style='color:dark;font-weight:500;line-height:0.5'>${title}</div><span style='color:\n                        gray;font-weight: 400;line-height: 1.2;font-size: 14px;display: inline-block;\n                        margin-top: .5rem;'>${titledes}</span></div>`,\n                body: `<textarea  class=\"form-control inputUrl\" value=\"\" id=\"inputUrl\" placeholder=\"${placeholder}\"></textarea>`,\n\n                removeOnClose: true,\n            })\n                .done(modal => {\n                    modal.getRoot().append(`\n                        <style>\n                                .close {\n                                    display: none ! important;\n                                }\n                                body.tox-fullscreen .modal-dialog {\n                                    max-width: 500px;\n                                    max-height:300px;\n                                    padding:1rem;\n                                }\n                                body.tox-fullscreen .modal-dialog .modal-header {\n                                    height: auto;\n                                    padding: 1rem\n                                }\n                         </style>`);\n                    modal.show();\n                    var lastEvent = '';\n                    // eslint-disable-next-line\n                    modal.getRoot().on(save, function() {\n                        var number = document.getElementById(\"inputUrl\").value.trim();\n                        if (number === \"\" || number === null || number === undefined) {\n                            editor.execCommand('Undo');\n                            // eslint-disable-next-line\n                            getString('pastewarning', 'tiny_cursive').then(str => alert(str));\n\n                        } else {\n                            editor.execCommand('Paste');\n                        }\n                        let ur = e.srcElement.baseURI;\n                        let resourceId = 0;\n                        let parm = new URL(ur);\n                        let modulename = \"\";\n                        let editorid = editor?.id;\n                        let courseid = M.cfg.courseId;\n                        let cmid = M.cfg.contextInstanceId;\n\n                        // eslint-disable-next-line\n                        if (ur.includes(\"attempt.php\") || ur.includes(\"forum\") || ur.includes(\"assign\") || ur.includes(\"lesson\") | ur.includes(\"oublog\")) { } else {\n                            return false;\n                        }\n                        if (ur.includes(\"forum\") && !ur.includes(\"assign\")) {\n                            resourceId = parm.searchParams.get('edit');\n                        }\n                        if (!ur.includes(\"forum\") && !ur.includes(\"assign\")) {\n                            resourceId = parm.searchParams.get('attempt');\n                        }\n\n                        if (resourceId === null) {\n                            resourceId = 0;\n                        }\n                        if (ur.includes(\"forum\")) {\n                            modulename = \"forum\";\n                        }\n                        if (ur.includes(\"assign\")) {\n                            modulename = \"assign\";\n                            resourceId = cmid;\n                        }\n                        if (ur.includes(\"attempt\")) {\n                            modulename = \"quiz\";\n                        }\n                        if (ur.includes(\"lesson\")) {\n                            modulename = \"lesson\";\n                            resourceId = cmid;\n                        }\n                        if (ur.includes(\"oublog\")) {\n                            modulename = \"oublog\";\n                            resourceId = 0;\n                        }\n                        if (cmid === null) {\n                            cmid = 0;\n                        }\n\n                        postOne('cursive_user_comments', {\n                            modulename: modulename,\n                            cmid: cmid,\n                            resourceid: resourceId,\n                            courseid: courseid,\n                            usercomment: number,\n                            timemodified: Date.now(),\n                            editorid: editorid ? editorid : \"\"\n                        });\n                        lastEvent = 'save';\n                        modal.destroy();\n                    });\n                    modal.getRoot().on(cancel, function() {\n\n                        editor.execCommand('Undo');\n                        lastEvent = 'cancel';\n                    });\n                    modal.getRoot().on(hidden, function() {\n                        if (lastEvent != 'cancel' && lastEvent != 'save') {\n                            editor.execCommand('Undo');\n                        }\n                    });\n                    return modal;\n                });\n        }).catch(error => window.console.error(error));\n\n    };\n    // eslint-disable-next-line\n    const sendKeyEvent = (events, eds) => {\n        let ur = eds.srcElement.baseURI;\n        let parm = new URL(ur);\n        ed = eds;\n        event = events;\n        // eslint-disable-next-line\n        if (ur.includes(\"attempt.php\") || ur.includes(\"forum\") || ur.includes(\"assign\") || ur.includes('lesson') || ur.includes(\"oublog\")) { } else {\n            return false;\n        }\n\n        if (ur.includes(\"forum\") && !ur.includes(\"assign\")) {\n            resourceId = parm.searchParams.get('edit');\n        } else {\n\n            resourceId = parm.searchParams.get('attempt');\n        }\n        if (resourceId === null) {\n            resourceId = 0;\n        }\n\n        if (ur.includes(\"forum\")) {\n            modulename = \"forum\";\n        }\n        if (ur.includes(\"assign\")) {\n            modulename = \"assign\";\n            resourceId = cmid;\n        }\n        if (ur.includes(\"attempt\")) {\n            modulename = \"quiz\";\n        }\n        if (ur.includes(\"lesson\")) {\n            modulename = \"lesson\";\n            resourceId = cmid;\n        }\n        if (ur.includes(\"oublog\")) {\n            modulename = \"oublog\";\n            resourceId = 0;\n        }\n\n        filename = `${userid}_${resourceId}_${cmid}_${modulename}_attempt`;\n\n        if (modulename === 'quiz') {\n            questionid = editorid.split(':')[1].split('_')[0];\n            filename = `${userid}_${resourceId}_${cmid}_${questionid}_${modulename}_attempt`;\n\n        }\n\n        if (localStorage.getItem(filename)) {\n\n            let data = JSON.parse(localStorage.getItem(filename));\n            data.push({\n                resourceId: resourceId,\n                key: ed.key,\n                keyCode: ed.keyCode,\n                event: event,\n                courseId: courseid,\n                unixTimestamp: Date.now(),\n                clientId: host,\n                personId: userid\n            });\n            localStorage.setItem(filename, JSON.stringify(data));\n        } else {\n            let data = [];\n            data.push({\n                resourceId: resourceId,\n                key: ed.key,\n                keyCode: ed.keyCode,\n                event: event,\n                courseId: courseid,\n                unixTimestamp: Date.now(),\n                clientId: host,\n                personId: userid\n            });\n            localStorage.setItem(filename, JSON.stringify(data));\n        }\n\n    };\n    editor.on('keyUp', (editor) => {\n        customTooltip();\n        sendKeyEvent(\"keyUp\", editor);\n    });\n    editor.on('Paste', async(e) => {\n        customTooltip();\n        if (isStudent && intervention) {\n            getModal(e);\n        }\n    });\n    editor.on('Redo', async(e) => {\n        customTooltip();\n        if (isStudent && intervention) {\n            getModal(e);\n        }\n    });\n    editor.on('keyDown', (editor) => {\n        sendKeyEvent(\"keyDown\", editor);\n        customTooltip();\n    });\n    // eslint-disable-next-line\n    editor.on('init', () => {\n        customTooltip();\n    });\n    editor.on('SkinLoaded', () => {\n\n        customTooltip();\n    });\n\n    /**\n     * Synchronizes data from localStorage to server\n     * @async\n     * @function SyncData\n     * @description Retrieves stored keypress data from localStorage and sends it to server\n     * @returns {Promise} Returns response from server if data exists and is successfully sent\n     * @throws {Error} Logs error to console if data submission fails\n     */\n    async function syncData() {\n\n        let data = localStorage.getItem(filename);\n\n        if (!data || data.length === 0) {\n            return;\n        } else {\n            localStorage.removeItem(filename);\n            let originalText = editor.getContent({format: 'text'});\n            try {\n                // eslint-disable-next-line\n                return await postOne('cursive_write_local_to_json', {\n                    key: ed.key,\n                    event: event,\n                    keyCode: ed.keyCode,\n                    resourceId: resourceId,\n                    cmid: cmid,\n                    modulename: modulename,\n                    editorid: editorid,\n                    \"json_data\": data,\n                    originalText: originalText\n                });\n            } catch (error) {\n                window.console.error('Error submitting data:', error);\n            }\n        }\n    }\n    /**\n     * Sets up custom tooltip functionality for the Cursive icon\n     * Initializes tooltip text, positions the icon in the menubar,\n     * and sets up mouse event handlers for showing/hiding the tooltip\n     * @function customTooltip\n     */\n    function customTooltip() {\n        if (document.querySelector('#tiny_cursive_StateIcon')) {\n            return;\n        }\n        try {\n            const tooltipText = getTooltipText();\n            const menubarDiv = document.querySelector('div[role=\"menubar\"].tox-menubar');\n            // const cursiveIcon = document.querySelector('#tiny_cursive_StateIcon');\n\n            const cursiveIcon = document.createElement('img');\n            cursiveIcon.src = hasApiKey ? iconUrl: iconGrayUrl;\n\n            // cursiveIcon.id = \"tiny_cursive_StateIcon\";\n\n            cursiveIcon.setAttribute('class', 'tiny_cursive_StateButton');\n            cursiveIcon.style.display = 'inline-block';\n\n            cursiveState(cursiveIcon, menubarDiv);\n\n            tooltipText.then((text) => {\n                setTooltip(text, document.querySelector('#tiny_cursive_StateIcon'));\n            });\n\n            jQuery('#tiny_cursive_StateIcon').on('mouseenter', function () {\n\n                jQuery(this).css('position', 'relative');\n                jQuery('.tiny_cursive_tooltip').css(tooltipCss());\n            });\n\n            jQuery('#tiny_cursive_StateIcon').on('mouseleave', function () {\n                jQuery('.tiny_cursive_tooltip').css('display', 'none');\n            });\n        } catch (error) {\n            window.console.error('Error setting up custom tooltip:', error);\n        }\n    }\n\n    /**\n     * Retrieves tooltip text strings from language files\n     * @async\n     * @function getTooltipText\n     * @returns {Promise<Object>} Object containing buttonTitle and buttonDes strings\n     */\n    async function getTooltipText() {\n        const [\n            buttonTitle,\n            buttonDes,\n        ] = await Promise.all([\n            getString('cursive:state:active', 'tiny_cursive'),\n            getString('cursive:state:active:des', 'tiny_cursive'),\n        ]);\n        return { buttonTitle, buttonDes };\n    }\n\n    /**\n     * Updates the Cursive icon state and positions it in the menubar\n     * @param {HTMLElement} cursiveIcon - The Cursive icon element to modify\n     * @param {HTMLElement} menubarDiv - The menubar div element\n     */\n    function cursiveState(cursiveIcon, menubarDiv) {\n        if (menubarDiv) {\n            const rightWrapper = document.createElement('div');\n            const imgWrapper   = document.createElement('span');\n\n            rightWrapper.style.marginLeft = 'auto';\n            rightWrapper.style.display = 'flex';\n            rightWrapper.style.alignItems = 'center';\n            imgWrapper.id = 'tiny_cursive_StateIcon';\n\n            imgWrapper.appendChild(cursiveIcon);\n            rightWrapper.appendChild(imgWrapper);\n            menubarDiv.appendChild(rightWrapper);\n        }\n    }\n\n    /**\n     * Returns CSS styles object for tooltip positioning and appearance\n     * @function tooltipCss\n     * @returns {Object} Object containing CSS properties and values for tooltip styling\n     */\n    function tooltipCss() {\n        return {\n            display: 'block',\n            position: 'absolute',\n            transform: 'translateX(-100%)',\n            backgroundColor: 'white',\n            color: 'black',\n            border: '1px solid #ccc',\n            marginBottom: '6px',\n            padding: '10px',\n            textAlign: 'justify',\n            minWidth: '200px',\n            borderRadius: '1px',\n            pointerEvents: 'none',\n            zIndex: 10000\n        };\n    }\n\n    /**\n     * Sets up tooltip content and styling for the Cursive icon\n     * @param {Object} text - Object containing tooltip text strings\n     * @param {string} text.buttonTitle - Title text for the tooltip\n     * @param {string} text.buttonDes - Description text for the tooltip\n     * @param {HTMLElement} cursiveIcon - The Cursive icon element to attach tooltip to\n     */\n    function setTooltip(text, cursiveIcon) {\n\n        const tooltipSpan = document.createElement('span');\n        const description = document.createElement('span');\n        const linebreak = document.createElement('br');\n        const tooltipTitle = document.createElement('strong');\n\n        tooltipSpan.style.display = 'none';\n        cursiveIcon.style.width = \"auto\";\n\n        tooltipTitle.textContent = text.buttonTitle;\n        tooltipTitle.style.fontSize = '16px';\n        tooltipTitle.style.fontWeight = 'bold';\n        description.textContent = text.buttonDes;\n        description.style.fontSize = '14px';\n\n        tooltipSpan.setAttribute('class', 'tiny_cursive_tooltip shadow');\n        tooltipSpan.appendChild(tooltipTitle);\n        tooltipSpan.appendChild(linebreak);\n        tooltipSpan.appendChild(description);\n        cursiveIcon.appendChild(tooltipSpan);\n    }\n\n    window.addEventListener('unload', () => {\n        syncData();\n    });\n\n    setInterval(syncData, syncInterval);\n};\n"],"names":["editor","interval","userId","hasApiKey","isStudent","hasClass","intervention","userid","host","M","cfg","wwwroot","courseid","courseId","filename","quizSubmit","ed","event","resourceId","modulename","editorid","id","cmid","contextInstanceId","questionid","assignSubmit","syncInterval","postOne","async","methodname","args","error","window","console","on","e","preventDefault","syncData","then","off","click","getModal","Promise","all","title","titledes","placeholder","type","body","removeOnClose","done","modal","getRoot","append","show","lastEvent","save","number","document","getElementById","value","trim","execCommand","str","alert","ur","srcElement","baseURI","parm","URL","includes","searchParams","get","resourceid","usercomment","timemodified","Date","now","destroy","cancel","hidden","catch","sendKeyEvent","events","eds","split","localStorage","getItem","data","JSON","parse","push","key","keyCode","unixTimestamp","clientId","personId","setItem","stringify","length","removeItem","originalText","getContent","format","customTooltip","querySelector","tooltipText","buttonTitle","buttonDes","getTooltipText","menubarDiv","cursiveIcon","createElement","src","iconUrl","iconGrayUrl","setAttribute","style","display","rightWrapper","imgWrapper","marginLeft","alignItems","appendChild","cursiveState","text","tooltipSpan","description","linebreak","tooltipTitle","width","textContent","fontSize","fontWeight","setTooltip","this","css","position","transform","backgroundColor","color","border","marginBottom","padding","textAlign","minWidth","borderRadius","pointerEvents","zIndex","addEventListener","setInterval"],"mappings":"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"}