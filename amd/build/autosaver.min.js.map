{"version":3,"file":"autosaver.min.js","sources":["../src/autosaver.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     tiny_cursive/autosaver\n * @category   TinyMCE Editor\n * @copyright  CTI <info@cursivetechnology.com>\n * @author     Brain Station 23 <sales@brainstation-23.com>\n */\n\nimport {call} from 'core/ajax';\nimport {create} from 'core/modal_factory';\nimport {get_string as getString} from 'core/str';\nimport {save, cancel, hidden} from 'core/modal_events';\nimport {iconUrl, iconGrayUrl, tooltipCss} from 'tiny_cursive/common';\n\nexport const register = (editor, interval, userId, hasApiKey, MODULES) => {\n    var is_student = !document.querySelector('#body').classList.contains('teacher_admin');\n    var intervention = document.querySelector('#body').classList.contains('intervention');\n    var host = M.cfg.wwwroot;\n    var userid = userId;\n    var courseid = M.cfg.courseId;\n    var editorid = editor?.id;\n    var cmid = M.cfg.contextInstanceId;\n    var ed = \"\";\n    var event = \"\";\n    var filename = \"\";\n    var modulename = \"\";\n    var questionid = 0;\n    var resourceId = 0;\n    var quizSubmit = document.getElementById('mod_quiz-next-nav');\n    var assignSubmit = document.getElementById('id_submitbutton');\n    var syncInterval = interval ? interval * 1000 : 10000; // Default: Sync Every 10s.\n    var lastCaretPos = 1;\n    let pastedContents = [];\n\n    const postOne = async (methodname, args) => {\n        try {\n            const response = await call([{ methodname, args }])[0];\n            return response;\n        } catch (error) {\n            window.console.error('Error in postOne:', error);\n            throw error;\n        }\n    };\n\n    if (document.getElementById('page-mod-assign-editsubmission') ||\n        document.getElementById('page-mod-forum-post') ||\n        document.getElementById('page-mod-forum-view')) {\n\n        if (assignSubmit) {\n            const handleAssignSubmit = async function(e) {\n                e.preventDefault();\n\n            if (filename) {\n                await syncData();\n            }\n\n            assignSubmit.removeEventListener('click', handleAssignSubmit);\n            assignSubmit.click();\n            assignSubmit.removeEventListener('click', handleAssignSubmit);\n\n            localStorage.removeItem('lastCopyCutContent');\n        };\n\n        assignSubmit.addEventListener('click', handleAssignSubmit);\n    }\n    }\n\n    if (document.getElementById('page-mod-quiz-attempt')) {\n        if (quizSubmit) {\n            const handleQuizSubmit = async (e) => {\n                e.preventDefault();\n\n                if (filename) {\n                    await syncData();\n                    document.querySelector('#responseform').submit();\n                } else {\n                    quizSubmit.removeEventListener('click', handleQuizSubmit);\n                    quizSubmit.click();\n                }\n\n                localStorage.removeItem('lastCopyCutContent');\n            };\n\n            quizSubmit.addEventListener('click', handleQuizSubmit);\n        }\n    }\n\n    const getModal = (e) => {\n        Promise.all([\n            getString('tiny_cursive_srcurl', 'tiny_cursive'),\n            getString('tiny_cursive_srcurl_des', 'tiny_cursive'),\n            getString('tiny_cursive_placeholder', 'tiny_cursive')\n        ]).then(function([title, titledes, placeholder]) {\n            return create({\n                type: 'SAVE_CANCEL',\n                title: `<div><div class=\"tiny-cursive-title-text\">${title}</div>\n                <span class=\"tiny-cursive-title-description \">${titledes}</span></div>`,\n                body: `<textarea class=\"form-control inputUrl\" value=\"\" id=\"inputUrl\" placeholder=\"${placeholder}\"></textarea>`,\n                removeOnClose: true,\n            }).done(modal => {\n                modal.getRoot().addClass('tiny-cursive-modal');\n                modal.show();\n                var lastEvent = '';\n                modal.getRoot().on(save, function() {\n                    var number = document.getElementById(\"inputUrl\").value.trim();\n                    let ur = e.srcElement.baseURI;\n                    let parm = new URL(ur);\n                    let modulesInfo = getModulesInfo(ur, parm, MODULES);\n                    resourceId = modulesInfo.resourceId;\n                    modulename = modulesInfo.name;\n                    if (number === \"\" || number === null || number === undefined) {\n                        editor.execCommand('Undo');\n                        getString('pastewarning', 'tiny_cursive').then(str => alert(str));\n                    } else {\n                        editor.execCommand('Paste');\n                    }\n                    postOne('cursive_user_comments', {\n                        modulename: modulename,\n                        cmid: cmid,\n                        resourceid: resourceId,\n                        courseid: courseid,\n                        usercomment: number,\n                        timemodified: Date.now(),\n                        editorid: editorid ? editorid : \"\"\n                    });\n                    lastEvent = 'save';\n                    modal.destroy();\n                });\n                modal.getRoot().on(cancel, function() {\n                    editor.execCommand('Undo');\n                    lastEvent = 'cancel';\n                });\n                modal.getRoot().on(hidden, function() {\n                    if (lastEvent !== 'cancel' && lastEvent !== 'save') {\n                        editor.execCommand('Undo');\n                    }\n                });\n                return modal;\n            });\n        }).catch(error => window.console.error(error));\n    };\n\n    const sendKeyEvent = (events, eds) => {\n        ed = eds;\n        event = events;\n        let ur = eds.srcElement.baseURI;\n        let parm = new URL(ur);\n        let modulesInfo = getModulesInfo(ur, parm, MODULES);\n        resourceId = modulesInfo.resourceId;\n        modulename = modulesInfo.name;\n        filename = `${userid}_${resourceId}_${cmid}_${modulename}_attempt`;\n        if (modulename === 'quiz') {\n            questionid = editorid.split(':')[1].split('_')[0];\n            filename = `${userid}_${resourceId}_${cmid}_${questionid}_${modulename}_attempt`;\n        }\n        if (ed.key !== \"Process\") {\n            if (localStorage.getItem(filename)) {\n                let data = JSON.parse(localStorage.getItem(filename));\n                data.push({\n                    resourceId: resourceId,\n                    key: ed.key,\n                    keyCode: ed.keyCode,\n                    event: event,\n                    courseId: courseid,\n                    unixTimestamp: Date.now(),\n                    clientId: host,\n                    personId: userid,\n                    position: ed.caretPosition,\n                    rePosition: ed.rePosition,\n                    pastedContent: pastedContents\n                });\n                localStorage.setItem(filename, JSON.stringify(data));\n            } else {\n                let data = [{\n                    resourceId: resourceId,\n                    key: ed.key,\n                    keyCode: ed.keyCode,\n                    event: event,\n                    courseId: courseid,\n                    unixTimestamp: Date.now(),\n                    clientId: host,\n                    personId: userid,\n                    position: ed.caretPosition,\n                    rePosition: ed.rePosition,\n                    pastedContent: pastedContents\n                }];\n                localStorage.setItem(filename, JSON.stringify(data));\n            }\n        }\n    };\n\n    editor.on('keyUp', (editor) => {\n        customTooltip();\n        let position = getCaretPosition(true);\n        editor.caretPosition = position.caretPosition;\n        editor.rePosition = position.rePosition;\n        sendKeyEvent(\"keyUp\", editor);\n    });\n\n    editor.on('Paste', async (e) => {\n        customTooltip();\n        const pastedContent = (e.clipboardData || e.originalEvent.clipboardData).getData('text');\n        if (!pastedContent) {\n            return;\n        }\n        if (is_student && intervention) {\n            if (pastedContent !== localStorage.getItem('lastCopyCutContent')) {\n                getModal(e);\n                pastedContents = [];\n                pastedContents.push(pastedContent);\n                let position = getCaretPosition(true);\n                editor.caretPosition = position.caretPosition;\n                editor.rePosition = position.rePosition;\n                sendKeyEvent(\"Paste\", {\n                    ...e,\n                    key: \"v\",\n                    keyCode: 86,\n                    caretPosition: editor.caretPosition,\n                    rePosition: editor.rePosition\n                });\n            }\n        }\n    });\n\n    editor.on('Redo', async (e) => {\n        customTooltip();\n        if (is_student && intervention) {\n            getModal(e);\n        }\n    });\n\n    editor.on('keyDown', (editor) => {\n        customTooltip();\n        let position = getCaretPosition();\n        editor.caretPosition = position.caretPosition;\n        editor.rePosition = position.rePosition;\n        sendKeyEvent(\"keyDown\", editor);\n    });\n\n    editor.on('Cut', () => {\n        const selectedContent = editor.selection.getContent({format: 'text'});\n        localStorage.setItem('lastCopyCutContent', selectedContent.trim());\n    });\n\n    editor.on('Copy', () => {\n        const selectedContent = editor.selection.getContent({format: 'text'});\n        localStorage.setItem('lastCopyCutContent', selectedContent.trim());\n    });\n\n    editor.on('mouseDown', async (editor) => {\n        constructMouseEvent(editor);\n        sendKeyEvent(\"mouseDown\", editor);\n    });\n\n    editor.on('mouseUp', async (editor) => {\n        constructMouseEvent(editor);\n        sendKeyEvent(\"mouseUp\", editor);\n    });\n\n    editor.on('init', () => {\n        customTooltip();\n    });\n\n    editor.on('SetContent', () => {\n        customTooltip();\n    });\n\n     /**\n     * Constructs a mouse event object with caret position and button information\n     * @param {Object} editor - The TinyMCE editor instance\n     * @function constructMouseEvent\n     * @description Sets caret position, reposition, key and keyCode properties on the editor object based on current mouse state\n     */\n    function constructMouseEvent(editor) {\n        let position = getCaretPosition();\n        editor.caretPosition = position.caretPosition;\n        editor.rePosition = position.rePosition;\n        editor.key = getMouseButton(editor);\n        editor.keyCode = editor.button;\n    }\n\n     /**\n     * Gets the string representation of a mouse button based on its numeric value\n     * @param {Object} editor - The editor object containing button information\n     * @returns {string} The string representation of the mouse button ('left', 'middle', or 'right')\n     */\n    function getMouseButton(editor) {\n        switch (editor.button) {\n            case 0:\n                return 'left';\n            case 1:\n                return 'middle';\n            case 2:\n                return 'right';\n        }\n        return null;\n    }\n\n    /**\n     * Gets the current caret position in the editor\n     * @param {boolean} skip - If true, returns the last known caret position instead of calculating a new one\n     * @returns {Object} Object containing:\n     *   - caretPosition: Sequential position number stored in session\n     *   - rePosition: Absolute character offset from start of content\n     * @throws {Error} Logs warning to console if error occurs during calculation\n     */\n    function getCaretPosition(skip = false) {\n        try {\n            if (!editor || !editor.selection) {\n                return {caretPosition: 0, rePosition: 0};\n            }\n            const rng = editor.selection.getRng();\n            let absolutePosition = 0;\n            let node = rng.startContainer;\n            absolutePosition = rng.startOffset;\n            while (node && node !== editor.getBody()) {\n                while (node.previousSibling) {\n                    node = node.previousSibling;\n                    if (node.textContent) {\n                        absolutePosition += node.textContent.length;\n                    }\n                }\n                node = node.parentNode;\n            }\n            if (skip) {\n                return {\n                    caretPosition: lastCaretPos,\n                    rePosition: absolutePosition\n                };\n            }\n            const storageKey = `${userid}_${resourceId}_${cmid}_position`;\n            let storedPos = parseInt(sessionStorage.getItem(storageKey), 10);\n            if (isNaN(storedPos)) {\n                storedPos = 0;\n            }\n            storedPos++;\n            lastCaretPos = storedPos;\n            sessionStorage.setItem(storageKey, storedPos);\n            return {\n                caretPosition: storedPos,\n                rePosition: absolutePosition\n            };\n        } catch (e) {\n            window.console.warn('Error getting caret position:', e);\n            return {caretPosition: 0, rePosition: 0};\n        }\n    }\n\n     /**\n     * Synchronizes data from localStorage to server\n     * @async\n     * @function SyncData\n     * @description Retrieves stored keypress data from localStorage and sends it to server\n     * @returns {Promise} Returns response from server if data exists and is successfully sent\n     * @throws {Error} Logs error to console if data submission fails\n     */\n    async function syncData() {\n        let data = localStorage.getItem(filename);\n        if (!data || data.length === 0) {\n            return;\n        } else {\n            localStorage.removeItem(filename);\n            let originalText = editor.getContent({format: 'text'});\n            try {\n                return await postOne('cursive_write_local_to_json', {\n                    key: ed.key,\n                    event: event,\n                    keyCode: ed.keyCode,\n                    resourceId: resourceId,\n                    cmid: cmid,\n                    modulename: modulename,\n                    editorid: editorid,\n                    json_data: data,\n                    originalText: originalText\n                });\n            } catch (error) {\n                window.console.error('Error submitting data:', error);\n            }\n        }\n    }\n\n     /**\n     * Sets up custom tooltip functionality for the Cursive icon\n     * Initializes tooltip text, positions the icon in the menubar,\n     * and sets up mouse event handlers for showing/hiding the tooltip\n     * @function customTooltip\n     */\n    function customTooltip() {\n        try {\n            const tooltipText = getTooltipText();\n            const menubarDiv = document.querySelectorAll('div[role=\"menubar\"].tox-menubar');\n            let classArray = [];\n            if (menubarDiv.length) {\n                menubarDiv.forEach(function(element, index) {\n                    index += 1;\n                    let className = 'cursive-menu-' + index;\n                    element.classList.add(className);\n                    classArray.push(className);\n                });\n            }\n            const cursiveIcon = document.createElement('img');\n            cursiveIcon.src = hasApiKey ? iconUrl : iconGrayUrl;\n            cursiveIcon.setAttribute('class', 'tiny_cursive_StateButton');\n            cursiveIcon.style.display = 'inline-block';\n            cursiveState(cursiveIcon, menubarDiv, classArray);\n            for (let index in classArray) {\n                const elementId = \"tiny_cursive_StateIcon\" + index;\n                const tooltipId = `tiny_cursive_tooltip${index}`;\n                tooltipText.then((text) => {\n                    return setTooltip(text, document.querySelector(`#${elementId}`), tooltipId);\n                }).catch(error => window.console.error(error));\n                const element = document.querySelector(`#${elementId}`);\n                if (element) {\n                    element.addEventListener('mouseenter', function() {\n                        this.style.position = 'relative';\n                        const tooltip = document.querySelector(`#${tooltipId}`);\n                        if (tooltip) {\n                            Object.assign(tooltip.style, tooltipCss);\n                        }\n                    });\n                    element.addEventListener('mouseleave', function() {\n                        const tooltip = document.querySelector(`#${tooltipId}`);\n                        if (tooltip) {\n                            tooltip.style.display = 'none';\n                        }\n                    });\n                }\n            }\n        } catch (error) {\n            window.console.error('Error setting up custom tooltip:', error);\n        }\n    }\n\n     /**\n     * Retrieves tooltip text strings from language files\n     * @async\n     * @function getTooltipText\n     * @returns {Promise<Object>} Object containing buttonTitle and buttonDes strings\n     */\n    async function getTooltipText() {\n        const [buttonTitle, buttonDes] = await Promise.all([\n            getString('cursive:state:active', 'tiny_cursive'),\n            getString('cursive:state:active:des', 'tiny_cursive'),\n        ]);\n        return {buttonTitle, buttonDes};\n    }\n\n     /**\n     * Updates the Cursive icon state and positions it in the menubar\n     * @param {HTMLElement} cursiveIcon - The Cursive icon element to modify\n     * @param {HTMLElement} menubarDiv - The menubar div element\n     * @param {Array} classArray - Array of class names for the menubar div elements\n     */\n    function cursiveState(cursiveIcon, menubarDiv, classArray) {\n        if (menubarDiv) {\n            for (let index in classArray) {\n                const rightWrapper = document.createElement('div');\n                const imgWrapper = document.createElement('span');\n                const iconClone = cursiveIcon.cloneNode(true);\n                const targetMenu = document.querySelector('.' + classArray[index]);\n                let elementId = \"tiny_cursive_StateIcon\" + index;\n                rightWrapper.style.marginLeft = 'auto';\n                rightWrapper.style.display = 'flex';\n                rightWrapper.style.alignItems = 'center';\n                imgWrapper.id = elementId;\n                imgWrapper.appendChild(iconClone);\n                rightWrapper.appendChild(imgWrapper);\n                if (targetMenu && !targetMenu.querySelector(`#${elementId}`)) {\n                    targetMenu.appendChild(rightWrapper);\n                }\n            }\n        }\n    }\n\n    /**\n     * Sets up tooltip content and styling for the Cursive icon\n     * @param {Object} text - Object containing tooltip text strings\n     * @param {string} text.buttonTitle - Title text for the tooltip\n     * @param {string} text.buttonDes - Description text for the tooltip\n     * @param {HTMLElement} cursiveIcon - The Cursive icon element to attach tooltip to\n     * @param {string} tooltipId - ID for the tooltip element\n     */\n    function setTooltip(text, cursiveIcon, tooltipId) {\n        if (document.querySelector(`#${tooltipId}`)) {\n            return;\n        }\n        if (cursiveIcon) {\n            const tooltipSpan = document.createElement('span');\n            const description = document.createElement('span');\n            const linebreak = document.createElement('br');\n            const tooltipTitle = document.createElement('strong');\n            tooltipSpan.style.display = 'none';\n            tooltipTitle.textContent = text.buttonTitle;\n            tooltipTitle.style.fontSize = '16px';\n            tooltipTitle.style.fontWeight = 'bold';\n            description.textContent = text.buttonDes;\n            description.style.fontSize = '14px';\n            tooltipSpan.id = tooltipId;\n            tooltipSpan.classList.add(`shadow`);\n            tooltipSpan.appendChild(tooltipTitle);\n            tooltipSpan.appendChild(linebreak);\n            tooltipSpan.appendChild(description);\n            cursiveIcon.appendChild(tooltipSpan);\n        }\n    }\n\n    /**\n     * Extracts module information from URL parameters\n     * @param {string} ur - The base URL to analyze\n     * @param {URL} parm - URL object containing search parameters\n     * @param {Array} MODULES - Array of valid module names to check against\n     * @returns {Object|boolean} Object containing resourceId and module name if found, false if no valid module\n     */\n    function getModulesInfo(ur, parm, MODULES) {\n        if (!MODULES.some(module => ur.includes(module))) {\n            return false;\n        }\n        if (ur.includes(\"forum\") && !ur.includes(\"assign\")) {\n            resourceId = parm.searchParams.get('edit');\n        } else {\n            resourceId = parm.searchParams.get('attempt');\n        }\n        if (resourceId === null) {\n            resourceId = 0;\n        }\n        for (const module of MODULES) {\n            if (ur.includes(module)) {\n                modulename = module;\n                if (module === \"lesson\" || module === \"assign\") {\n                    resourceId = cmid;\n                } else if (module === \"oublog\") {\n                    resourceId = 0;\n                }\n                break;\n            }\n        }\n        return {resourceId: resourceId, name: modulename};\n    }\n\n    window.addEventListener('unload', () => {\n        syncData();\n    });\n\n    setInterval(syncData, syncInterval);\n};\n"],"names":["editor","interval","userId","hasApiKey","MODULES","is_student","document","querySelector","classList","contains","intervention","host","M","cfg","wwwroot","userid","courseid","courseId","editorid","id","cmid","contextInstanceId","ed","event","filename","modulename","questionid","resourceId","quizSubmit","getElementById","assignSubmit","syncInterval","lastCaretPos","pastedContents","postOne","async","methodname","args","error","window","console","handleAssignSubmit","e","preventDefault","syncData","removeEventListener","click","localStorage","removeItem","addEventListener","handleQuizSubmit","submit","getModal","Promise","all","then","title","titledes","placeholder","type","body","removeOnClose","done","modal","getRoot","addClass","show","lastEvent","on","save","number","value","trim","ur","srcElement","baseURI","modulesInfo","getModulesInfo","URL","name","execCommand","str","alert","resourceid","usercomment","timemodified","Date","now","destroy","cancel","hidden","catch","sendKeyEvent","events","eds","split","key","getItem","data","JSON","parse","push","keyCode","unixTimestamp","clientId","personId","position","caretPosition","rePosition","pastedContent","setItem","stringify","constructMouseEvent","getCaretPosition","button","getMouseButton","skip","selection","rng","getRng","absolutePosition","node","startContainer","startOffset","getBody","previousSibling","textContent","length","parentNode","storageKey","storedPos","parseInt","sessionStorage","isNaN","warn","originalText","getContent","format","json_data","customTooltip","tooltipText","buttonTitle","buttonDes","getTooltipText","menubarDiv","querySelectorAll","classArray","forEach","element","index","className","add","cursiveIcon","createElement","src","iconUrl","iconGrayUrl","setAttribute","style","display","rightWrapper","imgWrapper","iconClone","cloneNode","targetMenu","elementId","marginLeft","alignItems","appendChild","cursiveState","tooltipId","text","setTooltip","tooltip","Object","assign","tooltipCss","tooltipSpan","description","linebreak","tooltipTitle","fontSize","fontWeight","parm","some","module","includes","searchParams","get","clipboardData","originalEvent","getData","selectedContent","setInterval"],"mappings":"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"}