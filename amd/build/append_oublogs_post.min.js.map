{"version":3,"file":"append_oublogs_post.min.js","sources":["../src/append_oublogs_post.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * This module provides functionality to append blog posts in the OU Blogs plugin for TinyMCE editor\n *\n * @module     tiny_cursive/append_oublogs_post\n * @copyright  2025  CTI <info@cursivetechnology.com>\n * @author     Brain Station 23 <sales@brainstation-23.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport { call as getData } from 'core/ajax';\nimport templates from 'core/templates';\nimport AnalyticEvents from './analytic_events';\nimport analyticButton from './analytic_button';\nimport Replay from './replay';\n\nexport const init = (scoreSetting) => {\n    const replayInstances = {};\n    // eslint-disable-next-line camelcase\n    window.video_playback = function (mid, filepath) {\n        if (filepath !== '') {\n            const replay = new Replay(\n                'content' + mid,\n                filepath,\n                10,\n                false,\n                'player_' + mid\n            );\n            replayInstances[mid] = replay;\n        } else {\n            templates.render('tiny_cursive/no_submission').then(html => {\n                const contentElement = document.getElementById('content' + mid);\n                if (contentElement) {\n                    contentElement.innerHTML = html;\n                }\n                return true;\n            }).catch(e => window.console.error(e));\n        }\n        return false;\n\n    };\n\n    const ouBlogPosts = document.querySelectorAll('.oublog-post');\n    const cmid = M.cfg.contextInstanceId;\n    ouBlogPosts.forEach(function (element) {\n        const postedByLink = element.querySelector('.oublog-postedby a');\n        const permalinkElement = element.querySelector('.oublog-post-links a');\n\n        const postedByHref = postedByLink.getAttribute('href');\n        const permalink = permalinkElement.getAttribute('href');\n\n        const resourceIdParam = new URLSearchParams(permalink.split('?')[1]).get('post');\n        const useridParam = new URLSearchParams(postedByHref.split('?')[1]).get('id');\n\n        const resourceId = resourceIdParam ? parseInt(resourceIdParam) : 0;\n        const userid = useridParam ? parseInt(useridParam) : 0;\n        let filepath = '';\n\n        if (userid && resourceId) {\n            let args = { id: userid, resourceid: resourceId, modulename: \"oublog\", cmid: cmid };\n            let methodname = 'cursive_get_oublog_submission_data';\n            let com = getData([{ methodname, args }]);\n\n            com[0].done(function (json) {\n                var data = JSON.parse(json);\n                if (data.res.filename) {\n                    filepath = data.res.filename;\n                }\n\n                const postLinksElement = element.querySelector('.oublog-post-links');\n                if (postLinksElement) {\n                    postLinksElement.append(analyticButton(userid));\n                }\n\n                const myEvents = new AnalyticEvents();\n                const context = {\n                    tabledata: data.res,\n                    formattime: myEvents.formatedTime(data.res),\n                    page: scoreSetting,\n                    userid: userid,\n                };\n\n                const authIcon = myEvents.authorshipStatus(data.res.first_file, data.res.score, scoreSetting);\n                myEvents.createModal(userid, context, '', authIcon);\n                myEvents.analytics(userid, templates, context, '', replayInstances, authIcon);\n                myEvents.checkDiff(userid, data.res.file_id, '', replayInstances);\n                myEvents.replyWriting(userid, filepath, '', replayInstances);\n                myEvents.quality(userid, templates, context, '', replayInstances, cmid);\n            });\n\n            com[0].fail((error) => {\n                window.console.error(error);\n            });\n        }\n    });\n\n};"],"names":["scoreSetting","replayInstances","window","video_playback","mid","filepath","replay","Replay","render","then","html","contentElement","document","getElementById","innerHTML","catch","e","console","error","ouBlogPosts","querySelectorAll","cmid","M","cfg","contextInstanceId","forEach","element","postedByLink","querySelector","permalinkElement","postedByHref","getAttribute","permalink","resourceIdParam","URLSearchParams","split","get","useridParam","resourceId","parseInt","userid","args","id","resourceid","modulename","methodname","com","done","json","data","JSON","parse","res","filename","postLinksElement","append","myEvents","AnalyticEvents","context","tabledata","formattime","formatedTime","page","authIcon","authorshipStatus","first_file","score","createModal","analytics","templates","checkDiff","file_id","replyWriting","quality","fail"],"mappings":";;;;;;;;0SA8BqBA,qBACXC,gBAAkB,GAExBC,OAAOC,eAAiB,SAAUC,IAAKC,aAClB,KAAbA,SAAiB,OACXC,OAAS,IAAIC,gBACf,UAAYH,IACZC,SACA,IACA,EACA,UAAYD,KAEhBH,gBAAgBG,KAAOE,+BAEbE,OAAO,8BAA8BC,MAAKC,aAC1CC,eAAiBC,SAASC,eAAe,UAAYT,YACvDO,iBACAA,eAAeG,UAAYJ,OAExB,KACRK,OAAMC,GAAKd,OAAOe,QAAQC,MAAMF,YAEhC,SAILG,YAAcP,SAASQ,iBAAiB,gBACxCC,KAAOC,EAAEC,IAAIC,kBACnBL,YAAYM,SAAQ,SAAUC,eACpBC,aAAeD,QAAQE,cAAc,sBACrCC,iBAAmBH,QAAQE,cAAc,wBAEzCE,aAAeH,aAAaI,aAAa,QACzCC,UAAYH,iBAAiBE,aAAa,QAE1CE,gBAAkB,IAAIC,gBAAgBF,UAAUG,MAAM,KAAK,IAAIC,IAAI,QACnEC,YAAc,IAAIH,gBAAgBJ,aAAaK,MAAM,KAAK,IAAIC,IAAI,MAElEE,WAAaL,gBAAkBM,SAASN,iBAAmB,EAC3DO,OAASH,YAAcE,SAASF,aAAe,MACjDhC,SAAW,MAEXmC,QAAUF,WAAY,KAClBG,KAAO,CAAEC,GAAIF,OAAQG,WAAYL,WAAYM,WAAY,SAAUvB,KAAMA,MACzEwB,WAAa,qCACbC,KAAM,cAAQ,CAAC,CAAED,WAAAA,WAAYJ,KAAAA,QAEjCK,IAAI,GAAGC,MAAK,SAAUC,UACdC,KAAOC,KAAKC,MAAMH,MAClBC,KAAKG,IAAIC,WACThD,SAAW4C,KAAKG,IAAIC,gBAGlBC,iBAAmB5B,QAAQE,cAAc,sBAC3C0B,kBACAA,iBAAiBC,QAAO,4BAAef,eAGrCgB,SAAW,IAAIC,yBACfC,QAAU,CACZC,UAAWV,KAAKG,IAChBQ,WAAYJ,SAASK,aAAaZ,KAAKG,KACvCU,KAAM9D,aACNwC,OAAQA,QAGNuB,SAAWP,SAASQ,iBAAiBf,KAAKG,IAAIa,WAAYhB,KAAKG,IAAIc,MAAOlE,cAChFwD,SAASW,YAAY3B,OAAQkB,QAAS,GAAIK,UAC1CP,SAASY,UAAU5B,OAAQ6B,mBAAWX,QAAS,GAAIzD,gBAAiB8D,UACpEP,SAASc,UAAU9B,OAAQS,KAAKG,IAAImB,QAAS,GAAItE,iBACjDuD,SAASgB,aAAahC,OAAQnC,SAAU,GAAIJ,iBAC5CuD,SAASiB,QAAQjC,OAAQ6B,mBAAWX,QAAS,GAAIzD,gBAAiBoB,SAGtEyB,IAAI,GAAG4B,MAAMxD,QACThB,OAAOe,QAAQC,MAAMA"}