{"version":3,"file":"append_oublogs_post.min.js","sources":["../src/append_oublogs_post.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * This module provides functionality to append blog posts in the OU Blogs plugin for TinyMCE editor\r\n *\r\n * @module     tiny_cursive/append_oublogs_post\r\n * @copyright  2025  CTI <info@cursivetechnology.com>\r\n * @author     Brain Station 23 <sales@brainstation-23.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport $ from 'jquery';\r\nimport {call as getData} from 'core/ajax';\r\nimport templates from 'core/templates';\r\nimport AnalyticEvents from './analytic_events';\r\nimport analyticButton from './analytic_button';\r\nimport replayButton from './replay_button';\r\nimport Replay from './replay';\r\n\r\nexport const init = (scoreSetting, comments, hasApiKey) => {\r\n    const replayInstances = {};\r\n    // eslint-disable-next-line camelcase\r\n    window.video_playback = function(mid, filepath) {\r\n        if (filepath !== '') {\r\n            const replay = new Replay(\r\n                'content' + mid,\r\n                filepath,\r\n                10,\r\n                false,\r\n                'player_' + mid\r\n            );\r\n            replayInstances[mid] = replay;\r\n        } else {\r\n            templates.render('tiny_cursive/no_submission').then(html => {\r\n                $('#content' + mid).html(html);\r\n                return true;\r\n            }).catch(e => window.console.error(e));\r\n        }\r\n        return false;\r\n\r\n    };\r\n\r\n    const ouBlogPosts = $('.oublog-post');\r\n    const cmid = M.cfg.contextInstanceId;\r\n    ouBlogPosts.each(function() {\r\n\r\n        var Element = $(this);\r\n        var postedByLink = Element.find('.oublog-postedby a').attr('href');\r\n        var permalink = Element.find('.oublog-post-links a').attr('href');\r\n        var resourceId = parseInt(new URLSearchParams(permalink.split('?')[1]).get('post'));\r\n        var userid = parseInt(new URLSearchParams(postedByLink.split('?')[1]).get('id'));\r\n        var filepath = '';\r\n\r\n        if (userid && resourceId) {\r\n            let args = {id: userid, resourceid: resourceId, modulename: \"oublog\", cmid: cmid};\r\n            let methodname = 'cursive_get_oublog_submission_data';\r\n            let com = getData([{methodname, args}]);\r\n            com[0].done(function(json) {\r\n                var data = JSON.parse(json);\r\n\r\n                if (data.res.filename) {\r\n                    filepath = data.res.filename;\r\n                }\r\n\r\n                if (!hasApiKey) {\r\n                    Element.find('.oublog-post-links').append(replayButton(userid));\r\n                } else {\r\n                    Element.find('.oublog-post-links').append(analyticButton(data.res.effort_ratio, userid));\r\n                }\r\n\r\n                let myEvents = new AnalyticEvents();\r\n                var context = {\r\n                    tabledata: data.res,\r\n                    formattime: myEvents.formatedTime(data.res),\r\n                    page: scoreSetting,\r\n                    userid: userid,\r\n                    apikey: hasApiKey\r\n                };\r\n\r\n                let authIcon = myEvents.authorshipStatus(data.res.first_file, data.res.score, scoreSetting);\r\n                myEvents.createModal(userid, context, '', replayInstances, authIcon);\r\n                myEvents.analytics(userid, templates, context, '', replayInstances, authIcon);\r\n                myEvents.checkDiff(userid, data.res.file_id, '', replayInstances);\r\n                myEvents.replyWriting(userid, filepath, '', replayInstances);\r\n\r\n            });\r\n            com[0].fail((error) => {\r\n                window.console.error(error);\r\n            });\r\n        }\r\n    });\r\n\r\n};"],"names":["scoreSetting","comments","hasApiKey","replayInstances","window","video_playback","mid","filepath","replay","Replay","render","then","html","catch","e","console","error","ouBlogPosts","cmid","M","cfg","contextInstanceId","each","Element","this","postedByLink","find","attr","permalink","resourceId","parseInt","URLSearchParams","split","get","userid","args","id","resourceid","modulename","methodname","com","done","json","data","JSON","parse","res","filename","append","effort_ratio","myEvents","AnalyticEvents","context","tabledata","formattime","formatedTime","page","apikey","authIcon","authorshipStatus","first_file","score","createModal","analytics","templates","checkDiff","file_id","replyWriting","fail"],"mappings":";;;;;;;;wYAgCoB,CAACA,aAAcC,SAAUC,mBACnCC,gBAAkB,GAExBC,OAAOC,eAAiB,SAASC,IAAKC,aACjB,KAAbA,SAAiB,OACXC,OAAS,IAAIC,gBACf,UAAYH,IACZC,SACA,IACA,EACA,UAAYD,KAEhBH,gBAAgBG,KAAOE,+BAEbE,OAAO,8BAA8BC,MAAKC,2BAC9C,WAAaN,KAAKM,KAAKA,OAClB,KACRC,OAAMC,GAAKV,OAAOW,QAAQC,MAAMF,YAEhC,SAILG,aAAc,mBAAE,gBAChBC,KAAOC,EAAEC,IAAIC,kBACnBJ,YAAYK,MAAK,eAETC,SAAU,mBAAEC,MACZC,aAAeF,QAAQG,KAAK,sBAAsBC,KAAK,QACvDC,UAAYL,QAAQG,KAAK,wBAAwBC,KAAK,QACtDE,WAAaC,SAAS,IAAIC,gBAAgBH,UAAUI,MAAM,KAAK,IAAIC,IAAI,SACvEC,OAASJ,SAAS,IAAIC,gBAAgBN,aAAaO,MAAM,KAAK,IAAIC,IAAI,OACtE1B,SAAW,MAEX2B,QAAUL,WAAY,KAClBM,KAAO,CAACC,GAAIF,OAAQG,WAAYR,WAAYS,WAAY,SAAUpB,KAAMA,MACxEqB,WAAa,qCACbC,KAAM,cAAQ,CAAC,CAACD,WAAAA,WAAYJ,KAAAA,QAChCK,IAAI,GAAGC,MAAK,SAASC,UACbC,KAAOC,KAAKC,MAAMH,MAElBC,KAAKG,IAAIC,WACTxC,SAAWoC,KAAKG,IAAIC,UAGnB7C,UAGDqB,QAAQG,KAAK,sBAAsBsB,QAAO,4BAAeL,KAAKG,IAAIG,aAAcf,SAFhFX,QAAQG,KAAK,sBAAsBsB,QAAO,0BAAad,aAKvDgB,SAAW,IAAIC,6BACfC,QAAU,CACVC,UAAWV,KAAKG,IAChBQ,WAAYJ,SAASK,aAAaZ,KAAKG,KACvCU,KAAMxD,aACNkC,OAAQA,OACRuB,OAAQvD,eAGRwD,SAAWR,SAASS,iBAAiBhB,KAAKG,IAAIc,WAAYjB,KAAKG,IAAIe,MAAO7D,cAC9EkD,SAASY,YAAY5B,OAAQkB,QAAS,GAAIjD,gBAAiBuD,UAC3DR,SAASa,UAAU7B,OAAQ8B,mBAAWZ,QAAS,GAAIjD,gBAAiBuD,UACpER,SAASe,UAAU/B,OAAQS,KAAKG,IAAIoB,QAAS,GAAI/D,iBACjD+C,SAASiB,aAAajC,OAAQ3B,SAAU,GAAIJ,oBAGhDqC,IAAI,GAAG4B,MAAMpD,QACTZ,OAAOW,QAAQC,MAAMA"}