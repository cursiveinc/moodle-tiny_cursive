{"version":3,"file":"cursive_autosave.min.js","sources":["../src/cursive_autosave.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * TODO describe module cursive_autosave\r\n *\r\n * @module     tiny_cursive/cursive_autosave\r\n * @copyright  2025 Cursive Technology, Inc. <info@cursivetechnology.com>\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\nimport templates from 'core/templates';\r\nimport {call} from 'core/ajax';\r\nimport Icons from 'tiny_cursive/svg_repo';\r\nimport {get_string as getString} from 'core/str';\r\n\r\nexport default class CursiveAutosave {\r\n\r\n    static instance = null;\r\n\r\n\r\n    constructor(editor, rightWrapper, modules, isFullScreen) {\r\n        if (CursiveAutosave.instance) {\r\n            return CursiveAutosave.instance;\r\n        }\r\n\r\n        this.editor = editor;\r\n        this.module = modules;\r\n        this.savingState = '';\r\n        this.rightWrapper = rightWrapper;\r\n        this.isFullScreen = isFullScreen;\r\n        // Bind methods that will be used as event listener\r\n        this.fetchSavedContent = this.fetchSavedContent.bind(this);\r\n        this.handleEscapeKey = this.handleEscapeKey.bind(this);\r\n        this._savingTimer = null;\r\n        CursiveAutosave.instance = this;\r\n        this.fetchStrings();\r\n    }\r\n\r\n    static getInstance(editor, rightWrapper, modules, isFullScreen) {\r\n        if (!this.instance) {\r\n            this.instance = new CursiveAutosave(editor, rightWrapper, modules, isFullScreen);\r\n        }\r\n        this.instance.isFullScreen = isFullScreen;\r\n        const hasState = modules.modulename === 'quiz'\r\n            ? document.querySelector(`#tiny_cursive_savingState${modules.questionid}`)\r\n            : document.querySelector('#tiny_cursive_savingState');\r\n        if (!hasState) {\r\n            this.instance.init();\r\n        }\r\n\r\n        return this.instance;\r\n    }\r\n\r\n    init() {\r\n        const stateWrapper = this.cursiveSavingState(this.savingState);\r\n        stateWrapper.classList.add('tiny_cursive_savingState', 'btn');\r\n        if (this.module.modulename === 'quiz') {\r\n            stateWrapper.id = `tiny_cursive_savingState${this.module.questionid}`;\r\n        } else {\r\n            stateWrapper.id = 'tiny_cursive_savingState';\r\n        }\r\n\r\n        this.rightWrapper.prepend(stateWrapper);\r\n        stateWrapper.addEventListener('click', this.fetchSavedContent);\r\n    }\r\n\r\n    destroy() {\r\n        CursiveAutosave.instance = null;\r\n    }\r\n\r\n    static destroyInstance() {\r\n        if (this.instance) {\r\n            this.instance.destroy();\r\n            this.instance = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a wrapper div containing an icon and text to display the saving state\r\n     * @param {string} state - The current saving state ('saving', 'saved', or 'offline')\r\n     * @returns {HTMLElement} A div element containing the state icon and text\r\n     * @description Creates and returns a div element with an icon and text span to show the current saving state.\r\n     * The icon and text are updated based on the provided state parameter.\r\n     */\r\n    cursiveSavingState(state) {\r\n        let wrapperDiv = document.createElement('div');\r\n        let textSpan = document.createElement('span');\r\n        let button = document.createElement('button');\r\n        let iconSpan = document.createElement('span');\r\n\r\n        button.style.padding = '.3rem';\r\n        textSpan.style.fontSize = '0.75rem';\r\n        textSpan.style.color = 'gray';\r\n\r\n        if (this.module.modulename === 'quiz') {\r\n            iconSpan.id = `CursiveCloudIcon${this.module.questionid}`;\r\n            textSpan.id = `CursiveStateText${this.module.questionid}`;\r\n        } else {\r\n            iconSpan.id = 'CursiveCloudIcon';\r\n            textSpan.id = 'CursiveStateText';\r\n        }\r\n        if (state) {\r\n            textSpan.textContent = this.getStateText(state);\r\n            iconSpan.innerHTML = this.getStateIcon(state);\r\n        }\r\n\r\n        wrapperDiv.style.verticalAlign = 'middle';\r\n\r\n        wrapperDiv.appendChild(iconSpan);\r\n        wrapperDiv.appendChild(textSpan);\r\n        button.appendChild(wrapperDiv);\r\n\r\n        return button;\r\n    }\r\n\r\n    /**\r\n     * Updates the saving state icon and text in the editor\r\n     * @param {string} state - The state to update to ('saving', 'saved', or 'offline')\r\n     * @description Updates the global saving state and modifies the UI elements to reflect the new state\r\n     */\r\n    static updateSavingState(state) {\r\n        const instance = this.instance;\r\n        instance.savingState = state;\r\n        let stateWrapper = null;\r\n        if (instance.module.modulename === 'quiz') {\r\n            stateWrapper = document.querySelector(`#tiny_cursive_savingState${instance.module.questionid}`);\r\n        } else {\r\n            stateWrapper = document.querySelector('#tiny_cursive_savingState');\r\n        }\r\n\r\n        let iconSpan = '';\r\n        let stateTextEl = '';\r\n\r\n        if (!stateWrapper) {\r\n            return;\r\n        }\r\n\r\n        if (instance.module.modulename === 'quiz') {\r\n            iconSpan = stateWrapper.querySelector(`#CursiveCloudIcon${instance.module.questionid}`);\r\n            stateTextEl = stateWrapper.querySelector(`#CursiveStateText${instance.module.questionid}`);\r\n        } else {\r\n            iconSpan = stateWrapper.querySelector('#CursiveCloudIcon');\r\n            stateTextEl = stateWrapper.querySelector('#CursiveStateText');\r\n        }\r\n\r\n        if (stateTextEl && iconSpan) {\r\n            stateTextEl.textContent = instance.getStateText(state);\r\n            iconSpan.innerHTML = instance.getStateIcon(state);\r\n        }\r\n\r\n\r\n        if (instance._savingTimer) {\r\n            clearTimeout(instance._savingTimer);\r\n        }\r\n\r\n        if (state === 'saved' && stateTextEl) {\r\n            instance._savingTimer = setTimeout(() => {\r\n                stateTextEl.textContent = '';\r\n            }, 5000);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the display text for a given saving state\r\n     * @param {string} state - The state to get text for ('saving', 'saved', or 'offline')\r\n     * @returns {string} The text to display for the given state\r\n     * @description Returns appropriate text label based on the current saving state\r\n     */\r\n    getStateText(state) {\r\n        const [saving, saved, offline] = this.getText('state');\r\n        switch (state) {\r\n            case 'saving': return saving;\r\n            case 'saved': return saved;\r\n            case 'offline': return offline;\r\n            default: return '';\r\n        }\r\n    }\r\n    /**\r\n     * Gets the icon URL for a given saving state\r\n     * @param {string} state - The state to get icon for ('saving', 'saved', or 'offline')\r\n     * @returns {string} The URL of the icon image for the given state\r\n     * @description Returns appropriate icon URL based on the current saving state\r\n     */\r\n    getStateIcon(state) {\r\n        switch (state) {\r\n            case 'saving': return Icons.cloudSave;\r\n            case 'saved': return Icons.cloudSave;\r\n            case 'offline': return 'data:image/svg+xml;base64,' + btoa(Icons.offline);\r\n            default: return '';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Fetches and displays saved content in a dropdown\r\n     * @async\r\n     * @param {Event} e - The event object\r\n     * @description Handles fetching and displaying saved content when the save state button is clicked.\r\n     * If the dropdown is already visible, it will be closed. Otherwise it will fetch saved content\r\n     * from the server (or use cached content if available) and display it in a dropdown panel.\r\n     * @throws {Error} Logs error to console if fetching content fails\r\n     */\r\n    async fetchSavedContent(e) {\r\n        e.preventDefault();\r\n\r\n        let dropdown = document.querySelector('#savedDropdown');\r\n        let isVisible = dropdown?.classList?.contains('show');\r\n\r\n        if (isVisible) {\r\n            this.closeSavedDropdown();\r\n            return;\r\n        }\r\n        let editorWrapper = null;\r\n        if (this.module.modulename === 'quiz') {\r\n            editorWrapper = document.querySelector(`#tiny_cursive_savingState${this.module.questionid}`);\r\n        } else {\r\n            editorWrapper = document.querySelector('#tiny_cursive_savingState');\r\n        }\r\n\r\n        let args = {\r\n            id: this.module.resourceId,\r\n            cmid: this.module.cmid,\r\n            modulename: `${this.module.modulename}_autosave`,\r\n            editorid: this.editor?.id,\r\n            userid: this.module.userid,\r\n            courseid: this.module.courseid\r\n        };\r\n\r\n        call([{\r\n            methodname: \"cursive_get_autosave_content\",\r\n            args: args\r\n        }])[0].done((data) => {\r\n            let context = {comments: JSON.parse(data)};\r\n            Object.values(context.comments).forEach(content => {\r\n                content.time = this.timeAgo(content.timemodified);\r\n            });\r\n            this.renderCommentList(context, editorWrapper);\r\n\r\n        }).fail((error) => {\r\n            this.throwWarning('fullmodeerrorr', this.editor);\r\n            window.console.error('Error fetching saved content:', error);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Toggles the visibility of the saved content dropdown\r\n     * @description Checks if the saved content dropdown is currently visible and either closes or opens it accordingly.\r\n     * If visible, calls closeSavedDropdown(). If hidden, calls openSavedDropdown().\r\n     */\r\n    toggleSavedDropdown() {\r\n        const dropdown = document.querySelector('#savedDropdown');\r\n        const isVisible = dropdown?.classList?.contains('show');\r\n\r\n        if (isVisible) {\r\n            this.closeSavedDropdown();\r\n        } else {\r\n            this.openSavedDropdown();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Opens the saved content dropdown panel\r\n     * @description Shows the saved content dropdown by adding the 'show' class and sets up an event listener\r\n     * for the Escape key to allow closing the dropdown. This  is called when toggling the dropdown open.\r\n     */\r\n    openSavedDropdown() {\r\n        const dropdown = document.querySelector('#savedDropdown');\r\n        dropdown.classList.add('show');\r\n\r\n        // Add event listener to close on Escape key\r\n        document.removeEventListener('keydown', this.handleEscapeKey);\r\n        document.addEventListener('keydown', this.handleEscapeKey);\r\n    }\r\n\r\n    /**\r\n     * Closes the saved content dropdown panel\r\n     * @description Removes the 'show' class from the dropdown to hide it, removes the dropdown element from the DOM,\r\n     * and removes the Escape key event listener. This  is called when toggling the dropdown closed or when\r\n     * clicking outside the dropdown.\r\n     */\r\n    closeSavedDropdown() {\r\n        const dropdown = document.querySelector('#savedDropdown');\r\n        if (dropdown) {\r\n            dropdown.classList.remove('show');\r\n            dropdown.remove();\r\n            document.removeEventListener('keydown', this.handleEscapeKey);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Handles the Escape key press event for closing the saved content dropdown\r\n     * @param {KeyboardEvent} event - The keyboard event object\r\n     * @description Event handler that checks if the Escape key was pressed and closes the saved content dropdown if it was\r\n     */\r\n    handleEscapeKey(event) {\r\n        if (event.key === 'Escape') {\r\n            this.closeSavedDropdown();\r\n        }\r\n    }\r\n\r\n    timeAgo(unixTime) {\r\n        const seconds = Math.floor(Date.now() / 1000) - unixTime;\r\n\r\n        if (seconds < 5) {\r\n            return \"just now\";\r\n        }\r\n        if (seconds < 60) {\r\n            return `${seconds} sec ago`;\r\n        }\r\n\r\n        const minutes = Math.floor(seconds / 60);\r\n        if (minutes < 60) {\r\n            return `${minutes} min ago`;\r\n        }\r\n\r\n        const hours = Math.floor(minutes / 60);\r\n        if (hours < 24) {\r\n            return `${hours} hour${hours > 1 ? \"s\" : \"\"} ago`;\r\n        }\r\n\r\n        const days = Math.floor(hours / 24);\r\n        if (days < 7) {\r\n            return `${days} day${days > 1 ? \"s\" : \"\"} ago`;\r\n        }\r\n\r\n        const weeks = Math.floor(days / 7);\r\n        if (weeks < 4) {\r\n            return `${weeks} week${weeks > 1 ? \"s\" : \"\"} ago`;\r\n        }\r\n\r\n        const months = Math.floor(days / 30);\r\n        if (months < 12) {\r\n            return `${months} month${months > 1 ? \"s\" : \"\"} ago`;\r\n        }\r\n\r\n        const years = Math.floor(days / 365);\r\n        return `${years} year${years > 1 ? \"s\" : \"\"} ago`;\r\n    }\r\n\r\n\r\n    /**\r\n     * Renders the saved content dropdown list using a template\r\n     * @param {Object} context - The context object containing saved comments data to render\r\n     * @param {HTMLElement} editorWrapper - The wrapper element to attach the dropdown to\r\n     * @description Renders the saved content dropdown using the tiny_cursive/saved_content template.\r\n     * Creates and positions the dropdown relative to the editor wrapper element.\r\n     * Handles toggling visibility and caching of the saved content.\r\n     * @throws {Error} Logs error to console if template rendering fails\r\n     */\r\n    renderCommentList(context, editorWrapper) {\r\n        templates.render('tiny_cursive/saved_content', context).then(html => {\r\n            editorWrapper.style.position = 'relative';\r\n\r\n            const tempDiv = document.createElement('div');\r\n            tempDiv.innerHTML = html.trim();\r\n            tempDiv.id = 'savedDropdown';\r\n            tempDiv.classList.add('tiny_cursive-saved-dropdown');\r\n\r\n            if (!tempDiv) {\r\n                window.console.error(\"Saved content template rendered empty or invalid HTML.\");\r\n                return false;\r\n            }\r\n\r\n            // Add to DOM if not already added\r\n            let existingPanel = document.querySelector('#savedDropdown');\r\n\r\n            if (!existingPanel) {\r\n                editorWrapper.appendChild(tempDiv);\r\n                existingPanel = tempDiv;\r\n            }\r\n\r\n            // Toggle visibility\r\n            existingPanel.classList.toggle('active');\r\n            this.openSavedDropdown();\r\n\r\n            this.insertSavedItems(this.editor);\r\n\r\n            return true;\r\n\r\n        }).catch(error => window.console.error(error));\r\n    }\r\n\r\n    fetchStrings() {\r\n        if (!localStorage.getItem('state')) {\r\n\r\n            Promise.all([\r\n                getString('saving', 'tiny_cursive'),\r\n                getString('saved', 'tiny_cursive'),\r\n                getString('offline', 'tiny_cursive')\r\n            ]).then(function(strings) {\r\n               return localStorage.setItem('state', JSON.stringify(strings));\r\n            }).catch(error => window.console.error(error));\r\n        }\r\n    }\r\n\r\n    throwWarning(str, editor) {\r\n        getString(str, 'tiny_cursive').then(str => {\r\n            return editor.windowManager.alert(str);\r\n        }).catch(error => window.console.error(error));\r\n    }\r\n\r\n    getText(key) {\r\n        return JSON.parse(localStorage.getItem(key));\r\n    }\r\n\r\n    /**\r\n     * Adds click event listeners to saved content items to insert them into the editor\r\n     * @description Finds all elements with class 'tiny_cursive-item-preview' and adds click handlers that will\r\n     * insert the element's text content into the editor when clicked. The text is inserted with\r\n     * a leading space.\r\n     * @param {Object} editor - The TinyMCE editor instance\r\n     * @returns {void}\r\n     */\r\n    insertSavedItems(editor) {\r\n        const items = document.querySelectorAll('.tiny_cursive-item-preview');\r\n        items.forEach(element => {\r\n            element.addEventListener('click', function() {\r\n                editor.insertContent(\" \" + this.textContent);\r\n            });\r\n        });\r\n    }\r\n\r\n}"],"names":["CursiveAutosave","constructor","editor","rightWrapper","modules","isFullScreen","instance","module","savingState","fetchSavedContent","this","bind","handleEscapeKey","_savingTimer","fetchStrings","modulename","document","querySelector","questionid","init","stateWrapper","cursiveSavingState","classList","add","id","prepend","addEventListener","destroy","state","wrapperDiv","createElement","textSpan","button","iconSpan","style","padding","fontSize","color","textContent","getStateText","innerHTML","getStateIcon","verticalAlign","appendChild","stateTextEl","clearTimeout","setTimeout","saving","saved","offline","getText","Icons","cloudSave","btoa","e","preventDefault","dropdown","_dropdown$classList","contains","closeSavedDropdown","editorWrapper","args","resourceId","cmid","editorid","_this$editor","userid","courseid","methodname","done","data","context","comments","JSON","parse","Object","values","forEach","content","time","timeAgo","timemodified","renderCommentList","fail","error","throwWarning","window","console","toggleSavedDropdown","_dropdown$classList2","openSavedDropdown","removeEventListener","remove","event","key","unixTime","seconds","Math","floor","Date","now","minutes","hours","days","weeks","months","years","render","then","html","position","tempDiv","trim","existingPanel","toggle","insertSavedItems","catch","localStorage","getItem","Promise","all","strings","setItem","stringify","str","windowManager","alert","querySelectorAll","element","insertContent"],"mappings":"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"}