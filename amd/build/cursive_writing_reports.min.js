define("tiny_cursive/cursive_writing_reports",["jquery","core/ajax","core/str","core/templates","./replay","./analytic_button","./analytic_events","core/modal_events","core/modal_save_cancel","core/modal_factory","core/modal"],(function($,AJAX,str,templates,Replay,analyticButton,AnalyticEvents,Events,Modal,Factory,Alert){const replayInstances={};window.video_playback=function(mid,filepath){if(""!==filepath){const replay=new Replay("content"+mid,filepath,10,!1,"player_"+mid);replayInstances[mid]=replay}else templates.render("tiny_cursive/no_submission").then((html=>{$("#content"+mid).html(html)})).catch((e=>window.console.error(e)));return!1};var usersTable={init:function(page,hasApiKey,csvOption){str.get_strings([{key:"field_require",component:"tiny_cursive"}]).done((function(){usersTable.getusers(page)}));let myEvents=new AnalyticEvents;!async function(){try{!function(scoreSetting,hasApiKey,csvOption){$(".analytic-modal").each((function(){var mid=$(this).data("id"),filepath=$(this).data("filepath");let context={};context.userid=mid;let cmid=$(this).data("cmid");AJAX.call([{methodname:"cursive_get_writing_statistics",args:{cmid:cmid,fileid:mid}}])[0].done((response=>{let data=JSON.parse(response.data);$(this).html(analyticButton(hasApiKey?data.effort_ratio:"",$(this).data("id"))),context.formattime=myEvents.formatedTime(data),context.tabledata=data,context.apikey=hasApiKey;let authIcon=myEvents.authorshipStatus(data.first_file,data.score,scoreSetting);myEvents.createModal(mid,context,"",replayInstances,authIcon),myEvents.analytics(mid,templates,context,"",replayInstances,authIcon),myEvents.checkDiff(mid,mid,"",replayInstances),myEvents.replyWriting(mid,filepath,"",replayInstances)})).fail((error=>{throw new Error("Error: "+error.message)}))})),$(".download-btn").on("click",(async function(e){e.preventDefault();const link1=$(this).attr("href"),link2=$(this).data("link");let type=Factory.types.SAVE_CANCEL,optionModal=Modal,select=document.createElement("select");select.id="download-type",select.classList.add("form-control","inputUrl");let title=await str.get_string("download","tiny_cursive");if(csvOption)try{const text=await str.get_string("payloadjson","tiny_cursive");let option=document.createElement("option");option.text=text,option.value=0,select.appendChild(option)}catch(error){window.console.error(error)}if(hasApiKey)try{const text=await str.get_string("analyticspdf","tiny_cursive");let option2=document.createElement("option");option2.text=text,option2.value=1,select.appendChild(option2)}catch(error){window.console.error(error)}if(!hasApiKey&&!csvOption)try{const noOptionText=await str.get_string("no_option","tiny_cursive");title=await str.get_string("message","tool_dataprivacy"),type=Factory.types.ALERT,optionModal=Alert,select=noOptionText}catch(error){window.console.error(error)}optionModal.create({type:type,title:title,body:select,removeOnClose:!0,buttons:type===Factory.types.SAVE_CANCEL?[{text:"OK",type:"submit",primary:!0}]:[]}).then((modal=>{modal.show(),type===Factory.types.SAVE_CANCEL&&modal.getRoot().on(Events.save,(function(){const data=document.getElementById("download-type");data&&(parseInt(data.value)?window.location.href=link2:window.location.href=link1)}))}))}))}(await str.get_string("confidence_threshold","tiny_cursive"),hasApiKey,parseInt(csvOption))}catch(error){window.console.error("Error fetching string:",error)}}()},getusers:function(page){$("#id_coursename").change((function(){var courseid=$(this).val();AJAX.call([{methodname:"cursive_get_user_list",args:{courseid:courseid}}])[0].done((function(json){var context={tabledata:JSON.parse(json),page:page};templates.render("tiny_cursive/user_list",context).then((function(html){return $("#id_username").html(html),!0}))})),AJAX.call([{methodname:"cursive_get_module_list",args:{courseid:courseid}}])[0].done((function(json){var context={tabledata:JSON.parse(json),page:page};templates.render("tiny_cursive/module_list",context).then((function(html){return $("#id_modulename").html(html),!0}))}))}))}};return usersTable}));

//# sourceMappingURL=cursive_writing_reports.min.js.map