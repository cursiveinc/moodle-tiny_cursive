{"version":3,"file":"cursive_writing_reports.min.js","sources":["../src/cursive_writing_reports.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     tiny_cursive/cursive_writing_reports\n * @category TinyMCE Editor\n * @copyright  CTI <info@cursivetechnology.com>\n * @author kuldeep singh <mca.kuldeep.sekhon@gmail.com>\n */\n\ndefine([\"jquery\", \"core/ajax\", \"core/str\", \"core/templates\", \"./replay\", './analytic_button', \"./analytic_events\"], function(\n    $,\n    AJAX,\n    str,\n    templates,\n    Replay,\n    analyticButton,\n    AnalyticEvents\n) {\n    const replayInstances = {};\n    // eslint-disable-next-line\n    window.video_playback = function (mid, filepath) {\n        if (filepath !== '') {\n            const replay = new Replay(\n                'content' + mid,\n                filepath,\n                10,\n                false,\n                'player_' + mid\n            );\n            replayInstances[mid] = replay;\n        } else {\n            // eslint-disable-next-line\n            templates.render('tiny_cursive/no_submission').then(html => {\n                $('#content' + mid).html(html);\n            }).catch(e => window.console.error(e));\n        }\n        return false;\n\n    };\n    var usersTable = {\n        init: function(page) {\n            str\n                .get_strings([\n                    {key: \"field_require\", component: \"tiny_cursive\"},\n                ])\n                .done(function() {\n                    usersTable.getusers(page);\n                });\n\n            let myEvents = new AnalyticEvents();\n            (async function() {\n                try {\n                    let scoreSetting = await str.get_string('confidence_threshold', 'tiny_cursive');\n                    analyticsEvents(scoreSetting);\n                } catch (error) {\n                    window.console.error('Error fetching string:', error);\n                }\n            })();\n\n            /**\n             * Handles the analytics events for each modal on the page.\n             *\n             * This function iterates over each element with the class `analytic-modal`,\n             * retrieves necessary data attributes, and makes an AJAX call to get writing\n             * statistics. Once the data is retrieved, it processes and displays it within\n             * the modal.\n             *\n             * @param {Object} scoreSetting - Configuration settings related to scoring.\n             */\n            function analyticsEvents(scoreSetting) {\n\n                $(\".analytic-modal\").each(function() {\n                    var mid = $(this).data(\"id\");\n                    var filepath = $(this).data(\"filepath\");\n                    let context = {};\n                    context.userid = mid;\n                    let cmid = $(this).data(\"cmid\");\n                    $(this).html(analyticButton($(this).data('id')));\n\n                    AJAX.call([{\n                        methodname: 'cursive_get_writing_statistics',\n                        args: {\n                            cmid: cmid,\n                            fileid: mid,\n                        },\n                    }])[0].done(response => {\n                        let data = JSON.parse(response.data);\n\n                        context.formattime = myEvents.formatedTime(data);\n                        context.tabledata = data;\n                        // Perform actions that require context.tabledata\n                        let authIcon = myEvents.authorshipStatus(data.first_file, data.score, scoreSetting);\n                        myEvents.createModal(mid, context, '', authIcon);\n                        myEvents.analytics(mid, templates, context, '', replayInstances, authIcon);\n                        myEvents.checkDiff(mid, mid, '', replayInstances);\n                        myEvents.replyWriting(mid, filepath, '', replayInstances);\n                        myEvents.quality(mid, templates, context, '', replayInstances, cmid);\n                    }).fail(error => {\n                        throw new Error('Error: ' + error.message);\n                    });\n\n                });\n            }\n        },\n        getusers: function(page) {\n            $(\"#id_coursename\").change(function() {\n                var courseid = $(this).val();\n                var promise1 = AJAX.call([\n                    {\n                        methodname: \"cursive_get_user_list\",\n                        args: {\n                            courseid: courseid,\n                        },\n                    },\n                ]);\n                promise1[0].done(function(json) {\n                    var data = JSON.parse(json);\n                    var context = {\n                        tabledata: data,\n                        page: page,\n                    };\n                    // eslint-disable-next-line\n                    templates\n                        .render(\"tiny_cursive/user_list\", context)\n                        .then(function(html) {\n\n                            var filteredUser = $(\"#id_username\");\n                            filteredUser.html(html);\n                            return true;\n                        });\n                });\n\n                var promise2 = AJAX.call([\n                    {\n                        methodname: \"cursive_get_module_list\",\n                        args: {\n                            courseid: courseid,\n                        },\n                    },\n                ]);\n                promise2[0].done(function(json) {\n                    var data = JSON.parse(json);\n                    var context = {\n                        tabledata: data,\n                        page: page,\n                    };\n                    // eslint-disable-next-line\n                    templates\n                        .render(\"tiny_cursive/module_list\", context)\n                        .then(function(html) {\n\n                            var filteredUser = $(\"#id_modulename\");\n                            filteredUser.html(html);\n                            return true;\n                        });\n                });\n            });\n        },\n    };\n    return usersTable;\n});\n"],"names":["define","$","AJAX","str","templates","Replay","analyticButton","AnalyticEvents","replayInstances","window","video_playback","mid","filepath","replay","render","then","html","catch","e","console","error","usersTable","init","page","get_strings","key","component","done","getusers","myEvents","scoreSetting","each","this","data","context","userid","cmid","call","methodname","args","fileid","response","JSON","parse","formattime","formatedTime","tabledata","authIcon","authorshipStatus","first_file","score","createModal","analytics","checkDiff","replyWriting","quality","fail","Error","message","analyticsEvents","get_string","change","courseid","val","json"],"mappings":"AAsBAA,8CAAO,CAAC,SAAU,YAAa,WAAY,iBAAkB,WAAY,oBAAqB,sBAAsB,SAChHC,EACAC,KACAC,IACAC,UACAC,OACAC,eACAC,sBAEMC,gBAAkB,GAExBC,OAAOC,eAAiB,SAAUC,IAAKC,aAClB,KAAbA,SAAiB,OACXC,OAAS,IAAIR,OACf,UAAYM,IACZC,SACA,IACA,EACA,UAAYD,KAEhBH,gBAAgBG,KAAOE,YAGvBT,UAAUU,OAAO,8BAA8BC,MAAKC,OAChDf,EAAE,WAAaU,KAAKK,KAAKA,SAC1BC,OAAMC,GAAKT,OAAOU,QAAQC,MAAMF,YAEhC,OAGPG,WAAa,CACbC,KAAM,SAASC,MACXpB,IACKqB,YAAY,CACT,CAACC,IAAK,gBAAiBC,UAAW,kBAErCC,MAAK,WACFN,WAAWO,SAASL,aAGxBM,SAAW,IAAItB,+CAoBMuB,cAErB7B,EAAE,mBAAmB8B,MAAK,eAClBpB,IAAMV,EAAE+B,MAAMC,KAAK,MACnBrB,SAAWX,EAAE+B,MAAMC,KAAK,gBACxBC,QAAU,GACdA,QAAQC,OAASxB,QACbyB,KAAOnC,EAAE+B,MAAMC,KAAK,QACxBhC,EAAE+B,MAAMhB,KAAKV,eAAeL,EAAE+B,MAAMC,KAAK,QAEzC/B,KAAKmC,KAAK,CAAC,CACPC,WAAY,iCACZC,KAAM,CACFH,KAAMA,KACNI,OAAQ7B,QAEZ,GAAGgB,MAAKc,eACJR,KAAOS,KAAKC,MAAMF,SAASR,MAE/BC,QAAQU,WAAaf,SAASgB,aAAaZ,MAC3CC,QAAQY,UAAYb,SAEhBc,SAAWlB,SAASmB,iBAAiBf,KAAKgB,WAAYhB,KAAKiB,MAAOpB,cACtED,SAASsB,YAAYxC,IAAKuB,QAAS,GAAIa,UACvClB,SAASuB,UAAUzC,IAAKP,UAAW8B,QAAS,GAAI1B,gBAAiBuC,UACjElB,SAASwB,UAAU1C,IAAKA,IAAK,GAAIH,iBACjCqB,SAASyB,aAAa3C,IAAKC,SAAU,GAAIJ,iBACzCqB,SAAS0B,QAAQ5C,IAAKP,UAAW8B,QAAS,GAAI1B,gBAAiB4B,SAChEoB,MAAKpC,cACE,IAAIqC,MAAM,UAAYrC,MAAMsC,eA7CtCC,OADyBxD,IAAIyD,WAAW,uBAAwB,iBAElE,MAAOxC,OACLX,OAAOU,QAAQC,MAAM,yBAA0BA,YAiD3DQ,SAAU,SAASL,MACftB,EAAE,kBAAkB4D,QAAO,eACnBC,SAAW7D,EAAE+B,MAAM+B,MACR7D,KAAKmC,KAAK,CACrB,CACIC,WAAY,wBACZC,KAAM,CACFuB,SAAUA,aAIb,GAAGnC,MAAK,SAASqC,UAElB9B,QAAU,CACVY,UAFOJ,KAAKC,MAAMqB,MAGlBzC,KAAMA,MAGVnB,UACKU,OAAO,yBAA0BoB,SACjCnB,MAAK,SAASC,aAEQf,EAAE,gBACRe,KAAKA,OACX,QAIJd,KAAKmC,KAAK,CACrB,CACIC,WAAY,0BACZC,KAAM,CACFuB,SAAUA,aAIb,GAAGnC,MAAK,SAASqC,UAElB9B,QAAU,CACVY,UAFOJ,KAAKC,MAAMqB,MAGlBzC,KAAMA,MAGVnB,UACKU,OAAO,2BAA4BoB,SACnCnB,MAAK,SAASC,aAEQf,EAAE,kBACRe,KAAKA,OACX,oBAMxBK"}