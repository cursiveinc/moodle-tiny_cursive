define("tiny_cursive/replay",["exports","core/ajax","core/templates","jquery","core/str"],(function(_exports,_ajax,_templates,_jquery,Str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=_interopRequireDefault(_templates),_jquery=_interopRequireDefault(_jquery),Str=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Str);return _exports.default=class{constructor(elementId,filePath){let speed=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,loop=arguments.length>3&&void 0!==arguments[3]&&arguments[3],controllerId=arguments.length>4?arguments[4]:void 0;var obj,key,value;value="",(key="controllerId")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,this.controllerId=controllerId,this.replayInProgress=!1,this.speed=parseFloat(speed),this.loop=loop,this.highlightedChars=[],this.deletedChars=[],this.cursorPosition=0,this.currentEventIndex=0,this.totalEvents=0,this.currentTime=0,this.totalDuration=0,this.usercomments=[],this.pasteTimestamps=[];const element=document.getElementById(elementId);if(!element)throw new Error("Element with id '".concat(elementId,"' not found"));this.outputElement=element,this.outputElement.style.whiteSpace="pre-wrap",this.outputElement.style.wordBreak="break-word",this.outputElement.style.maxWidth="100%",this.outputElement.style.overflow="auto",this.outputElement.style.fontFamily="monospace",this.outputElement.style.padding="10px",this.outputElement.style.border="1px solid #e0e0e0",this.outputElement.style.borderRadius="4px",this.outputElement.style.minHeight="100px",this.outputElement.style.backgroundColor="#fff",this.loadJSON(filePath).then((data=>{if(data.status){var val=JSON.parse(data.data);if(this.logData=val,data.comments){var comments=JSON.parse(data.comments);this.usercomments=Array.isArray(comments)?[...comments]:[]}if("data"in this.logData&&(this.logData=this.logData.data),"payload"in this.logData&&(this.logData=this.logData.payload),this.logData.length>0&&this.logData[0].unixTimestamp){const startTime=this.logData[0].unixTimestamp;this.logData=this.logData.map((event=>({...event,normalizedTime:event.unixTimestamp-startTime}))),this.totalDuration=this.logData[this.logData.length-1].normalizedTime}this.totalEvents=this.logData.length,this.identifyPasteEvents(),controllerId&&this.logData&&this.constructController(controllerId),this.startReplay()}else try{Promise.all([_templates.default.render("tiny_cursive/no_submission"),Str.get_string("warningpayload","tiny_cursive")]).then((function(results){var html=results[0],str=results[1],updatedHtml=html.replace("No Submission",str);return(0,_jquery.default)(".tiny_cursive").html(updatedHtml),!0})).catch((function(error){window.console.error(error)}))}catch(error){window.console.error(error)}return data})).catch((error=>{try{Promise.all([_templates.default.render("tiny_cursive/no_submission"),Str.get_string("warningpayload","tiny_cursive")]).then((function(results){var html=results[0],str=results[1],updatedHtml=html.replace("No Submission",str);return(0,_jquery.default)(".tiny_cursive").html(updatedHtml),!0})).catch((function(error){window.console.error(error)}))}catch(error){window.console.error(error)}window.console.error("Error loading JSON file: "+error.message)}))}stopReplay(){if(this.replayInProgress){clearTimeout(this.replayTimeout),this.replayInProgress=!1;const playSvg='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"\n            viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <polygon points="5,3 19,12 5,21" />\n            </svg>';this.playButton&&(this.playButton.querySelector(".play-icon").innerHTML=playSvg)}}constructController(controllerId){this.replayInProgress=!1,this.currentPosition=0,this.speed=1,this.replayIntervalId&&(clearInterval(this.replayIntervalId),this.replayIntervalId=null);const container=document.getElementById(controllerId);if(!container)return void window.console.error("Container element not found with ID:",controllerId);container.querySelectorAll(".replay-control").forEach((control=>control.remove()));container.querySelectorAll(".paste-events-panel").forEach((panel=>panel.remove()));const controlContainer=document.createElement("div");controlContainer.className="replay-control",controlContainer.style.display="flex",controlContainer.style.flexDirection="column",controlContainer.style.gap="10px",controlContainer.style.margin="10px 0",controlContainer.style.alignItems="center",controlContainer.style.padding="10px",controlContainer.style.paddingBottom="10px",controlContainer.style.borderRadius="8px",controlContainer.style.backgroundColor="#f8f9fa",controlContainer.style.boxShadow="0 2px 8px rgba(0,0,0,0.1)",controlContainer.style.width="100%";const topRow=document.createElement("div");topRow.style.display="flex",topRow.style.width="100%",topRow.style.gap="12px",topRow.style.alignItems="center",this.playButton=document.createElement("button"),this.playButton.className="play-button",this.playButton.style.minWidth="36px",this.playButton.style.height="36px",this.playButton.style.borderRadius="50%",this.playButton.style.background="#4285f4",this.playButton.style.color="white",this.playButton.style.border="none",this.playButton.style.cursor="pointer",this.playButton.style.display="flex",this.playButton.style.alignItems="center",this.playButton.style.justifyContent="center",this.playButton.style.transition="background-color 0.2s, transform 0.1s",this.playButton.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)",this.playButton.style.flexShrink="0";this.playButton.innerHTML='<span class="play-icon">'.concat('<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"\n        viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n        <polygon points="5,3 19,12 5,21"></polygon>\n        </svg>',"</span>"),this.playButton.addEventListener("mouseover",(()=>{this.playButton.style.background="#3367d6",this.playButton.style.transform="scale(1.05)"})),this.playButton.addEventListener("mouseout",(()=>{this.playButton.style.background="#4285f4",this.playButton.style.transform="scale(1)"})),this.playButton.addEventListener("click",(()=>{if(this.replayInProgress){this.stopReplay();const playSvg='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"\n                viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                <polygon points="5,3 19,12 5,21"></polygon>\n                </svg>';this.playButton.querySelector(".play-icon").innerHTML=playSvg}else this.startReplay(!1)})),topRow.appendChild(this.playButton);const scrubberContainer=document.createElement("div");scrubberContainer.style.flexGrow="1",scrubberContainer.style.width="100%",this.scrubberElement=document.createElement("input"),this.scrubberElement.type="range",this.scrubberElement.id="timelineScrubber",this.scrubberElement.className="timeline-scrubber",this.scrubberElement.min="0",this.scrubberElement.max="100",this.scrubberElement.value="0",this.scrubberElement.style.width="100%",this.scrubberElement.style.height="8px",this.scrubberElement.style.borderRadius="4px",this.scrubberElement.style.accentColor="#4285f4",this.scrubberElement.addEventListener("input",(()=>{const scrubberValue=parseInt(this.scrubberElement.value,10);this.skipToTime(scrubberValue)})),scrubberContainer.appendChild(this.scrubberElement),topRow.appendChild(scrubberContainer);const bottomRow=document.createElement("div");bottomRow.style.display="flex",bottomRow.style.width="100%",bottomRow.style.justifyContent="space-between",bottomRow.style.alignItems="center",bottomRow.style.marginTop="5px";const speedContainer=document.createElement("div");speedContainer.className="speed-controls",speedContainer.style.display="flex",speedContainer.style.gap="6px",speedContainer.style.flexShrink="0",speedContainer.style.alignItems="center";const speedLabel=document.createElement("span");speedLabel.textContent="Speed: ",speedLabel.style.fontSize="14px",speedLabel.style.fontWeight="500",speedLabel.style.color="#333",speedLabel.style.marginRight="4px",speedContainer.appendChild(speedLabel);const speedGroup=document.createElement("div");speedGroup.style.display="flex",speedGroup.style.borderRadius="6px",speedGroup.style.overflow="hidden",speedGroup.style.border="1px solid #e0e0e0",[1,1.5,2,5,10].forEach((speedValue=>{const speedBtn=document.createElement("button");speedBtn.textContent="".concat(speedValue,"x"),speedBtn.className="speed-btn ".concat(parseFloat(speedValue)===parseFloat(this.speed)?"active":""),speedBtn.style.padding="6px 10px",speedBtn.style.border="none",speedBtn.style.borderRight=10!==speedValue?"1px solid #e0e0e0":"none",speedBtn.style.background=parseFloat(speedValue)===parseFloat(this.speed)?"#4285f4":"white",speedBtn.style.color=parseFloat(speedValue)===parseFloat(this.speed)?"white":"#333",speedBtn.style.cursor="pointer",speedBtn.style.fontSize="13px",speedBtn.style.fontWeight="500",speedBtn.style.transition="background 0.2s, color 0.2s",speedBtn.dataset.speed=speedValue,speedBtn.addEventListener("mouseover",(()=>{speedBtn.classList.contains("active")||(speedBtn.style.background="#f1f3f4")})),speedBtn.addEventListener("mouseout",(()=>{speedBtn.classList.contains("active")||(speedBtn.style.background="white")})),speedBtn.addEventListener("click",(()=>{document.querySelectorAll(".speed-btn").forEach((btn=>{btn.style.background="white",btn.style.color="#333",btn.classList.remove("active")})),speedBtn.style.background="#4285f4",speedBtn.style.color="white",speedBtn.classList.add("active"),this.speed=parseFloat(speedBtn.dataset.speed);this.replayInProgress&&(this.stopReplay(),this.startReplay(!1))})),speedGroup.appendChild(speedBtn)})),speedContainer.appendChild(speedGroup),bottomRow.appendChild(speedContainer),controlContainer.appendChild(topRow),controlContainer.appendChild(bottomRow),this.timeDisplay=document.createElement("div"),this.timeDisplay.className="time-display",this.timeDisplay.textContent="00:00 / 00:00",this.timeDisplay.style.fontSize="14px",this.timeDisplay.style.fontFamily="sans-serif",this.timeDisplay.style.color="#333",this.timeDisplay.style.padding="5px 0",this.timeDisplay.style.flexShrink="0",this.timeDisplay.style.minWidth="90px",this.timeDisplay.style.marginLeft="15px",this.timeDisplay.style.textAlign="left",topRow.appendChild(this.timeDisplay);const pasteEventsToggle=document.createElement("div");pasteEventsToggle.className="paste-events-toggle",pasteEventsToggle.style.display="flex",pasteEventsToggle.style.alignItems="center",pasteEventsToggle.style.cursor="pointer",pasteEventsToggle.style.userSelect="none",pasteEventsToggle.style.color="#4285f4",pasteEventsToggle.style.fontFamily="sans-serif",pasteEventsToggle.style.fontSize="14px",pasteEventsToggle.style.fontWeight="500",pasteEventsToggle.style.marginLeft="auto";const pasteEventsIcon=document.createElement("span");pasteEventsIcon.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" \n             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>\n            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>\n        </svg>',pasteEventsIcon.style.marginRight="8px",pasteEventsIcon.style.display="flex",pasteEventsIcon.style.alignItems="center";const pasteEventsText=document.createElement("span");pasteEventsText.textContent="Paste Events";const pasteEventCount=document.createElement("span");pasteEventCount.textContent="(".concat(this.usercomments.length,")"),pasteEventCount.className="paste-event-count",pasteEventCount.style.marginLeft="2px";const chevronIcon=document.createElement("span");chevronIcon.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" \n             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="chevron-icon">\n            <polyline points="6 9 12 15 18 9"></polyline>\n        </svg>',chevronIcon.style.marginLeft="5px",chevronIcon.style.transition="transform 0.3s ease",pasteEventsToggle.appendChild(pasteEventsIcon),pasteEventsToggle.appendChild(pasteEventsText),pasteEventsToggle.appendChild(pasteEventCount),pasteEventsToggle.appendChild(chevronIcon);const pasteEventsPanel=document.createElement("div");if(pasteEventsPanel.className="paste-events-panel",pasteEventsPanel.style.display="none",pasteEventsPanel.style.marginTop="10px",pasteEventsPanel.style.border="1px solid #e0e0e0",pasteEventsPanel.style.borderRadius="4px",pasteEventsPanel.style.backgroundColor="#fff",pasteEventsPanel.style.maxHeight="300px",pasteEventsPanel.style.overflowY="auto",pasteEventsPanel.style.width="100%",this.populatePasteEventsPanel(pasteEventsPanel),pasteEventsToggle.addEventListener("click",(()=>{const isHidden="none"===pasteEventsPanel.style.display;pasteEventsPanel.style.display=isHidden?"block":"none",chevronIcon.style.transform=isHidden?"rotate(180deg)":"rotate(0)"})),bottomRow.appendChild(pasteEventsToggle),controlContainer.appendChild(pasteEventsPanel),this.pasteEventsPanel=pasteEventsPanel,this.pasteEventCount=pasteEventCount,container.insertBefore(controlContainer,container.firstChild),this.outputElement&&(this.outputElement.style.whiteSpace="pre-wrap",this.outputElement.style.wordBreak="break-word",this.outputElement.style.maxWidth="100%",this.outputElement.style.overflow="auto",this.outputElement.style.fontFamily="monospace",this.outputElement.style.padding="10px",this.outputElement.style.border="1px solid #e0e0e0",this.outputElement.style.borderRadius="4px",this.outputElement.style.minHeight="100px",this.outputElement.style.backgroundColor="#fff"),!document.getElementById("tiny_cursive-replay-control-styles")){const styleElement=document.createElement("style");styleElement.id="tiny_cursive-replay-control-styles",styleElement.textContent="\n                .tiny_cursive-replay-control {\n                    margin: 10px 0;\n                    border-radius: 8px;\n                    background-color: #f8f9fa;\n                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);\n                    transition: box-shadow 0.3s ease;\n                    width: 100%;\n                    box-sizing: border-box;\n                }\n    \n                .tiny_cursive-replay-control:hover {\n                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n                }\n    \n                .tiny_cursive-highlighted-char {\n                    color: #34a853;\n                    font-weight: bold;\n                    transition: opacity 0.3s ease, color 0.3s ease;\n                }\n    \n                .tiny_cursive-deleted-char {\n                    color: #ea4335;\n                    text-decoration: line-through;\n                    opacity: 0.5;\n                    transition: opacity 0.3s ease;\n                }\n    \n                .tiny_cursive-cursor {\n                    display: inline-block;\n                    width: 2px;\n                    height: 1.2em;\n                    background-color: #4285f4;\n                    animation: tiny_cursive-blink 1s infinite;\n                    vertical-align: middle;\n                    border-radius: 1px;\n                }\n    \n                @keyframes tiny_cursive-blink {\n                    0%, 100% { opacity: 1; }\n                    50% { opacity: 0; }\n                }\n    \n                .tiny_cursive-timeline-scrubber {\n                    width: 100%;\n                    height: 8px;\n                    border-radius: 4px;\n                    appearance: none;\n                    background: #e0e0e0;\n                    transition: background 0.2s;\n                }\n    \n                .tiny_cursive-timeline-scrubber:hover {\n                    background: #d0d0d0;\n                }\n    \n                .tiny_cursive-timeline-scrubber::-webkit-slider-thumb {\n                    appearance: none;\n                    width: 16px;\n                    height: 16px;\n                    border-radius: 50%;\n                    background: #4285f4;\n                    cursor: pointer;\n                    box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n                    transition: transform 0.1s, box-shadow 0.1s;\n                }\n    \n                .tiny_cursive-timeline-scrubber::-webkit-slider-thumb:hover {\n                    transform: scale(1.1);\n                    box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n                }\n    \n                .tiny_cursive-timeline-scrubber::-moz-range-thumb {\n                    width: 16px;\n                    height: 16px;\n                    border-radius: 50%;\n                    background: #4285f4;\n                    cursor: pointer;\n                    box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n                    transition: transform 0.1s;\n                }\n    \n                .tiny_cursive-timeline-scrubber::-moz-range-thumb:hover {\n                    transform: scale(1.1);\n                    box-shadow: 0 2px 5px rgba(0,0,0,0.3);\n                }\n    \n                .tiny_cursive-speed-btn.active {\n                    background: #4285f4 !important;\n                    color: white !important;\n                    font-weight: 500;\n                }\n            ",document.head.appendChild(styleElement)}}identifyPasteEvents(){let controlPressed=!1,pasteCount=0;for(let i=0;i<this.logData.length;i++){const event=this.logData[i];if(event.event&&"keydown"===event.event.toLowerCase())if("Control"===event.key)controlPressed=!0;else if("v"===event.key&&controlPressed){const timestamp=event.normalizedTime||0;this.pasteTimestamps.push({index:pasteCount,time:timestamp,formattedTime:this.formatTime(timestamp)}),pasteCount++}else controlPressed=!1}if(this.usercomments.length>0&&0===this.pasteTimestamps.length)for(let i=0;i<this.usercomments.length;i++)this.pasteTimestamps.push({index:i,time:0,formattedTime:this.formatTime(0)});for(;this.pasteTimestamps.length<this.usercomments.length;){const lastIndex=this.pasteTimestamps.length;this.pasteTimestamps.push({index:lastIndex,time:0,formattedTime:this.formatTime(0)})}}populatePasteEventsPanel(panel){for(panel.innerHTML="";panel.firstChild;)panel.removeChild(panel.firstChild);panel.style.maxHeight="400px",panel.style.marginBottom="15px",panel.style.paddingBottom="10px",panel.style.boxShadow="0 2px 8px rgba(0,0,0,0.08)";const uniqueComments=this.usercomments&&this.usercomments.length?[...new Set(this.usercomments)]:[];if(!uniqueComments||0===uniqueComments.length){const noCommentsMessage=document.createElement("div");return noCommentsMessage.className="no-comments-message",noCommentsMessage.textContent="No paste events available for this submission.",noCommentsMessage.style.padding="15px",void panel.appendChild(noCommentsMessage)}this.pasteEventCount&&(this.pasteEventCount.textContent="(".concat(uniqueComments.length,")"));const carouselContainer=document.createElement("div");carouselContainer.className="paste-events-carousel",carouselContainer.style.display="flex",carouselContainer.style.flexDirection="column",carouselContainer.style.width="100%",carouselContainer.style.position="relative";const navigationRow=document.createElement("div");navigationRow.className="paste-events-navigation",navigationRow.style.display="flex",navigationRow.style.justifyContent="space-between",navigationRow.style.alignItems="center",navigationRow.style.padding="10px 15px",navigationRow.style.borderBottom="1px solid #f0f0f0";const counterDisplay=document.createElement("div");counterDisplay.className="paste-events-counter",counterDisplay.textContent="Event 1 of "+uniqueComments.length,counterDisplay.style.fontWeight="bold",counterDisplay.style.color="#4285f4";const navButtons=document.createElement("div");navButtons.className="paste-events-buttons",navButtons.style.display="flex",navButtons.style.gap="10px";const prevButton=document.createElement("button");prevButton.className="paste-event-prev-btn",prevButton.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" \n             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <polyline points="15 18 9 12 15 6"></polyline>\n        </svg>',prevButton.style.border="none",prevButton.style.background="#f1f3f4",prevButton.style.borderRadius="50%",prevButton.style.width="30px",prevButton.style.height="30px",prevButton.style.display="flex",prevButton.style.alignItems="center",prevButton.style.justifyContent="center",prevButton.style.cursor="pointer",prevButton.style.color="#4285f4",prevButton.style.transition="background-color 0.2s",prevButton.disabled=!0,prevButton.style.opacity="0.5";const nextButton=document.createElement("button");nextButton.className="paste-event-next-btn",nextButton.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" \n             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <polyline points="9 18 15 12 9 6"></polyline>\n        </svg>',nextButton.style.border="none",nextButton.style.background="#f1f3f4",nextButton.style.borderRadius="50%",nextButton.style.width="30px",nextButton.style.height="30px",nextButton.style.display="flex",nextButton.style.alignItems="center",nextButton.style.justifyContent="center",nextButton.style.cursor="pointer",nextButton.style.color="#4285f4",nextButton.style.transition="background-color 0.2s",nextButton.disabled=uniqueComments.length<=1,nextButton.style.opacity=uniqueComments.length<=1?"0.5":"1",prevButton.addEventListener("mouseover",(()=>{prevButton.disabled||(prevButton.style.background="#e0e0e0")})),prevButton.addEventListener("mouseout",(()=>{prevButton.style.background="#f1f3f4"})),nextButton.addEventListener("mouseover",(()=>{nextButton.disabled||(nextButton.style.background="#e0e0e0")})),nextButton.addEventListener("mouseout",(()=>{nextButton.style.background="#f1f3f4"})),navButtons.appendChild(prevButton),navButtons.appendChild(nextButton),navigationRow.appendChild(counterDisplay),navigationRow.appendChild(navButtons);const contentContainer=document.createElement("div");contentContainer.className="paste-events-content",contentContainer.style.padding="15px",contentContainer.style.overflow="auto",contentContainer.style.position="relative";const eventRow=document.createElement("div");eventRow.style.display="flex",eventRow.style.justifyContent="space-between",eventRow.style.alignItems="center",eventRow.style.marginBottom="10px";const commentContainer=document.createElement("div");commentContainer.className="paste-event-comment",commentContainer.style.flex="1",commentContainer.style.paddingRight="10px",commentContainer.style.wordBreak="break-word",commentContainer.textContent=uniqueComments[0];const timestampContainer=document.createElement("div");timestampContainer.className="paste-event-timestamp",timestampContainer.style.flexShrink="0",timestampContainer.style.color="#666",timestampContainer.style.fontSize="12px",timestampContainer.style.fontFamily="monospace",timestampContainer.style.whiteSpace="nowrap";const timestamp=this.pasteTimestamps&&this.pasteTimestamps.length>0?this.pasteTimestamps[0].formattedTime:"00:00";timestampContainer.textContent=timestamp,eventRow.appendChild(commentContainer),eventRow.appendChild(timestampContainer),contentContainer.appendChild(eventRow),carouselContainer.appendChild(navigationRow),carouselContainer.appendChild(contentContainer),panel.appendChild(carouselContainer);let currentIndex=0;prevButton.addEventListener("click",(()=>{currentIndex>0&&(currentIndex--,updateDisplay())})),nextButton.addEventListener("click",(()=>{currentIndex<uniqueComments.length-1&&(currentIndex++,updateDisplay())}));const updateDisplay=()=>{contentContainer.innerHTML="";const newEventRow=document.createElement("div");newEventRow.style.display="flex",newEventRow.style.justifyContent="space-between",newEventRow.style.alignItems="center",newEventRow.style.marginBottom="10px";const newCommentContainer=document.createElement("div");newCommentContainer.className="paste-event-comment",newCommentContainer.style.flex="1",newCommentContainer.style.paddingRight="10px",newCommentContainer.style.wordBreak="break-word",newCommentContainer.textContent=uniqueComments[currentIndex];const newTimestampContainer=document.createElement("div");newTimestampContainer.className="paste-event-timestamp",newTimestampContainer.style.flexShrink="0",newTimestampContainer.style.color="#666",newTimestampContainer.style.fontSize="12px",newTimestampContainer.style.fontFamily="monospace",newTimestampContainer.style.whiteSpace="nowrap";const timestamp=this.pasteTimestamps&&this.pasteTimestamps.length>currentIndex?this.pasteTimestamps[currentIndex].formattedTime:"00:00";newTimestampContainer.textContent=timestamp,newEventRow.appendChild(newCommentContainer),newEventRow.appendChild(newTimestampContainer),contentContainer.appendChild(newEventRow),counterDisplay.textContent="Event ".concat(currentIndex+1," of ").concat(uniqueComments.length),prevButton.disabled=0===currentIndex,prevButton.style.opacity=0===currentIndex?"0.5":"1",nextButton.disabled=currentIndex===uniqueComments.length-1,nextButton.style.opacity=currentIndex===uniqueComments.length-1?"0.5":"1"}}setScrubberVal(value){if(this.scrubberElement&&(this.scrubberElement.value=String(value),this.timeDisplay)){const displayTime=Math.min(this.currentTime,this.totalDuration),currentTimeFormatted=this.formatTime(displayTime),totalTimeFormatted=this.formatTime(this.totalDuration);this.timeDisplay.textContent="".concat(currentTimeFormatted," / ").concat(totalTimeFormatted)}}loadJSON(filePath){return(0,_ajax.call)([{methodname:"cursive_get_reply_json",args:{filepath:filePath}}])[0].done((response=>response)).fail((error=>{throw new Error("Error loading JSON file: "+error.message)}))}formatTime(ms){const seconds=Math.floor(ms/1e3),minutes=Math.floor(seconds/60),remainingSeconds=seconds%60;return"".concat(minutes.toString().padStart(2,"0"),":").concat(remainingSeconds.toString().padStart(2,"0"))}startReplay(){let reset=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.replayInProgress&&clearTimeout(this.replayTimeout);if((this.totalDuration>0&&this.currentTime>=this.totalDuration||this.currentEventIndex>=this.totalEvents)&&!reset&&(reset=!0),this.replayInProgress=!0,reset&&(this.outputElement.innerHTML="",this.text="",this.cursorPosition=0,this.currentEventIndex=0,this.currentTime=0,this.highlightedChars=[],this.deletedChars=[],this.isControlKeyPressed=!1),this.playButton){const pauseSvg='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"\n            viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <line x1="9" y1="4" x2="9" y2="20"></line>\n            <line x1="15" y1="4" x2="15" y2="20"></line>\n            </svg>';this.playButton.querySelector(".play-icon").innerHTML=pauseSvg}this.replayLog()}replayLog(){if(this.replayInProgress){for(;this.currentEventIndex<this.logData.length;){const event=this.logData[this.currentEventIndex];if(event.normalizedTime&&event.normalizedTime>this.currentTime)break;let text=this.text||"",cursor=this.cursorPosition||0,updatedHighlights=[...this.highlightedChars],updatedDeleted=[...this.deletedChars];if(void 0!==event.rePosition&&(cursor=Math.max(0,Math.min(event.rePosition,text.length))),event.event&&"keydown"===event.event.toLowerCase()){const charToInsert=this.applyKey(event.key);if("Control"===event.key?this.isControlKeyPressed=!0:"v"!==event.key&&"Control"!==event.key&&(this.isControlKeyPressed=!1),"Backspace"===event.key&&this.isControlKeyPressed){if(cursor>0){let wordStart=cursor;for(;wordStart>0&&" "===text[wordStart-1];)wordStart--;for(;wordStart>0&&" "!==text[wordStart-1];)wordStart--;const wordToDelete=text.substring(wordStart,cursor);for(let i=0;i<wordToDelete.length;i++)updatedDeleted.push({index:wordStart+i,char:wordToDelete[i],time:this.currentTime,expiresAt:this.currentTime+2e3});text=text.substring(0,wordStart)+text.substring(cursor),cursor=wordStart}this.isControlKeyPressed=!1}else"Backspace"===event.key?cursor>0&&(updatedDeleted.push({index:cursor-1,char:text[cursor-1],time:this.currentTime,expiresAt:this.currentTime+2e3}),text=text.substring(0,cursor-1)+text.substring(cursor),cursor--):"ArrowLeft"===event.key?cursor=Math.max(0,cursor-1):"ArrowRight"===event.key?cursor=Math.min(text.length,cursor+1):null!==charToInsert&&""!==charToInsert&&(text=text.substring(0,cursor)+charToInsert+text.substring(cursor),""!==charToInsert.trim()&&updatedHighlights.push({index:cursor,char:charToInsert,time:this.currentTime,expiresAt:this.currentTime+1500}),cursor++)}this.text=text,this.cursorPosition=cursor,this.highlightedChars=updatedHighlights.filter((h=>!h.expiresAt||h.expiresAt>this.currentTime)),this.deletedChars=updatedDeleted.filter((d=>!d.expiresAt||d.expiresAt>this.currentTime)),this.currentEventIndex++}if(this.updateDisplayText(this.text,this.cursorPosition,this.highlightedChars,this.deletedChars),this.totalDuration>0){const percentComplete=Math.min(this.currentTime/this.totalDuration*100,100);this.setScrubberVal(percentComplete)}if(this.replayInProgress){const baseIncrement=100,incrementTime=baseIncrement/this.speed;this.currentTime+=baseIncrement,this.currentEventIndex>=this.totalEvents?this.loop?this.startReplay(!0):(this.stopReplay(),this.updateDisplayText(this.text,this.cursorPosition,[],[])):this.replayTimeout=setTimeout((()=>this.replayLog()),incrementTime)}}else this.updateDisplayText(this.text,this.cursorPosition,[],[])}skipToEnd(){this.replayInProgress&&(this.replayInProgress=!1);let textOutput="";this.logData.forEach((event=>{"keydown"===event.event.toLowerCase()&&(textOutput=this.applyKey(event.key,textOutput))})),this.outputElement.innerHTML=textOutput.slice(0,-1),this.setScrubberVal(100)}skipToTime(percentage){const wasPlaying=this.replayInProgress;wasPlaying&&(this.replayInProgress=!1,clearTimeout(this.replayTimeout));const targetTime=this.totalDuration*percentage/100;this.currentTime=targetTime,this.currentEventIndex=0,this.text="",this.cursorPosition=0,this.highlightedChars=[],this.deletedChars=[],this.isControlKeyPressed=!1;let text="",cursor=0;for(let i=0;i<this.logData.length;i++){const event=this.logData[i];if(event.normalizedTime&&event.normalizedTime>targetTime){this.currentEventIndex=i;break}if(void 0!==event.rePosition&&(cursor=Math.max(0,Math.min(event.rePosition,text.length))),event.event&&"keydown"===event.event.toLowerCase()){const charToInsert=this.applyKey(event.key);if("Control"===event.key?this.isControlKeyPressed=!0:"v"!==event.key&&"Control"!==event.key&&(this.isControlKeyPressed=!1),"Backspace"===event.key&&this.isControlKeyPressed){if(cursor>0){let wordStart=cursor;for(;wordStart>0&&" "===text[wordStart-1];)wordStart--;for(;wordStart>0&&" "!==text[wordStart-1];)wordStart--;const wordToDelete=text.substring(wordStart,cursor);for(let i=0;i<wordToDelete.length;i++)this.deletedChars.push({index:wordStart+i,char:wordToDelete[i],time:targetTime,expiresAt:targetTime+2e3});text=text.substring(0,wordStart)+text.substring(cursor),cursor=wordStart}this.isControlKeyPressed=!1}else"Backspace"===event.key?cursor>0&&(this.deletedChars.push({index:cursor-1,char:text[cursor-1],time:targetTime,expiresAt:targetTime+1e3}),text=text.substring(0,cursor-1)+text.substring(cursor),cursor=Math.max(0,cursor-1)):"ArrowLeft"===event.key?cursor=Math.max(0,cursor-1):"ArrowRight"===event.key?cursor=Math.min(text.length,cursor+1):charToInsert&&charToInsert.length>0&&(text=text.substring(0,cursor)+charToInsert+text.substring(cursor),""!==charToInsert.trim()&&this.highlightedChars.push({index:cursor,char:charToInsert,time:targetTime,expiresAt:targetTime+1e3}),cursor++)}this.currentEventIndex=i+1}this.text=text,this.cursorPosition=cursor,this.updateDisplayText(text,cursor,this.highlightedChars,this.deletedChars),this.setScrubberVal(percentage),wasPlaying&&(this.replayInProgress=!0,this.replayLog())}updateDisplayText(text,cursorPosition,highlights,deletions){let html="";const highlightMap={},deletionMap={},currentTime=this.currentTime;highlights.forEach((h=>{let opacity=1;if(h.expiresAt){const timeRemaining=h.expiresAt-currentTime;timeRemaining<500&&(opacity=Math.max(0,timeRemaining/500))}highlightMap[h.index]={char:h.char,opacity:opacity}})),deletions.forEach((d=>{let opacity=.5;if(d.expiresAt){const timeRemaining=d.expiresAt-currentTime;timeRemaining<500&&(opacity=Math.max(0,timeRemaining/500*.5))}deletionMap[d.index]={char:d.char,opacity:opacity}}));const outOfRangeDeletions=deletions.filter((d=>d.index>=text.length)),textLines=text.split("\n");let currentPosition=0;for(let lineIndex=0;lineIndex<textLines.length;lineIndex++){const line=textLines[lineIndex];for(let i=0;i<line.length;i++){currentPosition===cursorPosition&&(html+='<span class="tiny_cursive-cursor">|</span>');const char=line[i];if(deletionMap[currentPosition]){const deletion=deletionMap[currentPosition];html+='<span class="tiny_cursive-deleted-char" style="opacity: '.concat(deletion.opacity,';">').concat(deletion.char,"</span>")}if(highlightMap[currentPosition]&&" "!==char){const highlight=highlightMap[currentPosition];html+='<span class="tiny_cursive-highlighted-char" style="opacity: '.concat(highlight.opacity,';">').concat(char,"</span>")}else html+=" "===char?"&nbsp;":this.escapeHtml(char);currentPosition++}currentPosition===cursorPosition&&(html+='<span class="tiny_cursive-cursor">|</span>'),lineIndex<textLines.length-1&&(html+="<br>",currentPosition++)}if(cursorPosition!==text.length||html.endsWith('<span class="tiny_cursive-cursor">|</span>')||(html+='<span class="tiny_cursive-cursor">|</span>'),outOfRangeDeletions.length>0){outOfRangeDeletions.sort(((a,b)=>a.index-b.index));const cursorHTML='<span class="tiny_cursive-cursor">|</span>';let cursorPos=html.lastIndexOf(cursorHTML);if(-1!==cursorPos){let deletedWordHTML='<span class="tiny_cursive-deleted-char" style="opacity: 0.5;">';outOfRangeDeletions.forEach((d=>{deletedWordHTML+=d.char})),deletedWordHTML+="</span>",html=html.substring(0,cursorPos)+deletedWordHTML+html.substring(cursorPos)}}const wasScrolledToBottom=this.outputElement.scrollHeight-this.outputElement.clientHeight<=this.outputElement.scrollTop+1;this.outputElement.innerHTML=html,(wasScrolledToBottom||this.isCursorBelowViewport())&&(this.outputElement.scrollTop=this.outputElement.scrollHeight)}isCursorBelowViewport(){const cursorElement=this.outputElement.querySelector(".tiny_cursive-cursor:last-of-type");if(!cursorElement)return!1;const cursorRect=cursorElement.getBoundingClientRect(),outputRect=this.outputElement.getBoundingClientRect();return cursorRect.bottom>outputRect.bottom}escapeHtml(unsafe){return unsafe.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}applyKey(key){switch(key){case"Enter":return"\n";case"Backspace":case"ControlBackspace":return"";case" ":return" ";default:return["Shift","Ctrl","Alt","ArrowDown","ArrowUp","Control","ArrowRight","ArrowLeft","Meta","CapsLock","Tab","Escape","Delete","PageUp","PageDown","Insert","Home","End","NumLock"].includes(key)?"":key}}},_exports.default}));

//# sourceMappingURL=replay.min.js.map