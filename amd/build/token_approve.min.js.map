{"version":3,"file":"token_approve.min.js","sources":["../src/token_approve.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     tiny_cursive/token_approve\n * @category TinyMCE Editor\n * @copyright  CTI <info@cursivetechnology.com>\n * @author Brain Station 23 <sales@brainstation-23.com>\n */\n\ndefine([\"core/ajax\", \"core/str\"], function(AJAX, str) {\n  var usersTable = {\n    init: function(page) {\n      str\n        .get_strings([{key: \"field_require\", component: \"tiny_cursive\"}])\n        .done(function() {\n          usersTable.getToken(page);\n          usersTable.generateToken();\n        });\n    },\n    getToken: function() {\n      const approveTokenBtn = document.getElementById(\"approve_token\");\n      if (approveTokenBtn) {\n        approveTokenBtn.addEventListener(\"click\", function() {\n          const tokenInput = document.getElementById(\"id_s_tiny_cursive_secretkey\");\n          var token = tokenInput ? tokenInput.value : \"\";\n          var promise1 = AJAX.call([\n            {\n              methodname: \"cursive_approve_token\",\n              args: {\n                token: token,\n              },\n            },\n          ]);\n          promise1[0].done(function(json) {\n            var data = JSON.parse(json);\n            var messageAlert = \"\";\n            if (data.status == true) {\n              messageAlert =\n                \"<span class='alert alert-success' role='alert'>\" +\n                data.message +\n                \"</span>\";\n            } else {\n              messageAlert =\n                \"<span class='alert alert-danger' role='alert'>\" +\n                data.message +\n                \"</span>\";\n            }\n            const tokenMessage = document.getElementById(\"token_message\");\n            if (tokenMessage) {\n              tokenMessage.innerHTML = messageAlert;\n            }\n          });\n        });\n      }\n    },\n\n    generateToken() {\n      const generateToken = document.getElementById(\"generate_cursivetoken\");\n      const cursiveDisable = document.getElementById(\"cursivedisable\");\n      const cursiveEnable = document.getElementById(\"cursiveenable\");\n\n      if (generateToken) {\n        generateToken.addEventListener(\"click\", function(e) {\n          e.preventDefault();\n          var promise1 = AJAX.call([\n            {\n              methodname: \"cursive_generate_webtoken\",\n              args: [],\n            },\n          ]);\n          promise1[0].done(function(data) {\n            var messageAlert = \"\";\n            str.get_strings([\n              {key: \"webservtokengensucc\", component: \"tiny_cursive\"},\n              {key: \"webservtokengenfail\", component: \"tiny_cursive\"}\n            ]).then(function([success, fail]) {\n\n              if (data.token) {\n                const cursiveTokenInput = document.getElementById(\"id_s_tiny_cursive_cursivetoken\");\n                if (cursiveTokenInput) {\n                  cursiveTokenInput.value = data.token;\n                }\n                messageAlert = `<span class='text-success' role='alert'>${success}</span>`;\n              } else {\n                messageAlert = `<span class='text-danger' role='alert'>${fail}</span>`;\n              }\n              const cursiveTokenMsg = document.getElementById(\"cursivetoken_\");\n              if (cursiveTokenMsg) {\n                cursiveTokenMsg.innerHTML = messageAlert;\n                setTimeout(() => {\n                  cursiveTokenMsg.innerHTML = \"\";\n                }, 3000);\n              }\n              return true;\n           }).catch(error => window.console.error(error));\n          });\n          promise1[0].fail(function(textStatus) {\n            var errorMessage = \"<span class='text-danger' role='alert'>\";\n            str\n              .get_string(\"webservtokenerror\", \"tiny_cursive\")\n              .then((str) => {\n                errorMessage += str + \" \" + textStatus.error + \"</span>\";\n\n            const cursiveTokenMsg = document.getElementById(\"cursivetoken_\");\n            if (cursiveTokenMsg) {\n              cursiveTokenMsg.innerHTML = errorMessage;\n              // Clear the error message after 3 seconds.\n              setTimeout(function() {\n                cursiveTokenMsg.innerHTML = \"\";\n              }, 3000);\n            }\n            return true;\n          }).catch(error => window.console.error(error));\n          });\n        });\n      }\n\n      if (cursiveDisable) {\n        cursiveDisable.addEventListener(\"click\", function(e) {\n          e.preventDefault();\n\n          var promise1 = AJAX.call([\n            {\n              methodname: \"cursive_disable_all_course\",\n              args: {\n                disable: true,\n              },\n            },\n          ]);\n          promise1[0].done(function(data) {\n            var messageAlert = \"\";\n            str.get_strings([\n              {key: \"cursive:dis:succ\", component: \"tiny_cursive\"},\n              {key: \"cursive:dis:fail\", component: \"tiny_cursive\"}\n            ]).then(function([success, fail]) {\n              if (data) {\n                messageAlert = `<span class='text-success' role='alert'>${success}</span>`;\n              } else {\n                messageAlert = `<span class='text-danger' role='alert'>${fail}</span>`;\n              }\n\n              const cursiveDisableMsg = document.getElementById(\"cursivedisable_\");\n              if (cursiveDisableMsg) {\n                cursiveDisableMsg.innerHTML = messageAlert;\n                setTimeout(() => {\n                  cursiveDisableMsg.innerHTML = \"\";\n                }, 3000);\n              }\n              return true;\n            }).catch(error => window.console.error(error));\n          });\n          promise1[0].fail(function(textStatus) {\n            var errorMessage = \"<span class='text-danger' role='alert'>\";\n            str\n              .get_string(\"cursive:status\", \"tiny_cursive\")\n              .then((str) => {\n                errorMessage += str + \" \" + textStatus.error + \"</span>\";\n\n            const cursiveDisableMsg = document.getElementById(\"cursivedisable_\");\n            if (cursiveDisableMsg) {\n              cursiveDisableMsg.innerHTML = errorMessage;\n              // Clear the error message after 3 seconds.\n              setTimeout(function() {\n                cursiveDisableMsg.innerHTML = \"\";\n              }, 3000);\n            }\n            return true;\n          }).catch(error => window.console.error(error));\n          });\n        });\n      }\n\n      if (cursiveEnable) {\n        cursiveEnable.addEventListener(\"click\", function(e) {\n          e.preventDefault();\n\n          var promise1 = AJAX.call([\n            {\n              methodname: \"cursive_disable_all_course\",\n              args: {\n                disable: false,\n              },\n            },\n          ]);\n          promise1[0].done(function(data) {\n            var messageAlert = \"\";\n            str.get_strings([\n              {key: \"cursive:ena:succ\", component: \"tiny_cursive\"},\n              {key: \"cursive:ena:fail\", component: \"tiny_cursive\"}\n            ]).then(function([success, fail]) {\n              if (data) {\n                messageAlert = `<span class='text-success' role='alert'>${success}</span>`;\n              } else {\n                messageAlert = `<span class='text-danger' role='alert'>${fail}</span>`;\n              }\n\n              const cursiveDisableMsg = document.getElementById(\"cursivedisable_\");\n              if (cursiveDisableMsg) {\n                cursiveDisableMsg.innerHTML = messageAlert;\n                setTimeout(() => {\n                  cursiveDisableMsg.innerHTML = \"\";\n                }, 3000);\n              }\n              return true;\n            }).catch(error => window.console.error(error));\n          });\n          promise1[0].fail(function(textStatus) {\n            var errorMessage = \"<span class='text-danger' role='alert'>\";\n            str.get_string(\"cursive:status\", \"tiny_cursive\")\n              .then((str) => {\n                errorMessage += str + \" \" + textStatus.error + \"</span>\";\n\n            const cursiveDisableMsg = document.getElementById(\"cursivedisable_\");\n            if (cursiveDisableMsg) {\n              cursiveDisableMsg.innerHTML = errorMessage;\n              // Clear the error message after 3 seconds.\n              setTimeout(function() {\n                cursiveDisableMsg.innerHTML = \"\";\n              }, 3000);\n            }\n            return true;\n          }).catch(error => window.console.error(error));\n          });\n        });\n      }\n    },\n  };\n  return usersTable;\n});"],"names":["define","AJAX","str","usersTable","init","page","get_strings","key","component","done","getToken","generateToken","approveTokenBtn","document","getElementById","addEventListener","tokenInput","token","value","call","methodname","args","json","data","JSON","parse","messageAlert","status","message","tokenMessage","innerHTML","cursiveDisable","cursiveEnable","e","preventDefault","promise1","then","success","fail","cursiveTokenInput","cursiveTokenMsg","setTimeout","catch","error","window","console","textStatus","errorMessage","get_string","disable","cursiveDisableMsg"],"mappings":"AAsBAA,oCAAO,CAAC,YAAa,aAAa,SAASC,KAAMC,SAC3CC,WAAa,CACfC,KAAM,SAASC,MACbH,IACGI,YAAY,CAAC,CAACC,IAAK,gBAAiBC,UAAW,kBAC/CC,MAAK,WACJN,WAAWO,SAASL,MACpBF,WAAWQ,oBAGjBD,SAAU,iBACFE,gBAAkBC,SAASC,eAAe,iBAC5CF,iBACFA,gBAAgBG,iBAAiB,SAAS,iBAClCC,WAAaH,SAASC,eAAe,mCACvCG,MAAQD,WAAaA,WAAWE,MAAQ,GAC7BjB,KAAKkB,KAAK,CACvB,CACEC,WAAY,wBACZC,KAAM,CACJJ,MAAOA,UAIJ,GAAGR,MAAK,SAASa,UACpBC,KAAOC,KAAKC,MAAMH,MAClBI,aAAe,GAEjBA,aADiB,GAAfH,KAAKI,OAEL,kDACAJ,KAAKK,QACL,UAGA,iDACAL,KAAKK,QACL,gBAEEC,aAAehB,SAASC,eAAe,iBACzCe,eACFA,aAAaC,UAAYJ,qBAOnCf,sBACQA,cAAgBE,SAASC,eAAe,yBACxCiB,eAAiBlB,SAASC,eAAe,kBACzCkB,cAAgBnB,SAASC,eAAe,iBAE1CH,eACFA,cAAcI,iBAAiB,SAAS,SAASkB,GAC/CA,EAAEC,qBACEC,SAAWlC,KAAKkB,KAAK,CACvB,CACEC,WAAY,4BACZC,KAAM,MAGVc,SAAS,GAAG1B,MAAK,SAASc,UACpBG,aAAe,GACnBxB,IAAII,YAAY,CACd,CAACC,IAAK,sBAAuBC,UAAW,gBACxC,CAACD,IAAK,sBAAuBC,UAAW,kBACvC4B,MAAK,mBAAUC,QAASC,cAErBf,KAAKN,MAAO,OACRsB,kBAAoB1B,SAASC,eAAe,kCAC9CyB,oBACFA,kBAAkBrB,MAAQK,KAAKN,OAEjCS,aAAgB,2CAA0CW,sBAE1DX,aAAgB,0CAAyCY,oBAErDE,gBAAkB3B,SAASC,eAAe,wBAC5C0B,kBACFA,gBAAgBV,UAAYJ,aAC5Be,YAAW,KACTD,gBAAgBV,UAAY,KAC3B,OAEE,KACPY,OAAMC,OAASC,OAAOC,QAAQF,MAAMA,YAExCR,SAAS,GAAGG,MAAK,SAASQ,gBACpBC,aAAe,0CACnB7C,IACG8C,WAAW,oBAAqB,gBAChCZ,MAAMlC,MACL6C,cAAgB7C,IAAM,IAAM4C,WAAWH,MAAQ,gBAE7CH,gBAAkB3B,SAASC,eAAe,wBAC5C0B,kBACFA,gBAAgBV,UAAYiB,aAE5BN,YAAW,WACTD,gBAAgBV,UAAY,KAC3B,OAEE,KACNY,OAAMC,OAASC,OAAOC,QAAQF,MAAMA,eAKvCZ,gBACFA,eAAehB,iBAAiB,SAAS,SAASkB,GAChDA,EAAEC,qBAEEC,SAAWlC,KAAKkB,KAAK,CACvB,CACEC,WAAY,6BACZC,KAAM,CACJ4B,SAAS,MAIfd,SAAS,GAAG1B,MAAK,SAASc,UACpBG,aAAe,GACnBxB,IAAII,YAAY,CACd,CAACC,IAAK,mBAAoBC,UAAW,gBACrC,CAACD,IAAK,mBAAoBC,UAAW,kBACpC4B,MAAK,oBAAUC,QAASC,YAEvBZ,aADEH,KACc,2CAA0Cc,iBAE1C,0CAAyCC,oBAGrDY,kBAAoBrC,SAASC,eAAe,0BAC9CoC,oBACFA,kBAAkBpB,UAAYJ,aAC9Be,YAAW,KACTS,kBAAkBpB,UAAY,KAC7B,OAEE,KACNY,OAAMC,OAASC,OAAOC,QAAQF,MAAMA,YAEzCR,SAAS,GAAGG,MAAK,SAASQ,gBACpBC,aAAe,0CACnB7C,IACG8C,WAAW,iBAAkB,gBAC7BZ,MAAMlC,MACL6C,cAAgB7C,IAAM,IAAM4C,WAAWH,MAAQ,gBAE7CO,kBAAoBrC,SAASC,eAAe,0BAC9CoC,oBACFA,kBAAkBpB,UAAYiB,aAE9BN,YAAW,WACTS,kBAAkBpB,UAAY,KAC7B,OAEE,KACNY,OAAMC,OAASC,OAAOC,QAAQF,MAAMA,eAKvCX,eACFA,cAAcjB,iBAAiB,SAAS,SAASkB,GAC/CA,EAAEC,qBAEEC,SAAWlC,KAAKkB,KAAK,CACvB,CACEC,WAAY,6BACZC,KAAM,CACJ4B,SAAS,MAIfd,SAAS,GAAG1B,MAAK,SAASc,UACpBG,aAAe,GACnBxB,IAAII,YAAY,CACd,CAACC,IAAK,mBAAoBC,UAAW,gBACrC,CAACD,IAAK,mBAAoBC,UAAW,kBACpC4B,MAAK,oBAAUC,QAASC,YAEvBZ,aADEH,KACc,2CAA0Cc,iBAE1C,0CAAyCC,oBAGrDY,kBAAoBrC,SAASC,eAAe,0BAC9CoC,oBACFA,kBAAkBpB,UAAYJ,aAC9Be,YAAW,KACTS,kBAAkBpB,UAAY,KAC7B,OAEE,KACNY,OAAMC,OAASC,OAAOC,QAAQF,MAAMA,YAEzCR,SAAS,GAAGG,MAAK,SAASQ,gBACpBC,aAAe,0CACnB7C,IAAI8C,WAAW,iBAAkB,gBAC9BZ,MAAMlC,MACL6C,cAAgB7C,IAAM,IAAM4C,WAAWH,MAAQ,gBAE7CO,kBAAoBrC,SAASC,eAAe,0BAC9CoC,oBACFA,kBAAkBpB,UAAYiB,aAE9BN,YAAW,WACTS,kBAAkBpB,UAAY,KAC7B,OAEE,KACNY,OAAMC,OAASC,OAAOC,QAAQF,MAAMA,wBAMxCxC"}